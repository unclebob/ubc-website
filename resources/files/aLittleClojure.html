<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title>A Little Clojure</title>
  <meta name="Author" content="Robert C. Martin">
  <meta name="CreationTime" content="2024-05-18T11:29:05Z">
  <meta name="ModificationTime" content="2024-05-18T11:29:05Z">
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2487.5">
  <style type="text/css">
    p.p2 {margin: 0.0px 0.0px 5.0px 0.0px; font: 24.0px Palatino}
    p.p3 {margin: 0.0px 0.0px 0.0px 14.4px; font: 20.0px Menlo}
    p.p4 {margin: 0.0px 0.0px 0.0px 14.4px; font: 20.0px Menlo; min-height: 24.0px}
    p.p5 {margin: 0.0px 0.0px 5.0px 0.0px; font: 24.0px Palatino; min-height: 32.0px}
    p.p6 {margin: 0.0px 0.0px 0.0px 0.0px; font: 24.0px Palatino; min-height: 32.0px}
    p.p8 {margin: 5.0px 0.0px 0.0px 0.0px; font: 24.0px Palatino}
    p.p9 {margin: 0.0px 0.0px 3.0px 36.0px; font: 24.0px Palatino}
    p.p10 {margin: 0.0px 0.0px 3.0px 36.0px; font: 24.0px Palatino; min-height: 32.0px}
    p.p11 {margin: 0.0px 0.0px 0.0px 36.0px; font: 24.0px Palatino; min-height: 32.0px}
    p.p12 {margin: 0.0px 0.0px 5.0px 0.0px; font: 20.0px Menlo; min-height: 24.0px}
    p.p13 {margin: 0.0px 0.0px 0.0px 0.0px; text-indent: 18.0px; font: 13.0px Palatino; min-height: 18.0px}
    p.p14 {margin: 0.0px 0.0px 5.0px 0.0px; font: 20.0px Menlo}
    p.p15 {margin: 0.0px 0.0px 3.0px 36.0px; font: 20.0px Menlo}
    p.p17 {margin: 0.0px 0.0px 0.0px 0.0px; font: 20.0px Menlo; min-height: 24.0px}
    p.p18 {margin: 0.0px 0.0px 5.0px 36.0px; text-indent: -36.0px; font: 24.0px Palatino; min-height: 32.0px}
    p.p20 {margin: 0.0px 0.0px 5.0px 36.0px; text-indent: -36.0px; font: 24.0px Palatino}
    p.p21 {margin: 0.0px 0.0px 3.0px 36.0px; font: 20.0px Menlo; min-height: 24.0px}
    p.p22 {margin: 0.0px 0.0px 0.0px 0.0px; font: 16.0px Monaco; color: #090909; min-height: 21.0px}
    p.p23 {margin: 0.0px 0.0px 0.0px 0.0px; font: 11.0px Menlo}
    p.p24 {margin: 0.0px 0.0px 0.0px 0.0px; font: 11.0px Menlo; min-height: 13.0px}
    p.p25 {margin: 0.0px 0.0px 0.0px 36.0px; text-indent: -36.0px; font: 24.0px Palatino; min-height: 32.0px}
    p.p26 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p28 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times; -webkit-text-stroke: #000000; min-height: 14.0px}
    p.p29 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Times; -webkit-text-stroke: #000000}
    p.p30 {margin: 0.0px 0.0px 0.0px 36.0px; text-indent: -36.0px; font: 20.0px Menlo}
    p.p31 {margin: 0.0px 0.0px 0.0px 36.0px; text-indent: -36.0px; font: 20.0px Menlo; min-height: 24.0px}
    p.p32 {margin: 0.0px 0.0px 0.0px 0.0px; text-indent: 18.0px; font: 20.0px Menlo}
    p.p33 {margin: 0.0px 0.0px 0.0px 0.0px; text-indent: 18.0px; font: 20.0px Menlo; min-height: 24.0px}
    p.p34 {margin: 0.0px 0.0px 5.0px 0.0px; font: 12.0px Helvetica}
    p.p35 {margin: 0.0px 0.0px 3.0px 0.0px; font: 12.0px Helvetica}
    li.li2 {margin: 0.0px 0.0px 5.0px 0.0px; font: 24.0px Palatino}
    li.li19 {margin: 0.0px 0.0px 0.0px 0.0px; font: 20.0px Menlo}
    span.s1 {font: 20.0px Menlo}
    span.s2 {font: 16.0px Palatino}
    span.s3 {font: 24.0px Palatino}
    span.s4 {font-kerning: none}
    span.s5 {font: 9.0px Helvetica}
    span.s6 {font: 12.0px Monaco}
    span.Apple-tab-span {white-space:pre}
    ol.ol1 {list-style-type: decimal}
    ul.ul1 {list-style-type: disc}
  </style>
</head>
<body>
<div style="width: 1000px; margin: 0 auto">

<h1 style="margin: 36.0px 0.0px 36.0px 0.0px; text-align: center; font: 48.0px Helvetica">Chapter 1</h1>
<h1 style="margin: 36.0px 0.0px 36.0px 0.0px; text-align: center; font: 48.0px Helvetica">Getting Started</h1>
<p class="p2">The purpose of this guide is to take you on a fascinating journey using a little Clojure.<span class="Apple-converted-space">  </span>The journey will begin with the very simplest of programs and end up with the building of graphical user interfaces and web sites. <span class="Apple-converted-space"> </span></p>
<p class="p2">The strategy employed is <i>absurd simplicity</i>.<span class="Apple-converted-space">  </span>You will see very little text and mostly just Clojure code presented in such a way that each concept leads to the next in a compelling logical story.<span class="Apple-converted-space">  </span>Don’t be daunted.<span class="Apple-converted-space">  </span>Just read the code, and examine the output produced by that code, and then reason out what that code is doing.<span class="Apple-converted-space">  </span>Then <i>play</i>!<span class="Apple-converted-space">  </span>Change the code and see what happens.<span class="Apple-converted-space">  </span>You’ll learn faster than you thought possible.</p>
<p class="p2">To get started we’re going to need to be able to type commands into a REPL (Read Evaluate Print Loop).<span class="Apple-converted-space">  </span>You can get to a REPL using any computer connected to the internet by going to <a href="https://clojure.org/guides/install_clojure"><span class="s1">https://clojure.org/guides/install_clojure</span></a><span class="s1"> a</span>nd following the instructions there.<span class="Apple-converted-space"> </span></p>
<p class="p2">Once you have clojure installed, you should be able to type <span class="s1">clj</span> into a command window.<span class="Apple-converted-space">  </span>You should see something more or less like this:</p>
<p class="p3">Clojure 1.11.1</p>
<p class="p3">user=&gt;</p>
<p class="p4"><br></p>
<p class="p2">In the examples that follow, I will often replace <span class="s1">user=&gt;</span> with just <span class="s1">=&gt;</span> just to keep things simple at first. <span class="Apple-converted-space"> </span></p>
<p class="p2">Each chapter ends with exercises.<span class="Apple-converted-space">  </span>I urge you, very strongly, to work through these exercises.<span class="Apple-converted-space">  </span>The answers (or at least <i>my</i> answers) are in the appendix.<span class="Apple-converted-space">  </span>If you already know a bit of Clojure then try to solve the exercises with only the features of the language that have been discussed up to that point.<span class="Apple-converted-space">  </span>Some of they will be quite challenging.</p>
<p class="p2">And now we are ready to begin…and remember to <i>play</i>!</p>
<p class="p5"><br></p>
<p class="p6"><br></p>
<h1 style="margin: 36.0px 0.0px 36.0px 0.0px; text-align: center; font: 48.0px Helvetica">Chapter 2</h1>
<h1 style="margin: 36.0px 0.0px 36.0px 0.0px; text-align: center; font: 48.0px Helvetica">First Principles</h1>
<p class="p2">At the REPL type <span class="s1">(+ 1 1)</span> and hit <span class="s1">enter</span> or <span class="s1">return</span>.<span class="Apple-converted-space">  </span>Your screen should look like this now.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (+ 1 1)</p>
<p class="p3"><b>2</b></p>
<p class="p4"><br></p>
<p class="p2">Continue to try each of the following examples.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (+ 1 1 1)</p>
<p class="p3"><b>3</b></p>
<p class="p4"><br></p>
<p class="p3">=&gt; (+ 1 1 1 1 1 1 1 1 1)</p>
<p class="p3"><b>9</b></p>
<p class="p4"><br></p>
<p class="p3">=&gt; (+ 1)</p>
<p class="p3"><b>1</b></p>
<p class="p4"><br></p>
<p class="p3">=&gt; (+)</p>
<p class="p3"><b>0</b></p>
<p class="p4"><br></p>
<p class="p2">The sum of nothing is zero — the additive identity.</p>
<p class="p2">Does this work with subtraction?</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (-)</p>
<p class="p3">Execution error (ArityException) at user/eval3 (REPL:1).</p>
<p class="p3">Wrong number of args (0) passed to: clojure.core/-</p>
<p class="p4"><br></p>
<p class="p2">Nope.<span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p3">=&gt; (- 1)</p>
<p class="p3"><b>-1</b></p>
<p class="p4"><br></p>
<p class="p3">=&gt; (- 1 1)</p>
<p class="p3"><b>0</b></p>
<p class="p3">=&gt; (- 1 1 1)</p>
<p class="p3"><b>-1</b></p>
<p class="p4"><br></p>
<p class="p2">Multiplication works as you might expect. <span class="Apple-converted-space"> </span></p>
<p class="p5"><br></p>
<p class="p3">=&gt; (*)</p>
<p class="p3"><b>1</b></p>
<p class="p3">=&gt; (* 1)</p>
<p class="p3"><b>1</b></p>
<p class="p3">=&gt;(* 2 3)</p>
<p class="p3"><b>6</b></p>
<p class="p3">=&gt;(* 2 3 4)</p>
<p class="p3"><b>24</b></p>
<p class="p4"><br></p>
<p class="p2">Division is a bit different.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (/ 1)</p>
<p class="p3"><b>1</b></p>
<p class="p3">=&gt; (/ 2)</p>
<p class="p3"><b>1/2</b></p>
<p class="p4"><br></p>
<p class="p2">Aha!<span class="Apple-converted-space">  </span>That <span class="s1">1/2</span> is a <i>rational</i> number.<span class="Apple-converted-space">  </span>In order to be exact clojure will avoid creating decimal expansions if it can, as you can see by the following examples.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (/ 1 3)</p>
<p class="p3"><b>1/3</b></p>
<p class="p3">=&gt; (/ 2 3 4)</p>
<p class="p3"><b>1/6</b></p>
<p class="p4"><br></p>
<p class="p2">Clojure always reduces rational numbers to lowest terms.</p>
<p class="p2">If you’d rather see decimal expansions then you can use <i>floating point<a id="fnlink1"></a></i><a href="#fn1"><sup>[1]</sup></a> numbers as follows.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (/ 1.0 2.0)</p>
<p class="p3"><b>0.5</b></p>
<p class="p3">=&gt; (/ 1.0 7.0)</p>
<p class="p3"><b>0.14285714285714285</b></p>
<p class="p4"><br></p>
<p class="p2">That last value is approximate.<span class="Apple-converted-space">  </span>That’s the problem with floating point numbers, they are seldom exact.<span class="Apple-converted-space">  </span>Whereas integers and rational numbers are always exact.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (type 1)</p>
<p class="p3">java.lang.Long</p>
<p class="p3">=&gt; (type 1/2)</p>
<p class="p3">clojure.lang.Ratio</p>
<p class="p3">=&gt; (type 1.0)</p>
<p class="p3">java.lang.Double</p>
<p class="p4"><br></p>
<p class="p2">Ignore the <span class="s1">java.lang</span>.<span class="Apple-converted-space">  </span><span class="s1">Long</span> is a synonym for integer.<span class="Apple-converted-space">  </span><span class="s1">Ratio</span> is a synonym for rational.<span class="Apple-converted-space">  </span><span class="s1">Double</span> is a synonym for floating point.</p>
<p class="p2">Sometimes we want to group two or more numbers together.<span class="Apple-converted-space">  </span>We can do that using a <i>vector</i>. <span class="Apple-converted-space"> </span></p>
<p class="p3">=&gt; [1 2]</p>
<p class="p3"><b>[1 2]</b></p>
<p class="p3">=&gt; [1 2 3]</p>
<p class="p3"><b>[1 2 3]</b></p>
<p class="p3">=&gt; [1]</p>
<p class="p3"><b>[1]</b></p>
<p class="p3">=&gt; []</p>
<p class="p3"><b>[]</b></p>
<p class="p4"><br></p>
<p class="p3">=&gt; (first [1 2 3])</p>
<p class="p3"><b>1</b></p>
<p class="p3">=&gt; (rest [1 2 3])</p>
<p class="p3"><b>(2 3)</b></p>
<p class="p3">=&gt; (last [1 2 3])</p>
<p class="p3"><b>3</b></p>
<p class="p3">=&gt; (second [1 2 3])</p>
<p class="p3"><b>2</b></p>
<p class="p3">=&gt; (count [1 1 1 1 1 1 1])</p>
<p class="p3"><b>7</b></p>
<p class="p3">=&gt; (nth [9 8 7 6 5] 3)</p>
<p class="p3"><b>6</b></p>
<p class="p4"><br></p>
<p class="p2">The <span class="s1">nth</span> operation presumes that the items are numbered from zero. <span class="Apple-converted-space"> </span></p>
<p class="p5"><br></p>
<p class="p3">=&gt; (type [1])</p>
<p class="p3">clojure.lang.PersistentVector</p>
<p class="p4"><br></p>
<p class="p2">Another data type, similar to vectors, is the <i>list</i>.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; '(1 2 3)</p>
<p class="p3"><b>(1 2 3)</b></p>
<p class="p3">=&gt; '(1)</p>
<p class="p3"><b>(1)</b></p>
<p class="p3">=&gt; '()</p>
<p class="p3"><b>()</b></p>
<p class="p3">=&gt; (first '(1 2 3))</p>
<p class="p3"><b>1</b></p>
<p class="p3">=&gt; (rest '(1 2 3))</p>
<p class="p3"><b>(2 3)</b></p>
<p class="p3">=&gt; (second '(1 2 3))</p>
<p class="p3"><b>2</b></p>
<p class="p3">=&gt; (last '(1 2 3))</p>
<p class="p3"><b>3</b></p>
<p class="p3">=&gt; (count '(1 1 1 1 1 1 1))</p>
<p class="p3"><b>7</b></p>
<p class="p3">=&gt; (nth '(1 2 3) 1)</p>
<p class="p3"><b>2</b></p>
<p class="p3">=&gt; (type '(1))</p>
<p class="p3"><b>clojure.lang.PersistentList</b></p>
<p class="p4"><br></p>
<p class="p2">The difference<a id="fnlink2"></a><a href="#fn2"><sup>[2]</sup></a> between lists and vectors is the way they are stored inside the computer.<span class="Apple-converted-space">  </span>Vectors are designed to grow from the back, whereas lists are designed to grow from the front.<span class="Apple-converted-space">  </span>We often use the <span class="s1">conj</span> operation to grow a list or a vector.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (conj [1 2 3] 4)</p>
<p class="p3"><b>[1 2 3 4]</b></p>
<p class="p3">=&gt; (conj '(1 2 3) 4)</p>
<p class="p3"><b>(4 1 2 3)</b></p>
<p class="p4"><br></p>
<p class="p2">We can also concatenate lists and vectors together.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (concat [1 2 3] [4 5 6])</p>
<p class="p3"><b>(1 2 3 4 5 6)</b></p>
<p class="p3">=&gt; (concat [1 2 3] '(4 5 6))</p>
<p class="p3"><b>(1 2 3 4 5 6)</b></p>
<p class="p4"><br></p>
<p class="p2">So far we’ve been using the word “operation” to refer to <span class="s1">+</span>, <span class="s1">-</span>, <span class="s1">*</span>,<span class="s1"> /</span>, <span class="s1">type</span>, <span class="s1">first</span>, <span class="s1">second</span>, <span class="s1">last</span>, and <span class="s1">nth</span>.<span class="Apple-converted-space">  </span>We’ve also been using the word “parameter” to describe the data being operated upon.<span class="Apple-converted-space">  </span>From now on we are going to use the word “function” and “argument” respectively, for reasons that will become clear soon.</p>
<p class="p2">The <span class="s1">inc</span> and <span class="s1">dec</span> functions simply increment (add one to) and decrement (subtract one from) their arguments.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (inc 1)</p>
<p class="p3"><b>2</b></p>
<p class="p3">=&gt; (dec 1)</p>
<p class="p3"><b>0</b></p>
<p class="p3">=&gt; (inc 1/2)</p>
<p class="p3"><b>3/2</b></p>
<p class="p3">=&gt; (dec 4/5)</p>
<p class="p3"><b>-1/5</b></p>
<p class="p3">=&gt; (inc 4.0)</p>
<p class="p3"><b>5.0</b></p>
<p class="p3">=&gt; (dec 6.2)</p>
<p class="p3"><b>5.2</b></p>
<p class="p4"><br></p>
<p class="p2">The <span class="s1">map</span> function applies another function across the entirely of a list or vector.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (map inc '(1 2 3))</p>
<p class="p3"><b>(2 3 4)</b></p>
<p class="p3">=&gt; (map dec [5 6 7])</p>
<p class="p3"><b>(4 5 6)</b></p>
<p class="p4"><br></p>
<p class="p2">Notice that in the last example, even though the argument was a vector, the returned value was a list<a id="fnlink3"></a><a href="#fn3"><sup>[3]</sup></a>, not a vector.<span class="Apple-converted-space">  </span>This is typical of many functions in the clojure library — and there’s a good reason for it that you’ll eventually learn.<span class="Apple-converted-space">  </span>It’s not important right now.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (map + [1 2 3 4] [5 6 7 8])</p>
<p class="p3"><b>(6 8 10 12)</b></p>
<p class="p4"><br></p>
<p class="p3">=&gt; (map * [1 2 3] [4 5 6] [-1 0 1])</p>
<p class="p3"><b>(-4 0 18)</b></p>
<p class="p4"><br></p>
<p class="p2">Let’s make a program we can call.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (defn square [x] (* x x))</p>
<p class="p3"><b>#'user/square</b></p>
<p class="p3">=&gt; (square 2)</p>
<p class="p3"><b>4</b></p>
<p class="p3">=&gt; (square 1/2)</p>
<p class="p3"><b>1/4</b></p>
<p class="p3">=&gt; (square 0.3)</p>
<p class="p3"><b>0.09</b></p>
<p class="p3">=&gt; (square (square (square 2)))</p>
<p class="p3"><b>256</b></p>
<p class="p4"><br></p>
<p class="p2">It looks like <span class="s1">defn</span> is a function that creates another function.<span class="Apple-converted-space">  </span>That’s not quite what <span class="s1">defn</span> is, but we’ll go with that for the time being.<span class="Apple-converted-space">  </span>The first argument to <span class="s1">defn</span> is the name of the function being created (<span class="s1">square</span>).<span class="Apple-converted-space">  </span>The next argument (<span class="s1">[x]</span>) is a vector naming the argument(s) of the function.<span class="Apple-converted-space">  </span>The last argument (<span class="s1">(* x x)</span>) is a list that contains the executable body of the function.<span class="Apple-converted-space"> </span></p>
<p class="p2">Now let’s look at some standard comparisons. <span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p3">=&gt; (pos? 1)</p>
<p class="p3"><b>true</b></p>
<p class="p3">=&gt; (pos? -1)</p>
<p class="p3"><b>false</b></p>
<p class="p3">=&gt; (pos? 0)</p>
<p class="p3"><b>false</b></p>
<p class="p3">=&gt; (neg? 1)</p>
<p class="p3"><b>false</b></p>
<p class="p3">=&gt; (neg? -1)</p>
<p class="p3"><b>true</b></p>
<p class="p3">=&gt; (neg? 0)</p>
<p class="p3"><b>false</b></p>
<p class="p3">=&gt; (zero? 1)</p>
<p class="p3"><b>false</b></p>
<p class="p3">=&gt; (zero? -1)</p>
<p class="p3"><b>false</b></p>
<p class="p3">=&gt; (zero? 0)</p>
<p class="p3"><b>true</b></p>
<p class="p4"><br></p>
<p class="p3">=&gt; (&lt; 1 2)</p>
<p class="p3"><b>true</b></p>
<p class="p3">=&gt; (&lt; 2 1)</p>
<p class="p3"><b>false</b></p>
<p class="p3">=&gt; (&gt; 1 2)</p>
<p class="p3"><b>false</b></p>
<p class="p3">=&gt; (&gt; 2 1)</p>
<p class="p3"><b>true</b></p>
<p class="p4"><br></p>
<p class="p2">The above are just simply magnitude comparators, but you can add more arguments…</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (&lt; 1 2 3)</p>
<p class="p3"><b>true</b></p>
<p class="p3">=&gt; (&gt; 3 2 1)</p>
<p class="p3"><b>true</b></p>
<p class="p4"><br></p>
<p class="p2">So 1&lt;2&lt;3 and 3&gt;2&gt;1.<span class="Apple-converted-space">  </span>This is really useful for those validations between limits.<span class="Apple-converted-space">  </span>And, of course the corresponding <span class="s1">&gt;=</span> and <span class="s1">&lt;=</span> functions work the same way. <span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p3">=&gt; (&lt;= 1 1 2)</p>
<p class="p3"><b>true</b></p>
<p class="p3">=&gt; (&gt;= 5 4 4)</p>
<p class="p3"><b>true</b></p>
<p class="p4"><br></p>
<p class="p2">With single argument comparators like <span class="s1">pos?</span> and <span class="s1">neg?</span> you can filter items from lists.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (filter neg? [3 5 -2 7 -1])</p>
<p class="p3"><b>(-2 -1)</b></p>
<p class="p3">=&gt; (remove pos? [-7 3 -2 1])</p>
<p class="p3"><b>(-7 -2)</b></p>
<p class="p4"><br></p>
<p class="p2">Sometimes you’ll have a list that you want to be the arguments of a function.<span class="Apple-converted-space">  </span>That’s what the <span class="s1">apply</span> function is for. <span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p3">=&gt; (apply * [2 3 4])</p>
<p class="p3"><b>24</b></p>
<p class="p3">=&gt; (apply + '(7 6 5))</p>
<p class="p3"><b>18</b></p>
<p class="p4"><br></p>
<p class="p2">So far we’ve been dealing with numbers.<span class="Apple-converted-space">  </span>But, of course, Clojure can also deal with strings.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (type "string")</p>
<p class="p3"><b>java.lang.String</b></p>
<p class="p3">=&gt; "string"</p>
<p class="p3"><b>"string"</b></p>
<p class="p4"><br></p>
<p class="p2">The <span class="s1">str</span> function coerces its arguments into strings and concatenates them.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (str "concatenate" " " "strings")</p>
<p class="p3"><b>"concatenate strings"</b></p>
<p class="p3">=&gt; (str 1 2 3)</p>
<p class="p3"><b>"123"</b></p>
<p class="p4"><br></p>
<p class="p2">The <span class="s1">char</span> function coerces its argument into a character.<span class="Apple-converted-space">  </span>Most data types have corresponding coercion functions.</p>
<p class="p3">(type \A)</p>
<p class="p3"><b>java.lang.Character</b></p>
<p class="p3">=&gt; (char 65)</p>
<p class="p3"><b>\A</b></p>
<p class="p3">=&gt; (int \A)</p>
<p class="p3"><b>65</b></p>
<p class="p3">=&gt; (boolean 1)</p>
<p class="p3"><b>true</b></p>
<p class="p3">=&gt; (boolean 0)</p>
<p class="p3"><b>true</b></p>
<p class="p3">=&gt; (boolean nil)</p>
<p class="p3"><b>false</b></p>
<p class="p3">=&gt; (double 1)</p>
<p class="p3"><b>1.0</b></p>
<p class="p3">=&gt; (double 1/2)</p>
<p class="p3"><b>0.5</b></p>
<p class="p3">=&gt; (rationalize 0.5)</p>
<p class="p3"><b>1/2</b></p>
<p class="p3">=&gt; (int 1.5)</p>
<p class="p3"><b>1</b></p>
<p class="p3">=&gt; (int 1/2)</p>
<p class="p3"><b>0</b></p>
<p class="p3">=&gt; (int 3/2)</p>
<p class="p3"><b>1</b></p>
<p class="p4"><br></p>
<p class="p2">Strings behave like lists.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (first "string")</p>
<p class="p3"><b>\s</b></p>
<p class="p3">=&gt; (rest "string")</p>
<p class="p3"><b>(\t \r \i \n \g)</b></p>
<p class="p3">=&gt; (last "string")</p>
<p class="p3"><b>\g</b></p>
<p class="p3">=&gt; (nth "string" 3)</p>
<p class="p3"><b>\i</b></p>
<p class="p4"><br></p>
<p class="p2">The <span class="s1">def</span> statement below creates a new variable named <span class="s1">string-chars</span> containing the list of characters in <span class="s1">“string”</span>. <span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p3">=&gt; (def string-chars (map char "string"))</p>
<p class="p3"><b>#'user/string-chars</b></p>
<p class="p3">=&gt; string-chars</p>
<p class="p3"><b>(\s \t \r \i \n \g)</b></p>
<p class="p3">=&gt; (apply str string-chars)</p>
<p class="p3"><b>"string"</b></p>
<p class="p4"><br></p>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 36.0px Palatino"><b>Examples</b></h1>
<p class="p2">Now let’s apply what we’ve learned to solve a few simple problems.<span class="Apple-converted-space">  </span>The formula for converting Celsius temperatures to Fahrenheit is <i>(9/5c + 32)</i>. <span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p3">=&gt; (defn ctof [c] (+ 32.0 (* 9/5 c)))</p>
<p class="p3">=&gt; (ctof -40)</p>
<p class="p3"><b>-40.0</b></p>
<p class="p3">=&gt; (ctof 0)</p>
<p class="p3"><b>32.0</b></p>
<p class="p3">=&gt; (ctof 100)</p>
<p class="p3"><b>212.0</b></p>
<p class="p4"><br></p>
<p class="p2">The complimentary formula that converts Fahrenheit to Celsius is <i>(5/9(f-32))</i>.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (defn ftoc [f] (* 5/9 (- f 32.0)))</p>
<p class="p3">=&gt; (ftoc 32)</p>
<p class="p3"><b>0.0</b></p>
<p class="p3">=&gt; (ftoc 212)</p>
<p class="p3"><b>100.0</b></p>
<p class="p3">=&gt; (ftoc -40)</p>
<p class="p3"><b>-40.0</b></p>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 36.0px Palatino"><b>Exercises</b></h1>
<p class="p8"><b>1.<span class="Apple-tab-span">	</span>Albert.</b></p>
<p class="p9">Create a function to calculate the energy content of a given mass using Einstein’s formula <i>E=mc2</i>.<span class="Apple-converted-space">  </span>The constant <i>c</i> is 299,792,458 meters per second, <i>m</i> will be in kilograms, and <i>E</i> will be in Joules.</p>
<p class="p8"><b>2.<span class="Apple-tab-span">	</span>Mix it up.</b></p>
<p class="p9">Write a function named <span class="s1">mix</span> that takes two strings and mixes them into a single string.<span class="Apple-converted-space">  </span>Thus <span class="s1">(mix “abcde” “12345”)</span> returns <span class="s1">“a1b2c3d4e5”</span>.</p>
<p class="p8"><b>3.<span class="Apple-tab-span">	</span>Average.</b></p>
<p class="p9">Write a function named <span class="s1">mean</span> that computes the average of a list of numbers.<span class="Apple-converted-space">  </span>Thus <span class="s1">(mean [1 2])</span> should return <span class="s1">3/2</span>.<span class="Apple-converted-space">  </span>Now change it so that it returns <span class="s1">1.5</span>. <span class="Apple-converted-space"> </span></p>
<p class="p8"><b>4.<span class="Apple-tab-span">	</span>Power.</b></p>
<p class="p9">The <span class="s1">(repeat n x)</span> function produces a list of the <span class="s1">x</span> element repeated <span class="s1">n</span> times.<span class="Apple-converted-space">  </span>Thus <span class="s1">(repeat 3 “bob”)</span> returns <span class="s1">(“bob” “bob” “bob”)</span>.<span class="Apple-converted-space">  </span>Use this to create a function <span class="s1">(pow n e)</span> that computes <i>ne</i> where <i>e</i> is a non-negative integer.<span class="Apple-converted-space">  </span>Make sure you test the case where <i>e</i> is zero.</p>
<p class="p8"><b>5.<span class="Apple-tab-span">	</span>Filter.</b></p>
<p class="p9">Write a function named <span class="s1">pos-neg</span> which takes a list of numbers and returns a list containing all the positives followed by any zeros, and then by all the negatives.<span class="Apple-converted-space">  </span>Thus <span class="s1">(pos-neg [6 -1 0 4 -2 0]) </span>should return <span class="s1">(6 4 0 0 -1 -2)</span>.</p>
<p class="p8"><b>6.<span class="Apple-tab-span">	</span>Pythagorus.</b></p>
<p class="p9">Write a function named <span class="s1">pythag?</span> that takes three arguments <i>a</i>, <i>b</i>, and <i>c</i>, which are the lengths of the sides of a triangle.<span class="Apple-converted-space">  </span>Return true if the triangle has a 90° angle — or, in other words, if the three arguments form a Pythagorean triplet: <i>c2=a2+b2</i>.<span class="Apple-converted-space">  </span>Thus, <span class="s1">(pythag? 3 4 5)</span> should return <span class="s1">true</span>, whereas <span class="s1">(pythag? 1 2 3)</span> should return <span class="s1">false</span>.</p>
<p class="p10"><br></p>
<p class="p11"><br></p>
<h1 style="margin: 36.0px 0.0px 36.0px 0.0px; text-align: center; font: 48.0px Helvetica">Chapter 3</h1>
<h1 style="margin: 36.0px 0.0px 36.0px 0.0px; text-align: center; font: 48.0px Helvetica">Decisions, Decisions</h1>
<p class="p2">It is often useful to know if a list is empty.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (empty? [])</p>
<p class="p3">true</p>
<p class="p3">=&gt; (empty? '())</p>
<p class="p3">true</p>
<p class="p3">=&gt; (empty? "")</p>
<p class="p3">true</p>
<p class="p3">=&gt; (empty? nil)</p>
<p class="p3">true</p>
<p class="p3">=&gt; (map empty? [[1] '(1) "x"])</p>
<p class="p3">(false false false)</p>
<p class="p3">=&gt; (doc empty?)</p>
<p class="p3">-------------------------</p>
<p class="p3">clojure.core/empty?</p>
<p class="p3">([coll])</p>
<p class="p3"><span class="Apple-converted-space">  </span>Returns true if coll has no items - same as (not (seq coll)).</p>
<p class="p3"><span class="Apple-converted-space">  </span>Please use the idiom (seq x) rather than (not (empty? x))</p>
<p class="p3">nil</p>
<p class="p4"><br></p>
<p class="p2">It’s also useful to know if something is <span class="s1">nil</span> or not.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (nil? nil)</p>
<p class="p3">true</p>
<p class="p3">=&gt; (nil? 1)</p>
<p class="p3">false</p>
<p class="p3">=&gt; (nil? [])</p>
<p class="p3">false</p>
<p class="p3">=&gt; (some? nil)</p>
<p class="p3">false</p>
<p class="p3">=&gt; (some? 1)</p>
<p class="p3">true</p>
<p class="p3">=&gt; (some? [])</p>
<p class="p3">true</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (doc nil?)</p>
<p class="p3">-------------------------</p>
<p class="p3">clojure.core/nil?</p>
<p class="p3">([x])</p>
<p class="p3"><span class="Apple-converted-space">  </span>Returns true if x is nil, false otherwise.</p>
<p class="p3">nil</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (doc some?)</p>
<p class="p3">-------------------------</p>
<p class="p3">clojure.core/some?</p>
<p class="p3">([x])</p>
<p class="p3"><span class="Apple-converted-space">  </span>Returns true if x is not nil, false otherwise.</p>
<p class="p3">nil</p>
<p class="p4"><br></p>
<p class="p2">We’ll have more to say about the <span class="s1">doc</span> function later.<span class="Apple-converted-space">  </span>For now, notice that the function returns <span class="s1">nil</span>.</p>
<p class="p3">=&gt; (and true false)</p>
<p class="p3"><b>false</b></p>
<p class="p3">=&gt; (and true true)</p>
<p class="p3"><b>true</b></p>
<p class="p3">=&gt; (and true true false)</p>
<p class="p3"><b>false</b></p>
<p class="p3">=&gt; (and true true true)</p>
<p class="p3"><b>true</b></p>
<p class="p3">=&gt; (or true false)</p>
<p class="p3"><b>true</b></p>
<p class="p3">=&gt; (or false false)</p>
<p class="p3"><b>false</b></p>
<p class="p3">=&gt; (or false true false)</p>
<p class="p3"><b>true</b></p>
<p class="p4"><br></p>
<p class="p2">Now let’s make some decisions.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (if true 1 2)</p>
<p class="p3"><b>1</b></p>
<p class="p3">=&gt; (if true 2 1)</p>
<p class="p3"><b>2</b></p>
<p class="p3">=&gt; (if true 1)</p>
<p class="p3"><b>1</b></p>
<p class="p3">=&gt; (if false 1 2)</p>
<p class="p3"><b>2</b></p>
<p class="p3">=&gt; (if false 2 1)</p>
<p class="p3"><b>1</b></p>
<p class="p3">=&gt; (if false 1)</p>
<p class="p3"><b>nil</b></p>
<p class="p4"><br></p>
<p class="p2">Take note of that last one, it can trip you up unless you are aware of it.<span class="Apple-converted-space">  </span>Notice also that <span class="s1">if</span> is a <i>function</i> that returns the selected value.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (when true 1)</p>
<p class="p3"><b>1</b></p>
<p class="p3">=&gt; (when false 1)</p>
<p class="p3"><b>nil</b></p>
<p class="p4"><br></p>
<p class="p2">Does <span class="s1">when</span> look like <span class="s1">if</span>?<span class="Apple-converted-space">  </span>Here’s where it differs.</p>
<p class="p3">=&gt; (when true 1 2 3)</p>
<p class="p3"><b>3</b></p>
<p class="p3">=&gt; (when true (print "hello, ") (print "world."))</p>
<p class="p3"><b>hello, world.nil</b></p>
<p class="p4"><br></p>
<p class="p2">The <span class="s1">when</span> function executes every statement in the list if the predicate is true.<span class="Apple-converted-space">  </span>The value returned is the value of the last statement executed.<span class="Apple-converted-space">  </span>The <span class="s1">when</span> function is a lot like an <span class="s1">if</span> with a <span class="s1">do</span>, which gathers several statements into one.<span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p3">=&gt; (if true (do (print "hi ") (println "there.")))</p>
<p class="p3"><b>hi there.</b></p>
<p class="p3"><b>nil</b></p>
<p class="p4"><br></p>
<p class="p2">Statements like these read better when they are indented.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (if true<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">     </span>(do<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">       </span>(print "hi ")<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">       </span>(println "there.")))</p>
<p class="p3"><b>hi there.</b></p>
<p class="p3"><b>nil</b></p>
<p class="p4"><br></p>
<p class="p2">Now let’s test for equality.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (= 1 1)</p>
<p class="p3"><b>true</b></p>
<p class="p3">=&gt; (= 2 2)</p>
<p class="p3"><b>true</b></p>
<p class="p3">=&gt; (= 2 1)</p>
<p class="p3"><b>false</b></p>
<p class="p3">=&gt; (= 1/2 1/2)</p>
<p class="p3"><b>true</b></p>
<p class="p3">=&gt; (= 1/2 2/4)</p>
<p class="p3"><b>true</b></p>
<p class="p3">=&gt; (= 1/3 (/ 1 3))</p>
<p class="p3"><b>true</b></p>
<p class="p3">=&gt; (not= 1 1)</p>
<p class="p3"><b>false</b></p>
<p class="p3">=&gt; (not= 1 2)</p>
<p class="p3"><b>true</b></p>
<p class="p4"><br></p>
<p class="p2">So far, so good.<span class="Apple-converted-space">  </span>But take care with numbers of different types.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (= 1 1.0)</p>
<p class="p3"><b>false</b></p>
<p class="p3">=&gt; (= 1/2 (/ 1 2.0))</p>
<p class="p3"><b>false</b></p>
<p class="p4"><br></p>
<p class="p2">And always remember that comparing floating point number for equality is risky, because floating point numbers have a limited number of digits to work with.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (= 1.0 1.0)</p>
<p class="p3"><b>true</b></p>
<p class="p3">=&gt; (def x (/ 1.0 3.0))</p>
<p class="p3">=&gt; (def y (* x x x x x x))</p>
<p class="p3">=&gt; (def z (* y 3 3 3 3 3 3))</p>
<p class="p3">=&gt; (= 1.0 z)</p>
<p class="p3"><b>false</b></p>
<p class="p3">=&gt; z</p>
<p class="p3"><b>0.9999999999999996</b></p>
<p class="p4"><br></p>
<p class="p2">Of course numbers aren’t the only things that can be compared for equality.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (= "string" "string")</p>
<p class="p3"><b>true</b></p>
<p class="p3">=&gt; (= "string" "strung")</p>
<p class="p3"><b>false</b></p>
<p class="p3">=&gt; (= [] [])</p>
<p class="p3"><b>true</b></p>
<p class="p3">=&gt; (= [1 2 3] [1 2 3])</p>
<p class="p3"><b>true</b></p>
<p class="p3">=&gt; (= [1 2 3] [4 5 6])</p>
<p class="p3"><b>false</b></p>
<p class="p3">=&gt; (= [1 2 3] '(1 2 3))</p>
<p class="p3"><b>true</b></p>
<p class="p4"><br></p>
<p class="p2">Sometimes we need to select more than one or two options.<span class="Apple-converted-space">  </span>For that we can use the <span class="s1">cond</span> function.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (cond true "hi" false "there")</p>
<p class="p3"><b>"hi"</b></p>
<p class="p3">=&gt; (cond false "hi" true "there")</p>
<p class="p3"><b>"there"</b></p>
<p class="p3">=&gt; (cond false "hi" false "there" true "Bob")</p>
<p class="p3"><b>"Bob"</b></p>
<p class="p3">=&gt; (cond false "hi" false "there" false "Bob")</p>
<p class="p3"><b>nil</b></p>
<p class="p4"><br></p>
<p class="p2">The first true wins.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (cond true "hi" false "there" true "Bob")</p>
<p class="p3"><b>"hi"</b></p>
<p class="p4"><br></p>
<p class="p2">Don’t worry about the <span class="s1">:else</span> below, that’s just a synonym for <span class="s1">true</span> in this context. <span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p3">=&gt; (cond false "hi" false "there" false "Bob" :else "else")</p>
<p class="p3"><b>"else"</b></p>
<p class="p4"><br></p>
<p class="p2">And, as always, a little indenting really helps the reader.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (cond<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">     </span>false "hi"<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">     </span>false "there"<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">     </span>false "Bob"<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">     </span>:else "else")</p>
<p class="p3"><b>"else"</b></p>
<p class="p4"><br></p>
<p class="p2">Now let’s put a few things together.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (defn check [x]<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">     </span>(cond<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">       </span>(= 0 x) "zero"<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">       </span>(= 1 x) "one"<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">       </span>(= 2 x) "two"<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">       </span>:else <span class="Apple-converted-space">  </span>"many"))</p>
<p class="p3">=&gt; (check 0)</p>
<p class="p3"><b>"zero"</b></p>
<p class="p3">=&gt; (check 1)</p>
<p class="p3"><b>"one"</b></p>
<p class="p3">=&gt; (check 2)</p>
<p class="p3"><b>"two"</b></p>
<p class="p3">=&gt; (check 3)</p>
<p class="p3"><b>"many"</b></p>
<p class="p4"><br></p>
<p class="p2">Those predicates can get pretty redundant, so we can use <span class="s1">condp</span> to make things a bit tidier. <span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p3">=&gt; (defn check2 [x]<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">     </span>(condp = x<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">       </span>0 "zero"<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">       </span>1 "one"<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">       </span>2 "two"<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">       </span>"many"))</p>
<p class="p3">=&gt; (check2 0)</p>
<p class="p3"><b>"zero"</b></p>
<p class="p3">=&gt; (check2 1)</p>
<p class="p3"><b>"one"</b></p>
<p class="p3">=&gt; (check2 2)</p>
<p class="p3"><b>"two"</b></p>
<p class="p3">=&gt; (check2 3)</p>
<p class="p3"><b>"many"</b></p>
<p class="p12"><br></p>
<p class="p2">The first argument to <span class="s1">condp</span> is a function that takes two arguments and returns a boolean value.<span class="Apple-converted-space">  </span>In this case the function was <span class="s1">=</span>.<span class="Apple-converted-space">  </span>The <span class="s1">condp</span> function calls that function with its second argument and then with the first element of each row in turn.<span class="Apple-converted-space">  </span>The first row to match causes the second element of that row to be returned.</p>
<p class="p2">Now let’s loop through a list.<span class="Apple-converted-space">  </span>One of the easiest ways to do that is with the <span class="s1">for</span> function.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (for [x [1 2 3]] x)</p>
<p class="p3"><b>(1 2 3)</b></p>
<p class="p4"><br></p>
<p class="p2">The first argument of the <span class="s1">for</span> function is a vector of <i>bindings</i>.<span class="Apple-converted-space">  </span>A binding is itself a vector that relates a variable to a value — or in this case a sequence of values.<span class="Apple-converted-space">  </span>The second argument of the <span class="s1">for</span> function is an expression that uses those bindings.<span class="Apple-converted-space">  </span>In this case that expression is simply <span class="s1">x</span>.<span class="Apple-converted-space">  </span>But, of course, it can be more interesting than that.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (for [x [1 2 3]] (inc x))</p>
<p class="p3"><b>(2 3 4)</b></p>
<p class="p4"><br></p>
<p class="p2">In this case the expression is <span class="s1">(inc x)</span>.<span class="Apple-converted-space">  </span>This may look a lot like <span class="s1">(map inc [1 2 3])</span>, but the next example will break that similarity.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (for [x [1 2 3] y [4 5 6]] [x y])</p>
<p class="p3">([1 4] [1 5] [1 6] [2 4] [2 5] [2 6] [3 4] [3 5] [3 6])</p>
<p class="p4"><br></p>
<p class="p2">When the <span class="s1">for</span> function is given more than one binding it loops through every possible combination.<span class="Apple-converted-space">  </span>The expression above simply puts the two bound values into a vector.</p>
<p class="p2">A common mistake that Clojure programmers make is to use the for function with an expression that doesn’t return a sensible value.<span class="Apple-converted-space">  </span>For example:</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (for [x '(3 4 5)] (prn x))</p>
<p class="p3"><b>(3</b></p>
<p class="p3"><b>4</b></p>
<p class="p3"><b>nil 5</b></p>
<p class="p3"><b>nil nil)</b></p>
<p class="p4"><br></p>
<p class="p2">We’ll learn why this appears so shuffled up in a later chapter; but the gist of the issue is that the <span class="s1">prn</span> function returns <span class="s1">nil</span>.<span class="Apple-converted-space">  </span>Thus, the <span class="s1">for</span> function returned <span class="s1">(nil nil nil)</span>, and when the REPL tried to print it got shuffled with the action of <span class="s1">prn</span> printing the values. <span class="Apple-converted-space"> </span></p>
<p class="p2">When you want to loop through a list, but you don’t care to gather the values you can use <span class="s1">doseq</span> instead; and it will still loop through all the values but will simply return <span class="s1">nil</span>. <span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p3">=&gt; (doseq [x '(3 4 5)] (prn x))</p>
<p class="p3"><b>3</b></p>
<p class="p3"><b>4</b></p>
<p class="p3"><b>5</b></p>
<p class="p3"><b>nil</b></p>
<p class="p4"><br></p>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 36.0px Palatino"><b>Exercises</b></h1>
<p class="p8"><b>1.<span class="Apple-tab-span">	</span>Quad. <span class="Apple-converted-space"> </span></b></p>
<p class="p9">The function <span class="s1">(Math/sqrt)</span> returns the square root of its argument.<span class="Apple-converted-space">  </span>Write a function named <span class="s1">quad</span> to solve for x in the quadratic equation 0=ax<span class="s2">2</span>+bx+c.<span class="Apple-converted-space">  </span>Use the quadratic formula (-b±sqrt(b<span class="s2">2</span>-4ac))/2a.<span class="Apple-converted-space">  </span>The results should look like this:</p>
<p class="p13"><br></p>
<p class="p3">=&gt; (quad 1 2 1)</p>
<p class="p3"><b>-1</b></p>
<p class="p3">=&gt; (quad 1 2 3)</p>
<p class="p3"><b>"imaginary"</b></p>
<p class="p3">=&gt; (quad 0 2 3)</p>
<p class="p3"><b>-3/2</b></p>
<p class="p3">=&gt; (quad 1 1 0)</p>
<p class="p3"><b>[0.0 -1.0]</b></p>
<p class="p3">=&gt; (quad 1 -0.25 -0.125)</p>
<p class="p3"><b>[0.5 -0.25]</b></p>
<p class="p4"><br></p>
<p class="p8"><b>2.<span class="Apple-tab-span">	</span>Fizzbuzz.<span class="Apple-converted-space"> </span></b></p>
<p class="p9">The function <span class="s1">(rem n d)</span> returns the remainder of <span class="s1">n</span> divided by <span class="s1">d</span>.<span class="Apple-converted-space">  </span>The function <span class="s1">(range a b)</span> returns a list of integers from <span class="s1">a</span> to <span class="s1">b</span>-1.<span class="Apple-converted-space">  </span>Write a function named <span class="s1">fizzbuzz</span> that takes a single argument.<span class="Apple-converted-space">  </span>The function returns a list of all the integers from 1 up to and including that argument, replacing every integer divisible by 3 with “fizz”, every integer divisible by 5 with “buzz”, and every integer divisible by both 3 and 5 with “fizzbuzz”.<span class="Apple-converted-space">  </span>The results, up to 20, should look like this:</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (fizzbuzz 20)</p>
<p class="p3">(1 2 "fizz" 4 "buzz" "fizz" 7 8 "fizz" "buzz" 11<span class="Apple-converted-space"> </span></p>
<p class="p3">"fizz" 13 14 "fizzbuzz" 16 17 "fizz" 19 "buzz")</p>
<p class="p4"><br></p>
<p class="p8"><b>3.<span class="Apple-tab-span">	</span>Distances.<span class="Apple-converted-space"> </span></b></p>
<p class="p9">First, study the output of <span class="s1">(doc for)</span>.<span class="Apple-converted-space">  </span>Then given the following data structure which defines a set of named points on the x-y plane:</p>
<p class="p14"><span class="s3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span></span>(def points [["O" 0 0] ["A" 1 1] ["B" 1 2] ["C" 2 3] ["D" 4 5]])</p>
<p class="p9">Remembering that the formula for the distance between two points is: <br>
<i><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>sqrt((x1-x2)</i><span class="s2"><i>2</i></span><i>+(y1-y2)</i><span class="s2"><i>2</i></span><i>)</i>.<br>
Write the function <span class="s1">distances</span>, and any other functions that you think will support it.<span class="Apple-converted-space">  </span>When you call <span class="s1">distances</span> with the <span class="s1">points</span> data structure above it should print one line for every pair of points showing the distance between them.<span class="Apple-converted-space">  </span>The output should look like this:</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (distances points)</p>
<p class="p3">O-A 1.4142135623730951</p>
<p class="p3">O-B 2.23606797749979</p>
<p class="p3">O-C 3.605551275463989</p>
<p class="p3">O-D 6.4031242374328485</p>
<p class="p3">A-O 1.4142135623730951</p>
<p class="p3">A-B 1.0</p>
<p class="p3">A-C 2.23606797749979</p>
<p class="p3">A-D 5.0</p>
<p class="p3">B-O 2.23606797749979</p>
<p class="p3">B-A 1.0</p>
<p class="p3">B-C 1.4142135623730951</p>
<p class="p3">B-D 4.242640687119285</p>
<p class="p3">C-O 3.605551275463989</p>
<p class="p3">C-A 2.23606797749979</p>
<p class="p3">C-B 1.4142135623730951</p>
<p class="p3">C-D 2.8284271247461903</p>
<p class="p3">D-O 6.4031242374328485</p>
<p class="p3">D-A 5.0</p>
<p class="p3">D-B 4.242640687119285</p>
<p class="p3">D-C 2.8284271247461903</p>
<p class="p3">nil</p>
<p class="p4"><br></p>
<h1 style="margin: 36.0px 0.0px 36.0px 0.0px; text-align: center; font: 48.0px Helvetica">Chapter 4</h1>
<h1 style="margin: 36.0px 0.0px 36.0px 0.0px; text-align: center; font: 48.0px Helvetica">A Touch of Math</h1>
<p class="p2">Our programs are going to get a bit longer now, so you might want to type them into an editor and then pasted them into the REPL. <span class="Apple-converted-space"> </span></p>
<p class="p2">Let’s start by computing factorials.<span class="Apple-converted-space">  </span>The factorial of the integer <i>x</i> is denoted by <i>x!</i> and is the product of all the integers from 1 to <i>x</i>.<span class="Apple-converted-space">  </span>Thus we could write the <span class="s1">fac</span> function as follows:</p>
<p class="p3"><br>
(defn fac [n] (apply * (range 1 (inc n))))</p>
<p class="p4"><br></p>
<p class="p2">However, as you’ll soon see, this doesn’t suit our purposes for this chapter.<span class="Apple-converted-space">  </span>Instead let’s write it like this:</p>
<p class="p4"><br></p>
<p class="p3">(defn fac<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-tab-span">	</span>([n] (fac n 1))</p>
<p class="p3"><span class="Apple-tab-span">	</span>([n f] (if (= n 1) f (fac (dec n) (* n f)))))</p>
<p class="p4"><br></p>
<p class="p2">This defines two functions.<span class="Apple-converted-space">  </span>The first <span class="s1">(fac n)</span> returns <i>n!</i>.<span class="Apple-converted-space">  </span>The second <span class="s1">(fac n f)</span> is a worker function that does the actual computation.<span class="Apple-converted-space">  </span>When two functions have the same name but have a different number of arguments we say that the two functions are <i>overloaded</i>. <span class="Apple-converted-space"> </span></p>
<p class="p2">Notice that the worker function calls itself.<span class="Apple-converted-space">  </span>When a function calls itself like that it is known as <i>recursion</i>.</p>
<p class="p2">Now if you follow the logic through you’ll see that <span class="s1">(fac n)</span> calls <span class="s1">(fac n 1)</span> which calls itself over and over, decrementing <span class="s1">n</span> each time until <span class="s1">(= n 1)</span> .<span class="Apple-converted-space">  </span>Some results are:</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (fac 1)</p>
<p class="p3">1</p>
<p class="p3">=&gt; (fac 2)</p>
<p class="p3">2</p>
<p class="p3">=&gt; (fac 3)</p>
<p class="p3">6</p>
<p class="p3">=&gt; (fac 10)</p>
<p class="p3">3628800</p>
<p class="p3">=&gt; (fac 20)</p>
<p class="p3">2432902008176640000</p>
<p class="p3">=&gt; (fac 21)</p>
<p class="p3">Execution error (ArithmeticException) at java.lang.Math/multiplyExact (Math.java:1032).</p>
<p class="p3">long overflow</p>
<p class="p4"><br></p>
<p class="p2">Why can’t we go past <i>20!</i>?<span class="Apple-converted-space">  </span>Because in order for computers to go fast, they limit the size of the numbers they usually manipulate.<span class="Apple-converted-space">  </span>But we can direct the computer to use bigger numbers so long as we don’t mind the computer going a little bit slower<a id="fnlink4"></a><a href="#fn4"><sup>[4]</sup></a>.<span class="Apple-converted-space">  </span>All we need to do is replace the <span class="s1">1</span> with <span class="s1">1N</span>. <span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p3">(defn fac<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">  </span>([n] (fac n 1N))</p>
<p class="p3"><span class="Apple-converted-space">  </span>([n f] (if (= n 1) f (fac (dec n) (* n f)))))</p>
<p class="p4"><br></p>
<p class="p2">Now we can calculate very large factorials indeed!</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (fac 21)</p>
<p class="p3">51090942171709440000N</p>
<p class="p3">=&gt; (fac 50)</p>
<p class="p3">30414093201713378043612608166064768844377641568960512000000000000N</p>
<p class="p3">=&gt; (fac 100)</p>
<p class="p3">9332621544394415268169923885626670049071596826438162146859296389521759999322<br>
9915608941463976156518286253697920827223758251185210916864000000000000000000000000N</p>
<p class="p4"><br></p>
<p class="p2">The difference between <span class="s1">1N</span> and <span class="s1">1</span> is just the type of the integer:</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (type 1)</p>
<p class="p3">java.lang.Long</p>
<p class="p3">=&gt; (type 1N)</p>
<p class="p3">clojure.lang.BigInt</p>
<p class="p4"><br></p>
<p class="p2"><span class="s1">Long</span> integers are big enough for most purposes, and when the computer uses them it can go fast.<span class="Apple-converted-space">  </span><span class="s1">BigInt</span> integers are as long as you need them to be.<span class="Apple-converted-space">  </span>They can be thousands<a id="fnlink5"></a><a href="#fn5"><sup>[5]</sup></a> of digits long.<span class="Apple-converted-space">  </span>But the computers slows down considerably when it uses them.<span class="Apple-converted-space">  </span>Let’s see this in action by using the <span class="s1">time</span> function.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (time (apply + (repeat 1000000 1N)))</p>
<p class="p3">"Elapsed time: 105.699372 msecs"</p>
<p class="p3">1000000N</p>
<p class="p3">=&gt; (time (apply + (repeat 1000000 1)))</p>
<p class="p3">"Elapsed time: 71.702522 msecs"</p>
<p class="p3">1000000</p>
<p class="p4"><br></p>
<p class="p2">Using <span class="s1">BigInt</span> cost us 34 milliseconds for a million additions.<span class="Apple-converted-space">  </span>So we’re not going to worry about it too much here.<span class="Apple-converted-space">  </span>And, anyway, we’re going to need those big numbers for what we are going to do next.<span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p3">=&gt; (/ (fac 20) (fac 30))</p>
<p class="p3"><b>1/109027350432000</b></p>
<p class="p4"><br></p>
<p class="p2">Rational numbers have no limits on the number of digits they use.<span class="Apple-converted-space">  </span>This can be very useful for preserving the precision of your calculations.</p>
<p class="p2">There is another way to preserve the precision of calculations; but it’s a bit trickier.<span class="Apple-converted-space">  </span>You can use the <span class="s1">BigDecimal</span> type. <span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p3">=&gt; (type 1M)</p>
<p class="p3">java.math.BigDecimal</p>
<p class="p3">=&gt; (/ 1M 2)</p>
<p class="p3">0.5M</p>
<p class="p3">=&gt; (+ 1M 1e-50M)</p>
<p class="p3">1.00000000000000000000000000000000000000000000000001M</p>
<p class="p3">=&gt; (/ 1M 3)</p>
<p class="p3">Execution error (ArithmeticException) at java.math.BigDecimal/divide (BigDecimal.java:1783).</p>
<p class="p3">Non-terminating decimal expansion; no exact representable decimal result.</p>
<p class="p4"><br></p>
<p class="p2">There is no practical limit on the number of decimal places a BigDec can hold.<span class="Apple-converted-space">  </span>However, it will refuse to hold a repeating decimal because they have an infinite number of digits.<span class="Apple-converted-space">  </span>So you can use <span class="s1">BigDec</span> only when you know that your decimals will terminate, or…you can cheat.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (with-precision 20 (/ 1M 3))</p>
<p class="p3"><b>0.33333333333333333333M</b></p>
<p class="p4"><br></p>
<p class="p2">When you cheat like this, you lose precision.<span class="Apple-converted-space">  </span>So we’re not going to be doing that in this chapter.<span class="Apple-converted-space">  </span>We want precision!<span class="Apple-converted-space">  </span>So we’ll use <span class="s1">BigInt</span> and <span class="s1">Ratio</span> types.</p>
<p class="p2">So now let’s compute powers of numbers with high precision.</p>
<p class="p4"><br></p>
<p class="p3">(defn pow</p>
<p class="p3"><span class="Apple-converted-space">  </span>([n x] (pow n x 1N))</p>
<p class="p3"><span class="Apple-converted-space">  </span>([n x p] (if (&lt; x 1) p (pow n (dec x) (* p n)))))</p>
<p class="p4"><br></p>
<p class="p2">Once again we are using an overloaded recursive function.<span class="Apple-converted-space">  </span>The result is:</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (pow 2 5)</p>
<p class="p3">32N</p>
<p class="p3">=&gt; (pow 2 100)</p>
<p class="p3">1267650600228229401496703205376N</p>
<p class="p3">=&gt; (pow 10 30)</p>
<p class="p3">1000000000000000000000000000000N</p>
<p class="p4"><br></p>
<p class="p2">We can use this function with <span class="s1">BigDec</span> to preserve precision of decimals taken to powers. <span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p3">=&gt; (pow 1.6 10)</p>
<p class="p3">109.95116277760006</p>
<p class="p3">=&gt; (pow 1.6M 10)</p>
<p class="p3">109.9511627776M</p>
<p class="p3">=&gt; (pow 1.6 20)</p>
<p class="p3">12089.258196146306</p>
<p class="p3">=&gt; (pow 1.6M 20)</p>
<p class="p3">12089.25819614629174706176M</p>
<p class="p4"><br></p>
<p class="p2">Notice that when we use <span class="s1">Double</span> types we lose precision; but when we use <span class="s1">BigDec</span> types we keep the precision.<span class="Apple-converted-space">  </span>Again, <span class="s1">Double</span> types are good enough for most purposes, and are faster than <span class="s1">BigDec</span> types; but sometimes precision is more important than speed.</p>
<p class="p2">So, what can we do with powers and factorials?<span class="Apple-converted-space">  </span>We can use a Taylor<a id="fnlink6"></a><a href="#fn6"><sup>[6]</sup></a> series to approximate the values of transcendental functions.<span class="Apple-converted-space">  </span>Let’s create a function to calculate the trigonometric sine of an angle.</p>
<p class="p2">The Taylor series for <i>sin(x)</i> is <i>x-x</i><span class="s2"><i>3</i></span><i>/3!+x</i><span class="s2"><i>5</i></span><i>/5!-x</i><span class="s2"><i>7</i></span><i>/7!</i>… where <i>x</i> is in radians.</p>
<p class="p2">So first, let’s create a function that maps the exponent to 1 or -1 depending on the sign of the term. <span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p3">(defn sin-term-sign [n] (- (- (rem n 4) 2)))</p>
<p class="p3">=&gt; (range 1 10 2)</p>
<p class="p3"><b>(1 3 5 7 9)</b></p>
<p class="p3">=&gt; (map sin-term-sign (range 1 10 2))</p>
<p class="p3"><b>(1 -1 1 -1 1)</b></p>
<p class="p4"><br></p>
<p class="p2">Now let’s write a function that calculates the value of the n<span class="s2">th</span> term. <span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p3">(defn sin-term [x n]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(* (sin-term-sign n)</p>
<p class="p3"><span class="Apple-converted-space">    </span>(/ (pow x n) (fac n))))</p>
<p class="p3">=&gt; (sin-term 1 1)</p>
<p class="p3"><b>1N</b></p>
<p class="p3">=&gt; (sin-term 1 3)</p>
<p class="p3"><b>-1/6</b></p>
<p class="p3">=&gt; (sin-term 1 5)</p>
<p class="p3"><b>1/120</b></p>
<p class="p4"><br></p>
<p class="p2">Nice rational numbers. <span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p3">(defn sin [x n]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(let [ns (range 1 n 2)</p>
<p class="p3"><span class="Apple-converted-space">        </span>terms (map (fn [n] (sin-term x n)) ns)]</p>
<p class="p3"><span class="Apple-converted-space">    </span>(apply + terms)))</p>
<p class="p4"><br></p>
<p class="p2">The <span class="s1">let</span> function takes a vector of bindings that sets the values of the named variables.<span class="Apple-converted-space">  </span>The <span class="s1">fn</span> function is similar to <span class="s1">defn</span> except that it returns an <i>anonymous function</i>.<span class="Apple-converted-space">  </span>Thus <span class="s1">ns</span> is a list of the exponents up to <span class="s1">n</span>, and <span class="s1">terms</span> is a list of all the terms of the Taylor series up to <span class="s1">n</span>. <span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p3">=&gt; (sin 1 5)</p>
<p class="p3">5/6</p>
<p class="p3">=&gt; (sin 1 10)</p>
<p class="p3">305353/362880</p>
<p class="p3">=&gt; (sin 1 20)</p>
<p class="p3">102360822438075317/121645100408832000</p>
<p class="p4"><br></p>
<p class="p2">It should now be clear how nice rational numbers are for preserving precision.<span class="Apple-converted-space">  </span>On the other hand, they aren’t particularly useful in human terms.<span class="Apple-converted-space">  </span>I mean, nobody really wants to know that the sine of 1 radian is 102360822438075317÷121645100408832000. But we can fix that by converting the rational number to a <span class="s1">BigDecimal</span>. <span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p3">=&gt; (with-precision 20 (bigdec (sin 1 20)))</p>
<p class="p3"><b>0.84147098480789650663M</b></p>
<p class="p4"><br></p>
<p class="p2">That’s a pretty good estimate of <i>sin(1)</i>.<span class="Apple-converted-space">  </span>It’s better than the calculator on my iPhone.<span class="Apple-converted-space">  </span>It’s also a little better than the standard <span class="s1">Math/sin</span> function. <span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p3">=&gt; (Math/sin 1)</p>
<p class="p3">0.8414709848078965</p>
<p class="p4"><br></p>
<p class="p2">So let’s try something other than 1.<span class="Apple-converted-space">  </span>The sine of π is zero.<span class="Apple-converted-space">  </span>The standard function, and our function are both pretty doggone close to zero.<span class="Apple-converted-space">  </span>And our function computes <i>sin(π/2) = 1</i> to within very tight tolerance.</p>
<p class="p3">=&gt; (Math/sin Math/PI)</p>
<p class="p3">1.2246467991473532E-16</p>
<p class="p3">=&gt; (sin Math/PI 30)</p>
<p class="p3">-1.1097266936275162E-16</p>
<p class="p3">=&gt; (sin (/ Math/PI 2) 30)</p>
<p class="p3">1.0000000000000002</p>
<p class="p4"><br></p>
<p class="p2">However, as you can see below, our function does have some limitations<span class="Apple-converted-space">  </span>It’s really only accurate in the range of -π to π. <span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p3">=&gt; (sin 100 30)</p>
<p class="p3">17627235963358095945458935270121351192759970700/16864322650412944707</p>
<p class="p3">=&gt; (with-precision 20 (bigdec (sin 100 30)))</p>
<p class="p3">1.0452383015173437945E+27M</p>
<p class="p4"><br></p>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 36.0px Palatino"><b>Exercises</b></h1>
<p class="p8"><b>1.<span class="Apple-tab-span">	</span>Arctangent.</b></p>
<p class="p9">Write the <span class="s1">arctan</span> function.<span class="Apple-converted-space">  </span>The Taylor formula is <i>x-x3/3+x5/5-x7/7</i>…<span class="Apple-converted-space">  </span>It turns out that if you multiply <i>arctan(1)</i> by 4 it equals π.<span class="Apple-converted-space">  </span>How close to π can you get?<span class="Apple-converted-space">  </span>How many terms does it take to get to 3.14…</p>
<p class="p8"><b>2.<span class="Apple-tab-span">	</span>Generate π.</b></p>
<p class="p9">You may have found that last exercise a bit frustrating.<span class="Apple-converted-space">  </span>Perhaps you encountered a stack overflow error, or perhaps it just ran for too long.<span class="Apple-converted-space">  </span>So let’s fix that.<span class="Apple-converted-space">  </span>Let’s generate π by multiplying <i>arctan(1)</i> by 4, but this time let’s be smart about it.<span class="Apple-converted-space">  </span>We do not need to raise 1 to any power.<span class="Apple-converted-space">  </span>And we do not need to use rational numbers because they can be very slow.<span class="Apple-converted-space">  </span>So see if you can change your solution to quickly generate π to five decimal places.<span class="Apple-converted-space">  </span>3.14159…<span class="Apple-converted-space">  </span>Can you go farther?</p>
<p class="p8"><b>3.<span class="Apple-tab-span">	</span>Seriously π.</b></p>
<p class="p9">OK, let’s stop pussyfooting around here, Batman.<span class="Apple-converted-space">  </span>Let’s generate π to 1,000 decimals.<span class="Apple-converted-space">  </span>That would take forever with our last algorithm, so we’ll need something better.<span class="Apple-converted-space">  </span>The problem is that 1 in the numerator.<span class="Apple-converted-space">  </span>Those terms simply do not converge very quickly.<span class="Apple-converted-space">  </span>So we need to get numerators that are a lot smaller than 1, so that their powers are <i>much</i> much smaller than 1.<span class="Apple-converted-space">  </span>It turns out that: <br>
<i>π/4 = 12arctan(1/38)+20arctan(1/57)+7arctan(1/239)+24arctan(1/268)</i>. <br>
Those <span class="s1">arctan</span>s should converge pretty rapidly.<span class="Apple-converted-space">  </span>So, put the <span class="s1">arctan</span> function back the way it was for exercise 1.<span class="Apple-converted-space">  </span>Yes, the rational numbers are a bit slow; but with this algorithm it shouldn’t matter.<span class="Apple-converted-space">  </span>Now write the function <span class="s1">pi-gen</span> that takes a single argument which is the number of digits to calculate.<span class="Apple-converted-space">  </span>You should quickly get a result like this:</p>
<p class="p4"><br></p>
<p class="p15">=&gt; (pi-gen 100)</p>
<p class="p15">3.141592653589793238462643383279502884197169399375105820974944592307816406286208998628034825342117068M</p>
<p class="p4"><br></p>
<p class="p9">Now try <span class="s1">(pi-gen 1000)</span>.<span class="Apple-converted-space">  </span>Can you see the string of six nines about three quarters<a id="fnlink7"></a><a href="#fn7"><sup>[7]</sup></a> of the way through? <span class="Apple-converted-space"> </span></p>
<p class="p9">Try to figure out how many decimals of π you can calculate in one hour of computer time. <span class="Apple-converted-space"> </span></p>
<p class="p11"><br></p>
<h1 style="margin: 36.0px 0.0px 36.0px 0.0px; text-align: center; font: 48.0px Helvetica">Chapter 5</h1>
<h1 style="margin: 36.0px 0.0px 36.0px 0.0px; text-align: center; font: 48.0px Helvetica">Reductions and Threads</h1>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 36.0px Palatino"><b>Anonymous Functions</b></h1>
<p class="p2">In the previous chapter we introduced the concept of <i>anonymous functions</i>.<span class="Apple-converted-space">  </span>For example, the following is an anonymous function that returns the square of its argument.</p>
<p class="p4"><br></p>
<p class="p3">(fn [x] (* x x))</p>
<p class="p4"><br></p>
<p class="p2">The <span class="s1">fn</span> returns that function as a value.<span class="Apple-converted-space">  </span>This means we can assign that value to a variable as follows:</p>
<p class="p4"><br></p>
<p class="p3">(def square (fn [x] (* x x)))</p>
<p class="p3">=&gt; (square 2)</p>
<p class="p3"><b>4</b></p>
<p class="p4"><br></p>
<p class="p2">Look closely, that’s a <span class="s1">def</span> not a <span class="s1">defn</span>.<span class="Apple-converted-space">  </span>In fact, the statement above is pretty much what <span class="s1">defn</span> does. <span class="Apple-converted-space"> </span></p>
<p class="p2">At this point I need to confess that I have been deliberately misleading you about something.<span class="Apple-converted-space">  </span>I have been stating that the <span class="s1">f</span> in a structure like <span class="s1">(f x)</span> is a function.<span class="Apple-converted-space">  </span>That’s not always the case.<span class="Apple-converted-space">  </span>Sometimes that <span class="s1">f</span> might be a macro, like <span class="s1">defn</span>.<span class="Apple-converted-space">  </span>Sometimes it might be a <i>special form,</i> like <span class="s1">fn</span>.<span class="Apple-converted-space">  </span>It’s too soon to go into the details; but I thought it wise come clean about this before you run into it unprepared.</p>
<p class="p2">Special forms, like <span class="s1">fn</span>, are actually part of the Clojure language.<span class="Apple-converted-space">  </span>The job of <span class="s1">fn</span> is to create and return an anonymous function. <span class="Apple-converted-space"> </span></p>
<p class="p2">Macros are functions that translate their arguments into Clojure syntax.<span class="Apple-converted-space">  </span>The macro, <span class="s1">defn</span>, is a function that translates its arguments into a Clojure statement using the <span class="s1">def</span> and <span class="s1">fn</span> special forms to create a named function. <span class="Apple-converted-space"> </span></p>
<p class="p14"><span class="s3">So the </span>defn<span class="s3"> macro translates </span>(defn square [x] (* x x))<span class="s3"> into </span>(def square (fn [x] (* x x)))<span class="s3">.</span></p>
<p class="p2">When would you use an anonymous function?<span class="Apple-converted-space">  </span>Often we use them as arguments to functions like <span class="s1">map</span> and <span class="s1">filter</span>.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (map (fn [x] (* x x x)) [1 2 3])</p>
<p class="p3"><b>(1 8 27)</b></p>
<p class="p4"><br></p>
<p class="p2">Some folks find that to be a little wordy, or inconvenient.<span class="Apple-converted-space">  </span>So there is another way to specify an anonymous function:</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (map #(* % % %) [1 2 3])</p>
<p class="p3"><b>(1 8 27)</b></p>
<p class="p4"><br></p>
<p class="p2">The <span class="s1">#()</span> syntax is known as the <i>dispatch reader macro</i>.<span class="Apple-converted-space">  </span>Reader macros are conveniences implemented in the part of Clojure that reads in the program.<span class="Apple-converted-space">  </span>The dispatch reader macro converts the #(* % % %) syntax into (fn [x] (* x x x)).<span class="Apple-converted-space">  </span>Don’t worry overmuch about special forms, macros, and reader macros.<span class="Apple-converted-space">  </span>We’ll dig more deeply into them later.<span class="Apple-converted-space"> </span></p>
<p class="p2">In the mean time, let’s compare the three ways to define a typical function:</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (def midway (fn [a b] (/ (+ a b) 2)))</p>
<p class="p3">=&gt; (midway 6 9)</p>
<p class="p3"><b>15/2</b></p>
<p class="p3">=&gt; (defn midway [a b] (/ (+ a b) 2))</p>
<p class="p3">=&gt; (midway 6 12)</p>
<p class="p3"><b>9</b></p>
<p class="p3">=&gt; (def midway #(/ (+ %1 %2) 2))</p>
<p class="p3">=&gt; (midway 3 7)</p>
<p class="p3"><b>5</b></p>
<p class="p4"><br></p>
<p class="p2">The first is pure Clojure since it doesn’t rely on any macros or reader macros.<span class="Apple-converted-space">  </span>The second is the most common, it’s what most programmers expect to see.<span class="Apple-converted-space">  </span>The third is the most concise, but most programmers would wrinkle up their nose if they saw it done that way.<span class="Apple-converted-space"> </span></p>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px Palatino"><b>Reduce<span class="Apple-converted-space"> </span></b></h2>
<p class="p2">Speaking of multiple ways to do things, consider this:</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (apply + [1 2 3])</p>
<p class="p3"><b>6</b></p>
<p class="p3">=&gt; (reduce + [1 2 3])</p>
<p class="p3"><b>6</b></p>
<p class="p4"><br></p>
<p class="p2">These two functions appear to do the same thing — but they do it in two very different ways.<span class="Apple-converted-space">  </span>The above <span class="s1">apply</span> is equivalent to <span class="s1">(+ 1 2 3)</span>, but the <span class="s1">reduce</span> is equivalent to <span class="s1">(+ (3 (+ 1 2))</span>.<span class="Apple-converted-space">  </span>The first argument of <span class="s1">reduce</span> is a function (<span class="s1">f</span>) that takes two arguments.<span class="Apple-converted-space">  </span>The second argument is a list.<span class="Apple-converted-space">  </span>The <span class="s1">reduce</span> function applies the first two elements of the list to <span class="s1">f</span>, and then applies the result and the next element of the list to <span class="s1">f</span> again.<span class="Apple-converted-space">  </span>This continues until the list is exhausted.</p>
<p class="p14"><span class="s3">So </span>(reduce + [1 2 3 4 5])<span class="s3"> is equivalent to </span>(+ 5 (+ 4 (+ 3 (+ 1 2))))<span class="s3">. <span class="Apple-converted-space"> </span></span></p>
<p class="p2">Now consider using <span class="s1">midway</span> and <span class="s1">reduce</span> together:</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (reduce midway [2 3])</p>
<p class="p3"><b>5/2</b></p>
<p class="p4"><br></p>
<p class="p2">No surprise there.<span class="Apple-converted-space">  </span>5/2 is midway between 2 and 3.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (reduce midway [2 3 4])</p>
<p class="p3"><b>13/4</b></p>
<p class="p4"><br></p>
<p class="p2">Perhaps that one surprised you, but consider<span class="Apple-converted-space">  </span><span class="s1">(midway 4 (midway 2 3))</span> is the midpoint between 5/2 and 4, and that equals 13/4.<span class="Apple-converted-space">  </span>The next two should not surprise you.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (reduce midway [2 3 4 5])</p>
<p class="p3"><b>33/8</b></p>
<p class="p3">=&gt; (reduce midway [0 2 3 4 5])</p>
<p class="p3"><b>4</b></p>
<p class="p3">=&gt; (reduce midway 0 [2 3 4 5])</p>
<p class="p3"><b>4</b></p>
<p class="p4"><br></p>
<p class="p2">The last two are equivalent. The extra argument is a convenience in case you want to prepend a starting value to the list as an initial value.</p>
<p class="p2">Now consider this nifty function which returns all the intermediate values of <span class="s1">reduce</span>.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (reductions midway [1 2 3 4 5])</p>
<p class="p3"><b>(1 3/2 9/4 25/8 65/16)</b></p>
<p class="p4"><br></p>
<p class="p2">You might be wondering when something like that would ever be useful.<span class="Apple-converted-space">  </span>My only answer to that is — you’ll be surprised.</p>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 36.0px Palatino"><b>Threading</b></h1>
<p class="p2">Now let’s look at another convenient macro — the <i>threading</i> macro.<span class="Apple-converted-space">  </span>Let’s say we want to find the reduced midway between the squares of the first ten integers.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (reduce midway (map square (range 10)))</p>
<p class="p3"><b>33789/512</b></p>
<p class="p4"><br></p>
<p class="p2">Does that seem inside-out to you?<span class="Apple-converted-space">  </span>If so, try this:</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (-&gt;&gt; (range 10) (map square) (reduce midway))</p>
<p class="p3"><b>33789/512</b></p>
<p class="p4"><br></p>
<p class="p2">The threading macro simply translates <span class="s1">(-&gt;&gt; (range 10) (map square) (reduce midway))</span> into<span class="Apple-converted-space">  </span><span class="s1">(reduce midway (map square (range 10)))</span>.<span class="Apple-converted-space">  </span>Some people find the threaded syntax to be more intuitive since time seems to move from left to right. <span class="Apple-converted-space"> </span></p>
<p class="p2">For example, the above could be read in chronological order as:</p>
<ol class="ol1">
  <li class="li2">Create a list of the first ten integers.</li>
  <li class="li2">Map it through <span class="s1">square</span>.</li>
  <li class="li2">Reduce it using <span class="s1">midway</span>.</li>
</ol>
<p class="p2">This chronological intuition sometimes becomes more pronounced the longer the chain of functions is</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (-&gt;&gt; (range 10) (map square) (reductions midway))</p>
<p class="p3">(0 1/2 9/4 45/8 173/16 573/32 1725/64 4861/128 13053/256 33789/512)</p>
<p class="p3">=&gt; (-&gt;&gt; (range 10) (map square) (reductions midway) (map double))</p>
<p class="p3">(0.0 0.5 2.25 5.625 10.8125 17.90625 26.953125 37.9765625 50.98828125 65.994140625)</p>
<p class="p4"><br></p>
<p class="p2">There are two threading macros.<span class="Apple-converted-space">  </span>The <span class="s1">-&gt;&gt;</span> macro passes each result into the <i>last</i> argument of the next function in the thread.<span class="Apple-converted-space">  </span>Thus <span class="s1">(-&gt;&gt; a (f 1))</span> is translated into <span class="s1">(f 1 a)</span>.<span class="Apple-converted-space">  </span>The <span class="s1">-&gt;</span> macro passes each result into the <i>first</i> argument of the next function in the thread.<span class="Apple-converted-space">  </span>Thus <span class="s1">(-&gt; a (f 1))</span> is translated into <span class="s1">(f a 1)</span>.</p>
<p class="p2">Here’s a use of threading, reduce, and anonymous functions for you to ponder.<span class="Apple-converted-space">  </span>It calculates the standard deviation of a list of numbers.</p>
<p class="p4"><br></p>
<p class="p3">(defn mean [l] (/ (reduce + l) (count l)))</p>
<p class="p3">(defn sigma [l] (let [u (mean l)] (-&gt;&gt; l (map #(- % u)) (map square) mean Math/sqrt)))</p>
<p class="p3">=&gt; (sigma [1 2 3 4 5])</p>
<p class="p3"><b>1.4142135623730951</b></p>
<p class="p4"><br></p>
<p class="p2">If you found that sigma function a bit hard to read, consider this version:</p>
<p class="p4"><br></p>
<p class="p3">(defn sigma [l]<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">  </span>(let [u (mean l)]<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">    </span>(-&gt;&gt; l<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">         </span>(map #(- % u))</p>
<p class="p3"><span class="Apple-converted-space">         </span>(map square)</p>
<p class="p3"><span class="Apple-converted-space">         </span>mean<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">         </span>Math/sqrt)))</p>
<p class="p4"><br></p>
<p class="p2">Sometimes a little bit of formatting can work wonders.</p>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 36.0px Palatino"><b>Exercises</b></h1>
<p class="p8"><b>1.<span class="Apple-tab-span">	</span>Unthread.</b></p>
<p class="p9">Rewrite the sigma function without threading and without anonymous functions.</p>
<p class="p8"><b>2.<span class="Apple-tab-span">	</span>Popularity.</b></p>
<p class="p9">The popularity of a movie is calculated as the sum of the number of people who attend it each day plus half the previous day’s popularity.<span class="Apple-converted-space">  </span>What is the popularity of <br>
<span class="Apple-tab-span">	</span><span class="s1">[100 150 90 200 120 150 90]</span></p>
<p class="p8"><b>3.<span class="Apple-tab-span">	</span>Ships.</b></p>
<p class="p9">There is a ship on a very flat ocean.<span class="Apple-converted-space">  </span>It’s position is represented by <span class="s1">[x y]</span>.<span class="Apple-converted-space">  </span>The ship starts out motionless at <span class="s1">[0 0]</span>.<span class="Apple-converted-space">  </span>There is a vector of thrusts, one for each “tick” of time.<span class="Apple-converted-space">  </span>Each thrust is a vector of <span class="s1">[fx fy]</span> that describes the increase of velocity per tick in the x and y directions created by the thrust.<span class="Apple-converted-space">  </span>What is the position and velocity of the ship after the thrust vector of <span class="s1">[[1 1] [0 0] [2 0] [-1 2] [-1 -1]]</span> has been applied</p>
<p class="p12"><br></p>
<p class="p12"><br></p>
<p class="p17"><br></p>
<h1 style="margin: 36.0px 0.0px 36.0px 0.0px; text-align: center; font: 48.0px Helvetica">Chapter 6</h1>
<h1 style="margin: 36.0px 0.0px 36.0px 0.0px; text-align: center; font: 48.0px Helvetica">The Keymaster and The Mapkeeper</h1>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 36.0px Palatino"><b>Maps</b></h1>
<p class="p4"><br></p>
<p class="p3">(def m {"one" 1 "two" 2})</p>
<p class="p3">=&gt; m</p>
<p class="p3"><b>{"one" 1, "two" 2}</b></p>
<p class="p3">=&gt; (type m)</p>
<p class="p3"><b>clojure.lang.PersistentArrayMap</b></p>
<p class="p3">=&gt; (get m "one")</p>
<p class="p3"><b>1</b></p>
<p class="p3">=&gt; (get m "two")</p>
<p class="p3"><b>2</b></p>
<p class="p3">=&gt; (get m "three")</p>
<p class="p3"><b>nil</b></p>
<p class="p3">=&gt; (get m "three" "none")</p>
<p class="p3"><b>"none"</b></p>
<p class="p4"><br></p>
<p class="p2">I think that’s pretty self-descriptive.<span class="Apple-converted-space">  </span>The <span class="s1">{key value}</span> syntax describes a key-value map.<span class="Apple-converted-space">  </span>You can use <span class="s1">get</span> to get the <span class="s1">value</span> by using the associated <span class="s1">key</span>.<span class="Apple-converted-space">  </span>And you can supply a default value for the case when no such <span class="s1">key</span> exists.<span class="Apple-converted-space"> </span></p>
<p class="p2">The following syntax may be a bit more surprising.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (m "one")</p>
<p class="p3"><b>1</b></p>
<p class="p3">=&gt; (m "two")</p>
<p class="p3"><b>2</b></p>
<p class="p3">=&gt; (m "three")</p>
<p class="p3"><b>nil</b></p>
<p class="p3">=&gt; (m "three" "none")</p>
<p class="p3"><b>"none"</b></p>
<p class="p4"><br></p>
<p class="p2">This is one of many shorthand conveniences that Clojure offers.<span class="Apple-converted-space">  </span>Even though <span class="s1">m</span> is not a function, Clojure considers a map to be a function that operates like <span class="s1">get</span>. <span class="Apple-converted-space"> </span></p>
<p class="p2">There are many functions that will inspect a map.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (keys m)</p>
<p class="p3"><b>("one" "two")</b></p>
<p class="p3">=&gt; (vals m)</p>
<p class="p3"><b>(1 2)</b></p>
<p class="p3">=&gt; (contains? m "one")</p>
<p class="p3"><b>true</b></p>
<p class="p3">=&gt; (contains? m "two")</p>
<p class="p3"><b>true</b></p>
<p class="p3">=&gt; (contains? m 1)</p>
<p class="p3"><b>false</b></p>
<p class="p3">=&gt; (contains? m 2)</p>
<p class="p3"><b>false</b></p>
<p class="p3">=&gt; (contains? m "three")</p>
<p class="p3"><b>false</b></p>
<p class="p3">=&gt; (find m "one")</p>
<p class="p3"><b>["one" 1]</b></p>
<p class="p4"><br></p>
<p class="p2">That last one is a bit interesting.<span class="Apple-converted-space">  </span>It looks like it returns a vector.<span class="Apple-converted-space">  </span>But it actually returns a <span class="s1">MapEntry</span>.<span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p3">=&gt; (type (find m "one"))</p>
<p class="p3"><b>clojure.lang.MapEntry</b></p>
<p class="p3">=&gt; (find m "two")</p>
<p class="p3"><b>["two" 2]</b></p>
<p class="p3">=&gt; (find m "three")</p>
<p class="p3"><b>nil</b></p>
<p class="p3">=&gt; (first m)</p>
<p class="p3"><b>["one" 1]</b></p>
<p class="p3">=&gt; (type (first m))</p>
<p class="p3"><b>clojure.lang.MapEntry</b></p>
<p class="p3">=&gt; (second m)</p>
<p class="p3"><b>["two" 2]</b></p>
<p class="p3">=&gt; (type (second m))</p>
<p class="p3"><b>clojure.lang.MapEntry</b></p>
<p class="p3">=&gt; (key (first m))</p>
<p class="p3"><b>"one"</b></p>
<p class="p3">=&gt; (val (first m))</p>
<p class="p3"><b>1</b></p>
<p class="p4"><br></p>
<p class="p2">From this we can infer that a map is just a sequence of <span class="s1">MapEntry</span>s which can be queried with the <span class="s1">key</span> and <span class="s1">val</span> functions.<span class="Apple-converted-space">  </span>Again, <span class="s1">MapEntry</span>s look like vectors.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (def me (first m))</p>
<p class="p3">=&gt; me</p>
<p class="p3"><b>["one" 1]</b></p>
<p class="p3">=&gt; (key me)</p>
<p class="p3"><b>"one"</b></p>
<p class="p3">=&gt; (val me)</p>
<p class="p3"><b>1</b></p>
<p class="p3">=&gt; (first me)</p>
<p class="p3"><b>"one"</b></p>
<p class="p3">=&gt; (second me)</p>
<p class="p3"><b>1</b></p>
<p class="p4"><br></p>
<p class="p2"><span class="s1">MapEntry</span>s seem to behave like vectors too.<span class="Apple-converted-space">  </span>But <span class="s1">key</span> and <span class="s1">val</span> don’t work on vectors. <span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p3">=&gt; (def not-me ["one" 1])</p>
<p class="p3">=&gt; (first not-me)</p>
<p class="p3">"one"</p>
<p class="p3">=&gt; (second not-me)</p>
<p class="p3">1</p>
<p class="p3">=&gt; (key not-me)</p>
<p class="p3">Execution error (ClassCastException) at user/eval612 (REPL:1).</p>
<p class="p3">class clojure.lang.PersistentVector cannot be cast to class java.util.Map$Entry<span class="Apple-converted-space"> </span></p>
<p class="p3">=&gt; (val not-me)</p>
<p class="p3">Execution error (ClassCastException) at user/eval614 (REPL:1).</p>
<p class="p3">class clojure.lang.PersistentVector cannot be cast to class java.util.Map$Entry<span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p2">I guess that’s just a bit of type safety of something…</p>
<p class="p2">Anyway since maps are sequences…</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (map #(str (first %) ":" (second %)) m)</p>
<p class="p3"><b>("one:1" "two:2")</b></p>
<p class="p3">=&gt; (-&gt;&gt; m (map #(str (first %) ":" (second %))))</p>
<p class="p3"><b>("one:1" "two:2")</b></p>
<p class="p4"><br></p>
<p class="p2">Notice that it is the <span class="s1">MapEntry</span> getting fed into the <span class="s1">%</span> of the anonymous function.</p>
<p class="p2">OK, now let’s modify the map.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (assoc m "three" 3)</p>
<p class="p3">{"one" 1, "two" 2, "three" 3}</p>
<p class="p3">=&gt; m</p>
<p class="p3">{"one" 1, "two" 2}</p>
<p class="p3">=&gt; (def m2 (assoc m "three" 3))</p>
<p class="p3">=&gt; m2</p>
<p class="p3">{"one" 1, "two" 2, "three" 3}</p>
<p class="p3">=&gt; m</p>
<p class="p3">{"one" 1, "two" 2}</p>
<p class="p3">=&gt; (dissoc m2 "three")</p>
<p class="p3">{"one" 1, "two" 2}</p>
<p class="p3">=&gt; m2</p>
<p class="p3">{"one" 1, "two" 2, "three" 3}</p>
<p class="p4"><br></p>
<p class="p2">Welcome to functional programming.<span class="Apple-converted-space">  </span>You cannot modify the map.<span class="Apple-converted-space">  </span>Indeed, you cannot modify any variable<a id="fnlink8"></a><a href="#fn8"><sup>[8]</sup></a>.<span class="Apple-converted-space">  </span>However, you can create new variables from old ones.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (update m "one" inc)</p>
<p class="p3"><b>{"one" 2, "two" 2}</b></p>
<p class="p4"><br></p>
<p class="p2">The <span class="s1">update</span> function uses the passed in function to modify the value.<span class="Apple-converted-space">  </span>This is more convenient than the more obtuse:</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (assoc m "one" (inc (m "one")))</p>
<p class="p3"><b>{"one" 2, "two" 2}</b></p>
<p class="p4"><br></p>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 36.0px Palatino"><b>Keywords</b></h1>
<p class="p4"><br></p>
<p class="p3">=&gt; :this</p>
<p class="p3"><b>:this</b></p>
<p class="p3">=&gt; (type :this)</p>
<p class="p3"><b>clojure.lang.Keyword</b></p>
<p class="p3">=&gt; (name :this)</p>
<p class="p3"><b>"this"</b></p>
<p class="p3">=&gt; (keyword "this")</p>
<p class="p3"><b>:this</b></p>
<p class="p4"><br></p>
<p class="p2">Keywords are named tokens.<span class="Apple-converted-space">  </span>They are comparable…</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (= :this :that)</p>
<p class="p3"><b>false</b></p>
<p class="p3">=&gt; (= :this :this)</p>
<p class="p3"><b>true</b></p>
<p class="p4"><br></p>
<p class="p2">…but not numeric</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (&lt;= :this :this)</p>
<p class="p3">Execution error (ClassCastException) at user/eval173 (REPL:1).</p>
<p class="p3">class clojure.lang.Keyword cannot be cast to class java.lang.Number<span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p2">They have no value other than their name.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (str :this)</p>
<p class="p3"><b>":this"</b></p>
<p class="p3">=&gt; (prn :this)</p>
<p class="p3"><b>:this</b></p>
<p class="p3"><b>nil</b></p>
<p class="p3">=&gt; (println :this)</p>
<p class="p3"><b>:this</b></p>
<p class="p3"><b>nil</b></p>
<p class="p4"><br></p>
<p class="p2">And they are very, very, useful — especially when combined with maps.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (def mk {:one 1 :two 2})</p>
<p class="p3">=&gt; (mk :one)</p>
<p class="p3"><b>1</b></p>
<p class="p3">=&gt; (mk :two)</p>
<p class="p3"><b>2</b></p>
<p class="p3">=&gt; (:one mk)</p>
<p class="p3"><b>1</b></p>
<p class="p3">=&gt; (:two mk)</p>
<p class="p3"><b>2</b></p>
<p class="p3">=&gt; (:three mk)</p>
<p class="p3"><b>nil</b></p>
<p class="p3">=&gt; (:three mk :none)</p>
<p class="p3"><b>:none</b></p>
<p class="p4"><br></p>
<p class="p2">That’s another convenience.<span class="Apple-converted-space">  </span>Keywords are implicit invocations of <span class="s1">get</span>.<span class="Apple-converted-space">  </span>In fact, you can pass them as functions like this:</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (map :one [{:one 1} {:one "one"}])</p>
<p class="p3"><b>(1 "one")</b></p>
<p class="p4"><br></p>
<p class="p2">But now let’s get down to business…</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (def bob {:bob {:first "Bobby" :last "Martin"}})</p>
<p class="p3">=&gt; (def bill {:bill {:first "Billy" :last "Smith"}})</p>
<p class="p3">=&gt; bob</p>
<p class="p3">{:bob {:first "Bobby", :last "Martin"}}</p>
<p class="p3">=&gt; bill</p>
<p class="p3">{:bill {:first "Billy", :last "Smith"}}</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (merge bob bill)</p>
<p class="p3">{:bob {:first "Bobby", :last "Martin"}, :bill {:first "Billy", :last "Smith"}}</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (def people (merge bob bill))</p>
<p class="p3">=&gt; people</p>
<p class="p3">{:bob {:first "Bobby", :last "Martin"}, :bill {:first "Billy", :last "Smith"}}</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (:bob people)</p>
<p class="p3">{:first "Bobby", :last "Martin"}</p>
<p class="p3">=&gt; (:bill people)</p>
<p class="p3">{:first "Billy", :last "Smith"}</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (get-in people [:bob :first])</p>
<p class="p3">"Bobby"</p>
<p class="p3">=&gt; (get-in people [:bob :last])</p>
<p class="p3">"Martin"</p>
<p class="p3">=&gt; (get-in people [:bill :first])</p>
<p class="p3">"Billy"</p>
<p class="p3">=&gt; (get-in people [:bill :last])</p>
<p class="p3">"Smith"</p>
<p class="p4"><br></p>
<p class="p2">It’s difficult to overstate the value of what you just read.<span class="Apple-converted-space">  </span>Make sure you look it over carefully and understand it…but it get’s better.</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (assoc-in people [:bob :first] "Robert")</p>
<p class="p3">{:bob {:first "Robert", :last "Martin"},<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space"> </span>:bill {:first "Billy", :last "Smith"}}</p>
<p class="p3">=&gt; (def people2 (-&gt; people<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">                    </span>(assoc-in [:bob :first] "Robert")<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">                    </span>(assoc-in [:bill :first] "William")))</p>
<p class="p3">=&gt; people2</p>
<p class="p3">{:bob {:first "Robert", :last "Martin"},<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space"> </span>:bill {:first "William", :last "Smith"}}</p>
<p class="p3">=&gt; (def people3 (-&gt; people2<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">                    </span>(assoc-in [:bob :age] 72)<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">                    </span>(assoc-in [:bill :age] 61)))</p>
<p class="p3">=&gt; people3</p>
<p class="p3">{:bob {:first "Robert", :last "Martin", :age 72},<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space"> </span>:bill {:first "William", :last "Smith", :age 61}}</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (update-in people3 [:bob :age] inc)</p>
<p class="p3">{:bob {:first "Robert", :last "Martin", :age 73},<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space"> </span>:bill {:first "William", :last "Smith", :age 61}}</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (reduce #(update-in %1 [(key %2) :age] inc) people3 people3)</p>
<p class="p3">{:bob {:first "Robert", :last "Martin", :age 73},<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space"> </span>:bill {:first "William", :last "Smith", :age 62}}</p>
<p class="p4"><br></p>
<p class="p2">Study that last one very carefully.<span class="Apple-converted-space">  </span>When you understand why there are two <span class="s1">people3</span> arguments, you will have achieved much — grasshopper.</p>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 36.0px Palatino"><b>Exercises</b></h1>
<p class="p8"><b>1.<span class="Apple-tab-span">	</span>Bank</b></p>
<p class="p9">Write a function named process-transactions that takes a map of accounts and a list of transactions, and applies all the transactions to the accounts.<span class="Apple-converted-space">  </span>For example:</p>
<p class="p3"><br>
<span class="Apple-tab-span">	</span>(process-transactions</p>
<p class="p4"><br></p>
<p class="p3"><span class="Apple-converted-space">     </span>{1 {:balance 0 :name "bob"}<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">      </span>2 {:balance 100 :name "bill"}}</p>
<p class="p4"><br></p>
<p class="p3"><span class="Apple-converted-space">     </span>[{:type :deposit :account 1 :amount 100}</p>
<p class="p3"><span class="Apple-converted-space">      </span>{:type :withdrawal :account 2 :amount 50}</p>
<p class="p3"><span class="Apple-converted-space">      </span>{:type :interest :rate 1/100}])<br>
</p>
<p class="p9">Should return:</p>
<p class="p3"><span class="Apple-converted-space">     </span>{1 {:balance 101 :name "bob"}<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">      </span>2 {:balance 101/2 :name "bill"}}</p>
<p class="p4"><br></p>
<p class="p9">Note that the interest transaction applies to all the accounts in the map.</p>
<p class="p10"><br></p>
<p class="p8"><b><span class="Apple-converted-space"> </span>2.<span class="Apple-tab-span">	</span>Risk</b></p>
<p class="p9">A battle in the game of Risk is when two armies face off against one another.<span class="Apple-converted-space">  </span>Each army has a number of units it can use in the battle. <span class="Apple-converted-space">  </span><br>
<br>
The battle uses dice.<span class="Apple-converted-space">  </span>The attacker rolls 1-3 dice, and then the defender rolls 1-2.<span class="Apple-converted-space">  </span>Attackers will role one less than the number of units they have — up to 3.<span class="Apple-converted-space">  </span>Defenders will 1 if they only have one unit, otherwise 2.<span class="Apple-converted-space">  </span><br>
<br>
The highest roll of each is compared.<span class="Apple-converted-space">  </span>Ties go to the defender.<span class="Apple-converted-space">  </span>The losing side loses one unit.<span class="Apple-converted-space">  </span>Then if both rolled two dice the second highest roll of each is compared and the same decision rule applies. <br>
<br>
Write a function named <span class="s1">play-risk</span> that takes a game and a list of die rolls and returns the end result of the game.<span class="Apple-converted-space">  </span>Given the game <span class="s1">{:attackers 10 :defenders 10}</span>, and the following list of die rolls, the result should be <span class="s1">{:attackers 2 :defenders 0}</span>.<span class="Apple-converted-space"> </span></p>
<p class="p3">[1 1 1 3 3</p>
<p class="p3"><span class="Apple-converted-space"> </span>1 1 6 5 1</p>
<p class="p3"><span class="Apple-converted-space"> </span>6 6 1 5 5</p>
<p class="p3"><span class="Apple-converted-space"> </span>3 4 4 5 4</p>
<p class="p3"><span class="Apple-converted-space"> </span>3 5 4 6 2</p>
<p class="p3"><span class="Apple-converted-space"> </span>3 3 6 5 4</p>
<p class="p3"><span class="Apple-converted-space"> </span>5 6 3 4</p>
<p class="p3"><span class="Apple-converted-space"> </span>4 5 2 3</p>
<p class="p3"><span class="Apple-converted-space"> </span>3 3 6</p>
<p class="p3"><span class="Apple-converted-space"> </span>6 2]</p>
<p class="p9">You will likely need the <span class="s1">sort</span>, and perhaps even the <span class="s1">reverse</span>, function to complete this exercise.<br>
</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<h1 style="margin: 36.0px 0.0px 36.0px 0.0px; text-align: center; font: 48.0px Helvetica">Chapter 7</h1>
<h1 style="margin: 36.0px 0.0px 36.0px 0.0px; text-align: center; font: 48.0px Helvetica">Namespaces and Sets</h1>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 36.0px Palatino"><b>Namespaces</b></h1>
<p class="p2">Notice the <span class="s1">user=&gt;</span> prompt below.<span class="Apple-converted-space">  </span>In previous chapters I trimmed that off to avoid confusion; but from now on I’ll leave it there…because it’s time to talk about namespaces.</p>
<p class="p4"><br></p>
<p class="p3">user=&gt; :this</p>
<p class="p3"><b>:this</b></p>
<p class="p3">user=&gt; ::this</p>
<p class="p3"><b>:user/this</b></p>
<p class="p3">user=&gt; (= :this ::this)</p>
<p class="p3"><b>false</b></p>
<p class="p3">user=&gt; (= ::this ::this)</p>
<p class="p3"><b>true</b></p>
<p class="p3">user=&gt; (= :user/this ::this)</p>
<p class="p3"><b>true</b></p>
<p class="p3">user=&gt; (namespace ::this)</p>
<p class="p3"><b>"user"</b></p>
<p class="p3">user=&gt; (namespace :this)</p>
<p class="p3"><b>nil</b></p>
<p class="p4"><br></p>
<p class="p2">Study the above carefully.<span class="Apple-converted-space">  </span>From it you will infer that <span class="s1">:this</span> is a global keyword, but <br>
<span class="s1">:user/this</span> is a keyword in the <span class="s1">user</span> namespace.<span class="Apple-converted-space">  </span>You’ll also infer that if you are working in the <span class="s1">user</span> namespace then <span class="s1">::this</span> is equivalent to <span class="s1">:user/this</span>.</p>
<p class="p2">So how do you know which namespace you are working in?<span class="Apple-converted-space">  </span>The prompt <span class="s1">user=&gt;</span> will tell you if you are typing at the REPL.<span class="Apple-converted-space">  </span>In a program however you could check the <span class="s1">*ns*</span> global variable.</p>
<p class="p4"><br></p>
<p class="p3">user=&gt; *ns*</p>
<p class="p3">#object[clojure.lang.Namespace 0x7051777c "user"]</p>
<p class="p4"><br></p>
<p class="p2">Now let’s change the namespace we are working in to <span class="s1">bob</span>.</p>
<p class="p4"><br></p>
<p class="p3">user=&gt; (ns bob)</p>
<p class="p3">nil</p>
<p class="p3">bob=&gt; *ns*</p>
<p class="p3">#object[clojure.lang.Namespace 0xff6077 "bob"]</p>
<p class="p4"><br></p>
<p class="p2">That was easy.<span class="Apple-converted-space">  </span>Did you notice that the prompt changed to <span class="s1">bob=&gt;</span>?<span class="Apple-converted-space">  </span>Now let’s play with <span class="s1">::this</span> again.</p>
<p class="p4"><br></p>
<p class="p3">bob=&gt; ::this</p>
<p class="p3"><b>:bob/this</b></p>
<p class="p3">bob=&gt; (= ::this :user/this)</p>
<p class="p3"><b>false</b></p>
<p class="p3">bob=&gt; (= ::this :bob/this)</p>
<p class="p3"><b>true</b></p>
<p class="p3">bob=&gt; (namespace ::this)</p>
<p class="p3"><b>"bob"</b></p>
<p class="p5"><br></p>
<p class="p2">OK, so now that we are in the <span class="s1">bob</span> namespace, <span class="s1">::this</span> refers to <span class="s1">:bob/this</span>.<span class="Apple-converted-space">  </span>Not only that, but all things defined with <span class="s1">def</span> are in that namespace too.</p>
<p class="p4"><b></b><br></p>
<p class="p3">bob=&gt; (def ONE 1)</p>
<p class="p3">bob=&gt; (def ONE 1)</p>
<p class="p3"><b>#'bob/ONE</b></p>
<p class="p3">bob=&gt; ONE</p>
<p class="p3"><b>1</b></p>
<p class="p3">bob=&gt; bob/ONE</p>
<p class="p3"><b>1</b></p>
<p class="p3">bob=&gt; (ns user)</p>
<p class="p3"><b>nil</b></p>
<p class="p3">user=&gt; ONE</p>
<p class="p3"><b>Syntax error compiling at (REPL:0:0).</b></p>
<p class="p3"><b>Unable to resolve symbol: ONE in this context</b></p>
<p class="p3">user=&gt; bob/ONE</p>
<p class="p3"><b>1</b></p>
<p class="p3">user=&gt; (ns bob)</p>
<p class="p3"><b>nil</b></p>
<p class="p3">bob=&gt; (defn x2 [x] (+ x x))</p>
<p class="p3"><b>#'bob/x2</b></p>
<p class="p3">bob=&gt; (x2 3)</p>
<p class="p3"><b>6</b></p>
<p class="p3">bob=&gt; (bob/x2 6)</p>
<p class="p3"><b>12</b></p>
<p class="p3">bob=&gt; (ns user)</p>
<p class="p3"><b>nil</b></p>
<p class="p3">user=&gt; (x2 3)</p>
<p class="p3"><b>Syntax error compiling at (REPL:1:1).</b></p>
<p class="p3"><b>Unable to resolve symbol: x2 in this context</b></p>
<p class="p3">user=&gt; (bob/x2 3)</p>
<p class="p3"><b>6</b></p>
<p class="p4"><b></b><br></p>
<p class="p2">As you can see the names of variables and functions are qualified with the namespace in which they are created.<span class="Apple-converted-space">  </span>The <span class="s1">(def ONE 1)</span> invocation within the <span class="s1">bob</span> namespace created the variable <span class="s1">bob/ONE</span>.<span class="Apple-converted-space">  </span>While within the <span class="s1">bob</span> namespace <span class="s1">ONE</span> refers to <span class="s1">bob/ONE</span>.<span class="Apple-converted-space">  </span>Within another namespace, like <span class="s1">user</span>, <span class="s1">ONE</span> has no definition; but <span class="s1">bob/ONE</span> can still be accessed by using the fully qualified name. <span class="Apple-converted-space">  </span>The same holds true for functions.</p>
<p class="p2">Perhaps this whole business about namespaces confuses you.<span class="Apple-converted-space">  </span>Why do they exist?<span class="Apple-converted-space">  </span>So let’s use them the way they were intended. <span class="Apple-converted-space"> </span></p>
<p class="p2">First, let’s create a namespace for some mathematical functions.</p>
<p class="p4"><br></p>
<p class="p3">user=&gt; (ns math)</p>
<p class="p3"><b>nil</b></p>
<p class="p3">math=&gt; (defn power [x n] (apply * (repeat n x)))</p>
<p class="p3"><b>#'math/power</b></p>
<p class="p3">math=&gt; (power 10 3)</p>
<p class="p3"><b>1000</b></p>
<p class="p3">math=&gt; (power<span class="Apple-converted-space">  </span>4 2)</p>
<p class="p3"><b>16</b></p>
<p class="p3">math=&gt; (defn square [x] (power x 2))</p>
<p class="p3"><b>#'math/square</b></p>
<p class="p3">math=&gt; (square 5)</p>
<p class="p3"><b>25</b></p>
<p class="p4"><br></p>
<p class="p2">Next let’s create a namespace for some statistical functions.</p>
<p class="p4"><br></p>
<p class="p3">math=&gt; (ns stat)</p>
<p class="p3"><b>nil</b></p>
<p class="p3">stat=&gt; (defn fac [x] (apply * (range 1 (inc x))))</p>
<p class="p3"><b>#'stat/fac</b></p>
<p class="p3">stat=&gt; (fac 3)</p>
<p class="p3"><b>6</b></p>
<p class="p3">stat=&gt; (fac 10)</p>
<p class="p3"><b>3628800</b></p>
<p class="p3">stat=&gt; (defn mean [&amp; ns] (/ (reduce + ns) (count ns)))</p>
<p class="p3"><b>#'stat/mean</b></p>
<p class="p3">stat=&gt; (mean 3 4 5)</p>
<p class="p3"><b>4</b></p>
<p class="p3">stat=&gt; (apply mean [4 5 6 7])</p>
<p class="p3"><b>11/2</b></p>
<p class="p4"><br></p>
<p class="p2">The only surprise there is that <span class="s1">[&amp; ns]</span> syntax.<span class="Apple-converted-space">  </span>But it just means that <span class="s1">ns</span> contains the list of all arguments after the <span class="s1">&amp;</span>.</p>
<p class="p2">So we have effectively created two libraries of functions, <span class="s1">math</span> and <span class="s1">stat</span>.<span class="Apple-converted-space">  </span>Now let’s write a program to compute the root-mean-square using these two libraries.</p>
<p class="p4"><br></p>
<p class="p3">stat=&gt; (ns my-program (:require [stat :as s] [math :as m]))</p>
<p class="p3"><b>nil</b></p>
<p class="p3">my-program=&gt; (math/power 10 2)</p>
<p class="p3"><b>100</b></p>
<p class="p3">my-program=&gt; (m/power 10 2)</p>
<p class="p3"><b>100</b></p>
<p class="p3">my-program=&gt; (defn rms [&amp; ns] (Math/sqrt (apply s/mean (map m/square ns))))</p>
<p class="p3"><b>#'my-program/rms</b></p>
<p class="p3">my-program=&gt; (rms 3 4 5)</p>
<p class="p3"><b>4.08248290463863</b></p>
<p class="p4"><br></p>
<p class="p2">Look closely at that <span class="s1">ns</span> statement because you’ll be using statements like it a lot.<span class="Apple-converted-space">  </span>It creates the <span class="s1">s</span> alias for the <span class="s1">stat</span> namespace, and the <span class="s1">m</span> alias for the <span class="s1">math</span> namespace.<span class="Apple-converted-space">  </span>This is just for convenience.<span class="Apple-converted-space">  </span>As we’ll soon see sometimes its nice to use abbreviations instead of fully qualified names.</p>
<p class="p2">That <span class="s1">:require</span> within the <span class="s1">ns</span> command does a lot more than just create aliases.<span class="Apple-converted-space">  </span>It can also load libraries from files.<span class="Apple-converted-space">  </span>But before I show you that, let’s talk about sets.</p>
<h2 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 13.0px Palatino"><b>Sets</b></h2>
<p class="p4"><br></p>
<p class="p3">user=&gt; #{1}</p>
<p class="p3"><b>#{1}</b></p>
<p class="p3">user=&gt; (type #{1})</p>
<p class="p3"><b>clojure.lang.PersistentHashSet</b></p>
<p class="p3">user=&gt; (set [1 2 3])</p>
<p class="p3"><b>#{1 3 2}</b></p>
<p class="p3">user=&gt; (set [1 1 1])</p>
<p class="p3"><b>#{1}</b></p>
<p class="p3">user=&gt; (into #{} [1 2 3 4 5 4 3 2 1])</p>
<p class="p3"><b>#{1 4 3 2 5}</b></p>
<p class="p3">user=&gt; (into [] #{1 2 3 4 5 6})</p>
<p class="p3"><b>[1 4 6 3 2 5]</b></p>
<p class="p4"><br></p>
<p class="p2">As you can see, a set is like a list but does not allow duplicates and does not maintain the order of the elements.<span class="Apple-converted-space">  </span>There is a special library of functions for working with sets called <span class="s1">clojure.set</span>.<span class="Apple-converted-space">  </span>Let’s see how it works.</p>
<p class="p4"><br></p>
<p class="p3">user=&gt; (ns set-stuff (:require [clojure.set :as set]))</p>
<p class="p3"><b>nil</b></p>
<p class="p3">set-stuff=&gt; (set/union #{1 2 3} #{3 4 5})</p>
<p class="p3"><b>#{1 4 3 2 5}</b></p>
<p class="p3">set-stuff=&gt; (set/intersection #{1 2 3} #{3 4 5})</p>
<p class="p3"><b>#{3}</b></p>
<p class="p3">set-stuff=&gt; (set/intersection #{2 3 4} #{5 6 7})</p>
<p class="p3"><b>#{}</b></p>
<p class="p3">set-stuff=&gt; (set/difference #{1 2 3 4 5} #{3 4})</p>
<p class="p3"><b>#{1 2 5}</b></p>
<p class="p3">set-stuff=&gt; (set/subset? #{2 3} #{1 2 3 4 5})</p>
<p class="p3"><b>true</b></p>
<p class="p3">set-stuff=&gt; (set/subset? #{2 3} #{3 4 5})</p>
<p class="p3"><b>false</b></p>
<p class="p3">set-stuff=&gt; (set/superset? #{3 4 5 6 7} #{3 4 5})</p>
<p class="p3"><b>true</b></p>
<p class="p4"><br></p>
<p class="p2">There’s that <span class="s1">:require</span> again.<span class="Apple-converted-space">  </span>This time it pulled in the <span class="s1">clojure.set</span> library from the standard catalog of libraries that comes along with Clojure.<span class="Apple-converted-space">  </span>I’m sure you found no surprises in the above example.<span class="Apple-converted-space">  </span>But perhaps this next one will surprise you a bit.</p>
<p class="p4"><br></p>
<p class="p3">set-stuff=&gt; (#{1 2 3} 1)</p>
<p class="p3"><b>1</b></p>
<p class="p3">set-stuff=&gt; (#{:this :that :the-other} :none)</p>
<p class="p3"><b>nil</b></p>
<p class="p3">set-stuff=&gt; (def colors #{:red :green :blue})</p>
<p class="p3"><b>#'set-stuff/colors</b></p>
<p class="p3">set-stuff=&gt; (when (colors :red) (prn "color"))</p>
<p class="p3"><b>"color"</b></p>
<p class="p3"><b>nil</b></p>
<p class="p3">set-stuff=&gt; (when (colors :purple) (prn "color"))</p>
<p class="p3"><b>nil</b></p>
<p class="p4"><br></p>
<p class="p2">Sets act like functions that check the membership of their argument.<span class="Apple-converted-space">  </span>If the member is found it is returned, otherwise it returns <span class="s1">nil</span>.<span class="Apple-converted-space">  </span>And, remember, anything non-nil will act like <span class="s1">true</span> if used as a predicate.<span class="Apple-converted-space">  </span>We call non-nil predicates <i>truthy</i>. <span class="Apple-converted-space"> </span></p>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 36.0px Palatino"><b>Exercises</b></h1>
<p class="p8"><b>1.<span class="Apple-tab-span">	</span>Letters</b></p>
<p class="p9">Write a function in the namespace <span class="s1">letters</span> named <span class="s1">find-missing</span> that takes a string and prints a string containing the letters of the alphabet that are missing from that first string.<span class="Apple-converted-space">  </span>Assume all strings are lower case.<span class="Apple-converted-space">  </span>Thus <span class="s1">(find-missing “bob”)</span> should return <span class="s1">“acdefghijklmnpqrstuvwxyz</span>”.</p>
<p class="p8"><b>2.<span class="Apple-tab-span">	</span>Primes</b></p>
<p class="p9">Write a function called <span class="s1">find-primes</span> in the namespace <span class="s1">primes</span>.<span class="Apple-converted-space">  </span>This function should calculate the primes numbers up to and including it’s argument.<span class="Apple-converted-space">  </span>For example <br>
<span class="s1">(find-primes 6)</span> should return <span class="s1">[2 3 5]</span>.<span class="Apple-converted-space">  </span><br>
<br>
Consider the problem to be one of set differences.<span class="Apple-converted-space">  </span>Create a set of all the numbers from 1..n, and then for each number removed its multiples.<span class="Apple-converted-space">  </span>You may find the <span class="s1">range</span> function to be helpful.<span class="Apple-converted-space">  </span>Check out <span class="s1">(doc range)</span>. <span class="Apple-converted-space"> </span></p>
<p class="p10"><br></p>
<p class="p11"><br></p>
<h1 style="margin: 36.0px 0.0px 36.0px 0.0px; text-align: center; font: 48.0px Helvetica">Chapter 8</h1>
<h1 style="margin: 36.0px 0.0px 36.0px 0.0px; text-align: center; font: 48.0px Helvetica">Loop de Loop</h1>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 36.0px Palatino"><b>Iteration and Recursion</b></h1>
<p class="p4"><br></p>
<p class="p3">user=&gt; (defn lup [n] (if (zero? n) :done (lup (dec n))))</p>
<p class="p3">user=&gt; (lup 4)</p>
<p class="p3"><b>:done</b></p>
<p class="p4"><br></p>
<p class="p2">This is equivalent to:</p>
<p class="p4"><br></p>
<p class="p3">user=&gt; (if (zero? 4) :done<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">         </span>(if (zero? 3) :done<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">           </span>(if (zero? 2) :done<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">             </span>(if (zero? 1) :done<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">               </span>(if (zero? 0) :done)))))</p>
<p class="p3"><b>:done</b></p>
<p class="p4"><br></p>
<p class="p2">That nesting requires memory.<span class="Apple-converted-space">  </span>Each <span class="s1">if</span> calls the next, which calls the next.<span class="Apple-converted-space">  </span>The eventual <span class="s1">:done</span> must return back through all those nested <span class="s1">if</span>s.<span class="Apple-converted-space">  </span>How much memory does this take?<span class="Apple-converted-space">  </span>How much nesting is possible?</p>
<p class="p4"><br></p>
<p class="p3">user=&gt; (time (lup 10))</p>
<p class="p3">"Elapsed time: 0.019973 msecs"</p>
<p class="p3">:done</p>
<p class="p3">user=&gt; (time (lup 1000))</p>
<p class="p3">"Elapsed time: 1.690559 msecs"</p>
<p class="p3">:done</p>
<p class="p3">user=&gt; (time (lup 10000))</p>
<p class="p3">Execution error (StackOverflowError) at user/lup (REPL:1).</p>
<p class="p3">null</p>
<p class="p4"><br></p>
<p class="p2">Apparently ten thousands nested <span class="s1">if</span>s is too many.<span class="Apple-converted-space">  </span>But there is a way around this limit.<span class="Apple-converted-space">  </span>Since the returned <span class="s1">:done</span> is not modified by any of the nested calls, we can ask the system not to remember the nesting and just return the final <span class="s1">:done</span>. <span class="Apple-converted-space">  </span>This is called <i>tail call optimization</i> (TCO) and we invoke it with <span class="s1">recur</span>.</p>
<p class="p4"><br></p>
<p class="p3">user=&gt; (defn lup [n] (if (zero? n) :done (recur (dec n))))</p>
<p class="p3">user=&gt; (time (lup 1000))</p>
<p class="p3"><b>"Elapsed time: 0.227877 msecs"</b></p>
<p class="p3"><b>:done</b></p>
<p class="p4"><br></p>
<p class="p2">Apparently keeping track of the nesting took a fair bit of time.<span class="Apple-converted-space">  </span>The <span class="s1">recur</span> version is much faster.</p>
<p class="p4"><br></p>
<p class="p3">user=&gt; (time (lup 10000))</p>
<p class="p3">"Elapsed time: 1.13428 msecs"</p>
<p class="p3">:done</p>
<p class="p3">user=&gt; (time (lup 1000000))</p>
<p class="p3">"Elapsed time: 79.401391 msecs"</p>
<p class="p3">:done</p>
<p class="p3">user=&gt; (time (lup 1000000000))</p>
<p class="p3">"Elapsed time: 3211.51927 msecs"</p>
<p class="p3">:done</p>
<p class="p4"><br></p>
<p class="p2">A billion loops in 3.2 seconds!<span class="Apple-converted-space">  </span>Three nanoseconds per loop.<span class="Apple-converted-space">  </span>Not bad.</p>
<p class="p2">In the above, the <span class="s1">recur</span> simply jumped back to the top of the <span class="s1">lup</span> function.<span class="Apple-converted-space">  </span>But there is another way to use <span class="s1">recur</span>.</p>
<p class="p4"><br></p>
<p class="p3">user=&gt; (defn fac [x] (loop [n x f 1] (if (zero? n) f (recur (dec n) (* f n)))))</p>
<p class="p4"><br></p>
<p class="p2">The <span class="s1">loop</span> function initializes <span class="s1">n</span> with <span class="s1">x</span>, and <span class="s1">f</span> with <span class="s1">1</span>.<span class="Apple-converted-space">  </span>The <span class="s1">recur</span> jumps back to the <span class="s1">loop</span>.</p>
<p class="p4"><br></p>
<p class="p3">user=&gt; (fac 10)</p>
<p class="p3">3628800</p>
<p class="p3">user=&gt; (fac 20)</p>
<p class="p3">2432902008176640000</p>
<p class="p3">user=&gt; (fac 50)</p>
<p class="p3">Execution error (ArithmeticException) at java.lang.Math/multiplyExact (Math.java:1032).</p>
<p class="p3">long overflow</p>
<p class="p4"><br></p>
<p class="p2">Regular integers have a limit.<span class="Apple-converted-space">  </span>But we can always use <span class="s1">BigInt</span>. <span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p3">user=&gt; (fac 50N)</p>
<p class="p3">30414093201713378043612608166064768844377641568960512000000000000N</p>
<p class="p3">user=&gt; (fac 100N)</p>
<p class="p3">93326215443944152681699238856266700490715968264381621468592963895217599993229915608941463976156518286253697920827223758251185210916864000000000000000000000000N</p>
<p class="p3">user=&gt; (fac 1000N)</p>
<p class="p3">402387260077093773543702433923003985719374864210714632543799910429938512398629020592044208486969404800479988610197196058631666872994808558901323829669944590997424504087073759918823627727188732519779505950995276120874975462497043601418278094646496291056393887437886487337119181045825783647849977012476632889835955735432513185323958463075557409114262417474349347553428646576611667797396668820291207379143853719588249808126867838374559731746136085379534524221586593201928090878297308431392844403281231558611036976801357304216168747609675871348312025478589320767169132448426236131412508780208000261683151027341827977704784635868170164365024153691398281264810213092761244896359928705114964975419909342221566832572080821333186116811553615836546984046708975602900950537616475847728421889679646244945160765353408198901385442487984959953319101723355556602139450399736280750137837615307127761926849034352625200015888535147331611702103968175921510907788019393178114194545257223865541461062892187960223838971476088506276862967146674697562911234082439208160153780889893964518263243671616762179168909779911903754031274622289988005195444414282012187361745992642956581746628302955570299024324153181617210465832036786906117260158783520751516284225540265170483304226143974286933061690897968482590125458327168226458066526769958652682272807075781391858178889652208164348344825993266043367660176999612831860788386150279465955131156552036093988180612138558600301435694527224206344631797460594682573103790084024432438465657245014402821885252470935190620929023136493273497565513958720559654228749774011413346962715422845862377387538230483865688976461927383814900140767310446640259899490222221765904339901886018566526485061799702356193897017860040811889729918311021171229845901641921068884387121855646124960798722908519296819372388642614839657382291123125024186649353143970137428531926649875337218940694281434118520158014123344828015051399694290153483077644569099073152433278288269864602789864321139083506217095002597389863554277196742822248757586765752344220207573630569498825087968928162753848863396909959826280956121450994871701244516461260379029309120889086942028510640182154399457156805941872748998094254742173582401063677404595741785160829230135358081840096996372524230560855903700624271243416909004153690105933983835777939410970027753472000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000N</p>
<p class="p4"><br></p>
<p class="p2">Smile…</p>
<p class="p4"><br></p>
<p class="p3">user=&gt; (time (do (fac 10000N) :done))</p>
<p class="p3"><b>"Elapsed time: 49.434411 msecs"</b></p>
<p class="p3"><b>:done</b></p>
<p class="p3">user=&gt; (time (do (fac 100000N) :done))</p>
<p class="p3"><b>"Elapsed time: 2255.785047 msecs"</b></p>
<p class="p3"><b>:done</b></p>
<p class="p3">user=&gt; (count (str (fac 100000N)))</p>
<p class="p3"><b>456574</b></p>
<p class="p4"><br></p>
<p class="p2">Bigger smile…</p>
<p class="p4"><br></p>
<p class="p3">user=&gt; (defn fib [n] (if (&lt;= n 2) 1 (+ (recur (dec n)) (recur (- n 2)))))</p>
<p class="p3">Syntax error (UnsupportedOperationException) compiling recur at (REPL:1:33).</p>
<p class="p3">Can only recur from tail position</p>
<p class="p4"><br></p>
<p class="p2">Think about this one for a bit.<span class="Apple-converted-space">  </span>The <span class="s1">recur</span> function can only be used if the nesting can be forgotten.<span class="Apple-converted-space">  </span>This function the nesting for that + operation.<span class="Apple-converted-space">  </span>Functions that depend on nesting in this way are known as <i>recursive</i> functions. <span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p3">user=&gt; (defn fib [n] (if (&lt;= n 2) 1 (+ (fib (dec n)) (fib (- n 2)))))</p>
<p class="p3"><b>#'user/fib</b></p>
<p class="p3">user=&gt; (map fib (range 1 20))</p>
<p class="p3"><b>(1 1 2 3 5 8 13 21 34 55 89 144 233 377 610 987 1597 2584 4181)</b></p>
<p class="p4"><b></b><br></p>
<p class="p2">Nice!<span class="Apple-converted-space">  </span>A bunch of Fibonacci numbers: <i>fib(n)=(fib(n-1) + fib(n-2))</i>. <span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p3">user=&gt; (time (fib 30))</p>
<p class="p3">"Elapsed time: 13.121772 msecs"</p>
<p class="p3">832040</p>
<p class="p3">user=&gt; (time (fib 35))</p>
<p class="p3">"Elapsed time: 114.795155 msecs"</p>
<p class="p3">9227465</p>
<p class="p3">user=&gt; (time (fib 40))</p>
<p class="p3">"Elapsed time: 1083.731026 msecs"</p>
<p class="p3">102334155</p>
<p class="p3">user=&gt; (time (fib 42))</p>
<p class="p3">"Elapsed time: 2831.161555 msecs"</p>
<p class="p3">267914296</p>
<p class="p4"><br></p>
<p class="p2">Wow!<span class="Apple-converted-space">  </span>That timing is horrendous. Let’s do some analysis.</p>
<p class="p4"><br></p>
<p class="p3">user=&gt; (defn fib-ms [n]<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">         </span>(-<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">           </span>(- (System/currentTimeMillis<a id="fnlink9"></a><a href="#fn9"><span class="s3"><sup>[9]</sup></span></a>)<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">              </span>(do (fib n) (System/currentTimeMillis)))))</p>
<p class="p3"><b>#'user/fib-ms</b></p>
<p class="p3">user=&gt; (fib-ms 30)</p>
<p class="p3"><b>11</b></p>
<p class="p3">user=&gt; (fib-ms 40)</p>
<p class="p3"><b>1127</b></p>
<p class="p3">user=&gt; (def fib-times (map fib-ms (range 35 45)))</p>
<p class="p3"><b>#'user/fib-times</b></p>
<p class="p3">user=&gt; fib-times</p>
<p class="p3"><b>(115 161 260 422 674 1138 1770 2807 4527 7280)</b></p>
<p class="p4"><b></b><br></p>
<p class="p2">If you type these commands into the REPL (as you should be doing!) then you likely got a surprise with those last too.<span class="Apple-converted-space">  </span>The one that should have been slow was fast, and the one that should have been fast was slow.<span class="Apple-converted-space">  </span>That’s due to laziness, which we’ll explore later.</p>
<p class="p4"><br></p>
<p class="p3">user=&gt; (map float (map #(/ %2 %1) fib-times (rest fib-times)))</p>
<p class="p3">(1.4 1.6149068 1.6230769 1.5971564 1.6884273 1.5553603 1.5858757 1.6127539 1.608129)</p>
<p class="p4"><br></p>
<p class="p2">So each subsequent integer takes ~1.6 times longer than the last.<span class="Apple-converted-space">  </span>Yikes!<span class="Apple-converted-space">  </span>Let’s do some counting.</p>
<p class="p4"><br></p>
<p class="p3">user=&gt; (def fib-count (atom 0))</p>
<p class="p3"><b>#'user/fib-count</b></p>
<p class="p3">user=&gt; (type fib-count)</p>
<p class="p3"><b>clojure.lang.Atom</b></p>
<p class="p4"><b></b><br></p>
<p class="p2">An <span class="s1">atom</span> is a variable outside any function.<span class="Apple-converted-space">  </span>We’ll spend more time on them later. <span class="Apple-converted-space"> </span></p>
<p class="p4"><b></b><br></p>
<p class="p3">user=&gt; (defn cfib [n]<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">         </span>(swap! fib-count inc)<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">         </span>(if (&lt;= n 2) 1 (+ (cfib (dec n)) (cfib (- n 2)))))</p>
<p class="p3"><b>#'user/cfib</b></p>
<p class="p4"><b></b><br></p>
<p class="p2">That <span class="s1">swap!</span> Increments the <span class="s1">fib-count</span> atom.</p>
<p class="p4"><b></b><br></p>
<p class="p3">user=&gt; (cfib 20)</p>
<p class="p3"><b>6765</b></p>
<p class="p3">user=&gt; @fib-count</p>
<p class="p3"><b>13529</b></p>
<p class="p4"><b></b><br></p>
<p class="p2">Calculating the 20<span class="s2">th</span> Fibonacci number required 13,529 calls to <span class="s1">cfib</span>.<span class="Apple-converted-space">  </span>Wow!</p>
<p class="p4"><br></p>
<p class="p3">user=&gt; (reset! fib-count 0)</p>
<p class="p3"><b>0</b></p>
<p class="p3">user=&gt; (cfib 21)</p>
<p class="p3"><b>10946</b></p>
<p class="p3">user=&gt; @fib-count</p>
<p class="p3"><b>21891</b></p>
<p class="p4"><b></b><br></p>
<p class="p2">Yeah, that makes sense, 12891÷13529 is about 1.6. <span class="Apple-converted-space"> </span></p>
<p class="p4"><b></b><br></p>
<p class="p3">user=&gt; (reset! fib-count 0)</p>
<p class="p3"><b>0</b></p>
<p class="p3">user=&gt; (cfib 30)</p>
<p class="p3"><b>832040</b></p>
<p class="p3">user=&gt; @fib-count</p>
<p class="p3"><b>1664079</b></p>
<p class="p4"><b></b><br></p>
<p class="p2">And so the number of recursive calls gets out of hand very quickly.<span class="Apple-converted-space">  </span>Have you figured out why?<span class="Apple-converted-space">  </span>Anyway, there’s a simple workaround.</p>
<p class="p3">user=&gt; (def mlup (memoize lup))</p>
<p class="p3">#'user/mlup</p>
<p class="p3">user=&gt; (time (mlup 1000000000))</p>
<p class="p3">"Elapsed time: 7567.874062 msecs"</p>
<p class="p3">:done</p>
<p class="p3">user=&gt; (time (mlup 1000000000))</p>
<p class="p3">"Elapsed time: 0.052779 msecs"</p>
<p class="p3">:done</p>
<p class="p3">user=&gt; (time (mlup 1000000001))</p>
<p class="p3">"Elapsed time: 7463.371179 msecs"</p>
<p class="p3">:done</p>
<p class="p3">user=&gt; (time (mlup 1000000001))</p>
<p class="p3">"Elapsed time: 0.032837 msecs"</p>
<p class="p3">:done</p>
<p class="p4"><br></p>
<p class="p2">Do you see how that works?<span class="Apple-converted-space">  </span>The first time you call the memoized <span class="s1">lup</span> with <span class="s1">x</span> it executes <span class="s1">lup</span> and returns the result — but it remembers that result for <span class="s1">x</span>. The second (and every other) time you call the memoized <span class="s1">lup</span> with <span class="s1">x</span> it simply returns the remembered answer without executing <span class="s1">lup</span>. <span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p3">user=&gt; (def mfib<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">         </span>(memoize<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">           </span>(fn [n]<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">             </span>(if (&lt;= n 2) 1N (+ (mfib (dec n))<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">                                </span>(mfib (- n 2)))))))</p>
<p class="p3">user=&gt; (mfib 1)</p>
<p class="p3">1N</p>
<p class="p3">user=&gt; (mfib 10)</p>
<p class="p3">55N</p>
<p class="p3">user=&gt; (mfib 20)</p>
<p class="p3">6765N</p>
<p class="p3">user=&gt; (time (mfib 30))</p>
<p class="p3">"Elapsed time: 0.144727 msecs"</p>
<p class="p3">832040N</p>
<p class="p3">user=&gt; (time (mfib 50))</p>
<p class="p3">"Elapsed time: 0.191239 msecs"</p>
<p class="p3">12586269025N</p>
<p class="p3">user=&gt; (time (mfib 200))</p>
<p class="p3">"Elapsed time: 1.485109 msecs"</p>
<p class="p3">280571172992510140037611932413038677189525N</p>
<p class="p3">user=&gt; (time (mfib 1000))</p>
<p class="p3">Execution error (StackOverflowError) at user/fn (REPL:1).</p>
<p class="p3">null</p>
<p class="p4"><br></p>
<p class="p2">Memoizing made the calculation go a lot faster because we only had to calculate<i> f(n)</i> once and it would be remembered every other time it was needed.<span class="Apple-converted-space">  </span>But we still have the problem of stacking up too much nesting.<span class="Apple-converted-space">  </span>We can address this problem by <i>iterating</i>.</p>
<p class="p4"><br></p>
<p class="p3">user=&gt; (defn ifib<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">         </span>([n] (ifib n 0 1N))<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">         </span>([n f-1 f] (if (= n 1) f (recur (dec n) f (+ f-1 f)))))</p>
<p class="p3"><b>#'user/ifib</b></p>
<p class="p4"><b></b><br></p>
<p class="p2">We iterate by structuring the calculation so that the nesting can be forgotten, allowing us to use <span class="s1">recur</span>.</p>
<p class="p4"><br></p>
<p class="p3">user=&gt; (ifib 10)</p>
<p class="p3">55N</p>
<p class="p3">user=&gt; (map ifib (range 1 20))</p>
<p class="p3">(1N 1N 2N 3N 5N 8N 13N 21N 34N 55N 89N 144N 233N 377N 610N 987N 1597N 2584N 4181N)</p>
<p class="p3">user=&gt; (time (ifib 50))</p>
<p class="p3">"Elapsed time: 0.096049 msecs"</p>
<p class="p3">12586269025N</p>
<p class="p3">user=&gt; (time (ifib 1000))</p>
<p class="p3">"Elapsed time: 0.243251 msecs"</p>
<p class="p3">43466557686937456435688527675040625802564660517371780402481729089536555417949051890403879840079255169295922593080322634775209689623239873322471161642996440906533187938298969649928516003704476137795166849228875N</p>
<p class="p3">user=&gt; (time (ifib 2000))</p>
<p class="p3">"Elapsed time: 0.557079 msecs"</p>
<p class="p3">4224696333392304878706725602341482782579852840250681098010280137314308584370130707224123599639141511088446087538909603607640194711643596029271983312598737326253555802606991585915229492453904998722256795316982874482472992263901833716778060607011615497886719879858311468870876264597369086722884023654422295243347964480139515349562972087652656069529806499841977448720155612802665404554171717881930324025204312082516817125N</p>
<p class="p3">user=&gt; (time (ifib 10000))</p>
<p class="p3">"Elapsed time: 3.024613 msecs"</p>
<p class="p3">33644764876431783266621612005107543310302148460680063906564769974680081442166662368155595513633734025582065332680836159373734790483865268263040892463056431887354544369559827491606602099884183933864652731300088830269235673613135117579297437854413752130520504347701602264758318906527890855154366159582987279682987510631200575428783453215515103870818298969791613127856265033195487140214287532698187962046936097879900350962302291026368131493195275630227837628441540360584402572114334961180023091208287046088923962328835461505776583271252546093591128203925285393434620904245248929403901706233888991085841065183173360437470737908552631764325733993712871937587746897479926305837065742830161637408969178426378624212835258112820516370298089332099905707920064367426202389783111470054074998459250360633560933883831923386783056136435351892133279732908133732642652633989763922723407882928177953580570993691049175470808931841056146322338217465637321248226383092103297701648054726243842374862411453093812206564914032751086643394517512161526545361333111314042436854805106765843493523836959653428071768775328348234345557366719731392746273629108210679280784718035329131176778924659089938635459327894523777674406192240337638674004021330343297496902028328145933418826817683893072003634795623117103101291953169794607632737589253530772552375943788434504067715555779056450443016640119462580972216729758615026968443146952034614932291105970676243268515992834709891284706740862008587135016260312071903172086094081298321581077282076353186624611278245537208532365305775956430072517744315051539600905168603220349163222640885248852433158051534849622434848299380905070483482449327453732624567755879089187190803662058009594743150052402532709746995318770724376825907419939632265984147498193609285223945039707165443156421328157688908058783183404917434556270520223564846495196112460268313970975069382648706613264507665074611512677522748621598642530711298441182622661057163515069260029861704945425047491378115154139941550671256271197133252763631939606902895650288268608362241082050562430701794976171121233066073310059947366875N</p>
<p class="p4"><br></p>
<p class="p2">The moral to this story is: When possible iterate by using <span class="s1">recur</span>.<span class="Apple-converted-space">  </span>If you can’t iterate then memoize.<span class="Apple-converted-space">  </span>If you can’t memoize…well, then the best of luck to you.</p>
<p class="p2">Oh, and if you were wondering…</p>
<p class="p4"><br></p>
<p class="p3">user=&gt; (time (count (str (ifib 1000000))))</p>
<p class="p3"><b>"Elapsed time: 11358.0141 msecs"</b></p>
<p class="p3"><b>208988</b></p>
<p class="p4"><br></p>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 36.0px Palatino"><b>Exercises</b></h1>
<p class="p8"><b>1.<span class="Apple-tab-span">	</span>Ballistics (a long time ago in a galaxy far far away.)</b></p>
<p class="p9">This problem is easier than it looks.<span class="Apple-converted-space">  </span>Don’t be intimidated.<span class="Apple-converted-space">  </span>It is, in fact, one of the problems that drove the development of the computer in the 1940s. <span class="Apple-converted-space"> </span></p>
<p class="p9"><br>
We have determined that the density of the air decreases with altitude according to the formula: <i>-0.0000375085</i><b><i>h</i></b><i>3+0.0035692521</i><b><i>h</i></b><i>2-0.1132617585</i><b><i>h</i></b><i>+1.2225038068</i><br>
Where <i>h</i> is the height above ground in 1000’s of feet.<br>
<br>
The deceleration of air resistance in feet per second upon our cannonball is <i>Cddv2</i>, where <i>d</i> is the air density, <i>v</i> is the velocity, and <i>Cd</i><a href="http://Cd.is"> </a>is 1/100,000.<span class="Apple-converted-space">  </span>The downward acceleration of gravity is 32.174 feet per second2.<br>
<br>
Our cannonball is fired from the ground with a vertical velocity of 1500 feet per second, and a horizontal velocity of 500 feet per second.<span class="Apple-converted-space">  </span>When and where does the cannonball hit the ground, and what altitude did it reach? <br>
<br>
Approximate this by dividing time into 1ms steps and track the position and velocities of the cannonball at each step.<span class="Apple-converted-space">  </span>The ground is at height 0. <span class="Apple-converted-space"> </span></p>
<p class="p8"><b>2.<span class="Apple-tab-span">	</span>Sum of Fractions</b></p>
<p class="p9">It turns out that the infinite sum of consecutive fractions 1/1 + 1/2 + 1/3 + 1/4… is infinite.<span class="Apple-converted-space">  </span>That means that any finite integer can be reached by adding up enough consecutive fractions.<span class="Apple-converted-space">  </span>How many factions have to be added up to reach a sum greater than or equal to 10?<span class="Apple-converted-space"> </span></p>
<p class="p8"><b>3.<span class="Apple-tab-span">	</span>Word Wrap</b></p>
<p class="p9">For this problem you should check the <span class="s1">doc</span>s of the <span class="s1">subs</span> and <span class="s1">string/last-index-of</span> functions.<br>
<br>
Write the function <span class="s1">(defn word-wrap [s n]…)</span> that splits the string <span class="s1">s</span> into lines no longer than <span class="s1">n</span>.<span class="Apple-converted-space">  </span>Break lines at the last possible space before <span class="s1">n</span>, but never allow a line to exceed <span class="s1">n</span>.<span class="Apple-converted-space">  </span>The string <span class="s1">s</span> will contain only alphabetic letters, numbers, and spaces.<br>
<br>
Example, if <span class="s1">s</span> is (without line ends):<br>
<br>
<span class="s1">“Four score and seven years ago our fathers brought forth upon this continent a new nation conceived in liberty and dedicated to the proposition that all men are created equal”<br>
</span><br>
and if <span class="s1">n</span> is 20, then the output should be:<br>
<span class="s1"><br>
Four score and seven</span></p>
<p class="p15">years ago our</p>
<p class="p15">fathers brought</p>
<p class="p15">forth upon this</p>
<p class="p15">continent a new</p>
<p class="p15">nation conceived in</p>
<p class="p15">liberty and</p>
<p class="p15">dedicated to the</p>
<p class="p15">proposition that all</p>
<p class="p15">men are created</p>
<p class="p15">equal<span class="s3"><br>
<br>
</span></p>
<p class="p18"><br></p>
<p class="p5"><br></p>
<p class="p5"><br></p>
<p class="p6"><br></p>
<h1 style="margin: 36.0px 0.0px 36.0px 0.0px; text-align: center; font: 48.0px Helvetica">Chapter 9</h1>
<h1 style="margin: 36.0px 0.0px 36.0px 0.0px; text-align: center; font: 48.0px Helvetica">Let's Get Modular</h1>
<p class="p2">Back in the first chapter I suggested that you type the <span class="s1">clj</span> command to start up a REPL.<span class="Apple-converted-space">  </span>That command can do a lot more than just that.<span class="Apple-converted-space">  </span>It can link together a set of modules and run them as a single program.<span class="Apple-converted-space">  </span>Consider the following files:</p>
<p class="p4"><br></p>
<p class="p3">- - - math.clj - - -</p>
<p class="p3">(ns math)</p>
<p class="p4"><br></p>
<p class="p3">(defn power [x n]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(apply * (repeat n (bigint x))))</p>
<p class="p4"><br></p>
<p class="p3">(defn rat-&gt;dec [r n]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(with-precision n (bigdec r)))</p>
<p class="p4"><br></p>
<p class="p2">A simple little module that computes integral powers, and a utility function that converts a number to a big decimal with limited precision.</p>
<p class="p4"><br></p>
<p class="p3">- - - stat.clj - - -</p>
<p class="p3">(ns stat)</p>
<p class="p4"><br></p>
<p class="p3">(defn fac [n] (apply * (range 1N (inc n))))</p>
<p class="p4"><br></p>
<p class="p2">A small module that calculates factorials.</p>
<p class="p3">- - - taylor.clj - - -</p>
<p class="p3">(ns taylor (:require math stat))</p>
<p class="p4"><br></p>
<p class="p3">(defn term [x n]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(let [numerator (math/power x n)</p>
<p class="p3"><span class="Apple-converted-space">        </span>denominator (stat/fac n)]</p>
<p class="p3"><span class="Apple-converted-space">    </span>(/ numerator denominator)))</p>
<p class="p4"><br></p>
<p class="p3">(defn exp [x n]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(let [terms (map (partial term x) (range 0 n))]</p>
<p class="p3"><span class="Apple-converted-space">    </span>(reduce + terms)))</p>
<p class="p4"><br></p>
<p class="p2">A lovely module that uses the previous modules to calculate the Taylor series for <i>e</i><span class="s2"><i>x</i></span> to a certain precision. <span class="Apple-converted-space"> </span></p>
<p class="p3">- - - expmain.clj - - -</p>
<p class="p3">(ns expmain (:require taylor math))</p>
<p class="p4"><br></p>
<p class="p3">(defn -main [&amp; args]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(prn (-&gt;&gt; args</p>
<p class="p3"><span class="Apple-converted-space">            </span>(map #(Integer/parseInt %))</p>
<p class="p3"><span class="Apple-converted-space">            </span>(map #(taylor/exp % 30))</p>
<p class="p3"><span class="Apple-converted-space">            </span>(map #(math/rat-&gt;dec % 30)))))</p>
<p class="p4"><br></p>
<p class="p2">And a main program that takes arguments from the command line, turns them into integers, uses the <span class="s1">taylor</span> module to computes <i>e</i><span class="s2"><i>x</i></span> to 30 places for of those integers, and then prints the results as 30 digit decimals.</p>
<p class="p2">Now let’s arrange these files into the following directory structure:</p>
<p class="p4"><br></p>
<p class="p3">+-letsGetModular<br>
+---src</p>
<p class="p3">+-----math.clj</p>
<p class="p3">+-----stat.clj</p>
<p class="p3">+-----taylor.clj</p>
<p class="p3">+-----expmain.clj</p>
<p class="p4"><br></p>
<p class="p2">Now, from within the <span class="s1">letsGoModular</span> directory:</p>
<p class="p4"><br></p>
<p class="p3">&gt;clj -M -m expmain 1 2 3</p>
<p class="p3">(2.71828182845904523536028747135M 7.38905609893065022723042313405M 20.0855369231876677400694616553M)</p>
<p class="p4"><br></p>
<p class="p2">When the <span class="s1">clj</span> command is executed from within a directory that contains a <span class="s1">src</span> directory, then it will use all the <span class="s1">.clj</span> files in that <span class="s1">src</span> directory.<span class="Apple-converted-space">  </span>The <span class="s1">-M -m expmain</span> arguments tell <span class="s1">clj</span> to execute the <span class="s1">-main</span> function within the <span class="s1">expmain.clj</span> file.<span class="Apple-converted-space">  </span>The <span class="s1">1 2 3</span> arguments are passed, as a list, into the <span class="s1">args</span> parameter of <span class="s1">-main</span>.</p>
<p class="p4"><br></p>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 36.0px Palatino"><b>Exercises</b></h1>
<p class="p8"><b>1.<span class="Apple-tab-span">	</span>Path Length</b></p>
<p class="p9">Create a module named <span class="s1">geometry.clj</span> that contains a function <span class="s1">distance</span> that takes two points of the form <span class="s1">[x y]</span> and returns the distance between those points using the distance formula <i>sqrt((x1-x2)2+(y1-y2)2)</i>.<br>
<br>
Create another module named <span class="s1">pathlength.clj</span> that contains a function <span class="s1">length</span> that takes a list of points along a path, which are of the form <span class="s1">[x y],</span> and calculates the distance of the whole path.<span class="Apple-converted-space">  </span>Assume that <span class="s1">x</span> and <span class="s1">y</span> are integers.<br>
<br>
Created a third module named <span class="s1">pathmain</span>, that has a <span class="s1">-main</span> function that calculates the length of a path entered as follows:</p>
<p class="p15"><span class="s3"><br>
</span>&gt;clj -M -m pathmain 3,4 4,5 6,8<br>
5.0197648378370845<br>
<br>
<span class="s3">Hint:<span class="Apple-converted-space">  </span>You might want to look at </span>string/split<span class="s3">. <span class="Apple-converted-space"> </span></span></p>
<p class="p5"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<h1 style="margin: 36.0px 0.0px 36.0px 0.0px; text-align: center; font: 48.0px Helvetica">Chapter 10</h1>
<h1 style="margin: 36.0px 0.0px 36.0px 0.0px; text-align: center; font: 48.0px Helvetica">Destructure Destructure</h1>
<p class="p2">By now you’ve probably gotten tired of unpacking individual elements of a vector with a lot of <span class="s1">first</span> and <span class="s1">second</span> calls. <span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p3">user=&gt; (let [[x y] [1 2]] (prn x y))</p>
<p class="p3"><b>1 2</b></p>
<p class="p3"><b>nil</b></p>
<p class="p3">user=&gt; (defn square [x] (* x x))</p>
<p class="p3"><b>#'user/square</b></p>
<p class="p3">user=&gt; (defn distance [[x1 y1] [x2 y2]]<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">         </span>(Math/sqrt (+ (square (- x1 x2)) (square (- y1 y2)))))</p>
<p class="p3"><b>#'user/distance</b></p>
<p class="p3">user=&gt; (distance [0 0] [1 1])</p>
<p class="p3"><b>1.4142135623730951</b></p>
<p class="p3">user=&gt; (distance [0 0] [1 0])</p>
<p class="p3"><b>1.0</b></p>
<p class="p4"><b></b><br></p>
<p class="p2">This is called <i>destructuring</i>.<span class="Apple-converted-space">  </span>Stop now and play around with it.<span class="Apple-converted-space">  </span>Notice how deep you can go.<span class="Apple-converted-space">  </span>Try using the <span class="s1">&amp;</span><span class="Apple-converted-space">  </span>to collect left over elements.<span class="Apple-converted-space">  </span>And then get ready because this is going to get lit.</p>
<p class="p4"><br></p>
<p class="p3">user=&gt; (def bob {:first-name "Bob" :last-name "Martin" :age 71})</p>
<p class="p3"><b>#'user/bob</b></p>
<p class="p3">user=&gt; bob</p>
<p class="p3"><b>{:first-name "Bob", :last-name "Martin", :age 71}</b></p>
<p class="p3">user=&gt; (let [{name :first-name birth :dob :or {birth :none}} bob] (prn name birth))</p>
<p class="p3"><b>"Bob" :none</b></p>
<p class="p3"><b>nil</b></p>
<p class="p4"><br></p>
<p class="p2">That’s nifty right?<span class="Apple-converted-space">  </span>Play around with that <span class="s1">:or</span>.<span class="Apple-converted-space">  </span>This next one is even better.</p>
<p class="p4"><br></p>
<p class="p3">user=&gt; (let [{:keys [first-name age]} bob] (prn first-name age))</p>
<p class="p3"><b>"Bob" 71</b></p>
<p class="p3"><b>nil</b></p>
<p class="p4"><br></p>
<p class="p2">This works really well so long as the keywords and the variables have the name spelling.</p>
<p class="p4"><br></p>
<p class="p3">user=&gt; (defn hi [{:keys [first-name last-name] :as person}]<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">         </span>(println "Hello" last-name "," first-name "," (:age person)))</p>
<p class="p3"><b>#'user/hi</b></p>
<p class="p3">user=&gt; (hi bob)</p>
<p class="p3"><b>Hello Martin , Bob , 71</b></p>
<p class="p3"><b>nil</b></p>
<p class="p4"><b></b><br></p>
<p class="p2">Of course you don’t have to use keywords if you don’t want to:</p>
<p class="p12"><br></p>
<p class="p3">user=&gt; (def sun {"name" "Sol" "mass" 2e30 "diameter" 1.4e6 "distance" 1.5e8})</p>
<p class="p3"><b>#'user/sun</b></p>
<p class="p3">user=&gt; sun</p>
<p class="p3"><b>{"name" "Sol", "mass" 2.0E30<a id="fnlink10"></a></b><a href="#fn10"><span class="s3"><sup>[10]</sup></span></a><b>, "diameter" 1400000.0, "distance" 1.5E8}</b></p>
<p class="p3">user=&gt; (let [{:strs [name distance]} sun]<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">         </span>(printf<a id="fnlink11"></a><a href="#fn11"><span class="s3"><sup>[11]</sup></span></a> "%s is %.0f km away\n" name distance))</p>
<p class="p3"><b>Sol is 150000000 km away</b></p>
<p class="p3"><b>nil</b></p>
<p class="p12"><br></p>
<p class="p2">Yeah, you can use strings as the keys if you like — though keywords are better in most cases. <span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p3">user=&gt; (def trixie {:dog/breed :Chihuahua :dog/age 13 :dog/color :tan})</p>
<p class="p3"><b>#'user/trixie</b></p>
<p class="p3">user=&gt; trixie</p>
<p class="p3"><b>#:dog{:breed :Chihuahua, :age 13, :color :tan}</b></p>
<p class="p4"><b></b><br></p>
<p class="p2">Notice the <span class="s1">:dog</span> in front of the <span class="s1">{</span>?<span class="Apple-converted-space">  </span>That tells you that the keywords in the map are all in the <span class="s1">dog</span> namespace. <span class="Apple-converted-space"> </span></p>
<p class="p4"><b></b><br></p>
<p class="p3">user=&gt; (let [{:dog/keys [breed color]} trixie] (prn "Trixie" breed color))</p>
<p class="p3"><b>"Trixie" :Chihuahua :tan</b></p>
<p class="p4"><b></b><br></p>
<p class="p2">And that’s how you destructure namespaced keywords.</p>
<p class="p4"><br></p>
<p class="p3">user=&gt; (defn some-func [arg &amp; {:keys [x y]}] (prn arg x y))</p>
<p class="p3"><b>#'user/some-func</b></p>
<p class="p3">user=&gt; (some-func 99 :x 1 :y 2)</p>
<p class="p3"><b>99 1 2</b></p>
<p class="p3"><b>nil</b></p>
<p class="p4"><br></p>
<p class="p2">And that’s how you pass an implicit map (a map without the braces) into a function. <span class="Apple-converted-space"> </span></p>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 36.0px Palatino"><b>Exercise</b></h1>
<p class="p8"><b>1.<span class="Apple-tab-span">	</span>Path Length 3D</b></p>
<p class="p9">Write the function <span class="s1">path-length</span> that takes a list of 3D points that defines a path and calculates the length of that path.<br>
<br>
For example <span class="s1">(path-length [0 0 0] [0 0 1] [0 1 1] [1 1 1])</span> should equal 3.<span class="Apple-converted-space"> </span></p>
<p class="p10"><br></p>
<p class="p11"><br></p>
<h1 style="margin: 36.0px 0.0px 36.0px 0.0px; text-align: center; font: 48.0px Helvetica">Chapter 11</h1>
<h1 style="margin: 36.0px 0.0px 36.0px 0.0px; text-align: center; font: 48.0px Helvetica">String me Along</h1>
<p class="p3">user=&gt; (Integer/parseInt "21")</p>
<p class="p3"><b>21</b></p>
<p class="p3">user=&gt; (Double/parseDouble "3.14")</p>
<p class="p3"><b>3.14</b></p>
<p class="p4"><br></p>
<p class="p2">These are nice when you want to turn a string into a number.</p>
<p class="p4"><br></p>
<p class="p3">user=&gt; (format "Hello %s you are %d." "Bob" 71)</p>
<p class="p3"><b>"Hello Bob you are 71."</b></p>
<p class="p4"><br></p>
<p class="p2">The <span class="s1">format</span> function takes many different <span class="s1">%</span> codes to format the arguments.<span class="Apple-converted-space"> </span></p>
<ul class="ul1">
  <li class="li2"><span class="s1">%s </span>is for strings.<span class="Apple-converted-space">  </span>e.g. <span class="s1">“Bob”</span></li>
  <li class="li2"><span class="s1">%d</span> is for decimal integers. e.g. <span class="s1">99</span></li>
  <li class="li2"><span class="s1">%f</span> is for decimal numbers with fractions. e.g. <span class="s1">3.14159</span></li>
</ul>
<p class="p4"><br></p>
<p class="p3">user=&gt; (format "Name: %-20s Height: %3.1f meters." "William Mitchell" 2.05)</p>
<p class="p3"><b>"Name: William Mitchell <span class="Apple-converted-space">    </span>Height: 2.1 meters."</b></p>
<p class="p3">user=&gt; (format "Name: %-20s Height: %3.1f meters." "Robert Martin" 1.9)</p>
<p class="p3"><b>"Name: Robert Martin<span class="Apple-converted-space">        </span>Height: 1.9 meters."</b></p>
<p class="p3">user=&gt; (format "Name: %20s Height: %3.1f meters." "Trixie" 0.1)</p>
<p class="p3"><b>"Name: <span class="Apple-converted-space">              </span>Trixie Height: 0.1 meters."</b></p>
<p class="p3">user=&gt; (format "Name: %20s Height: %3.2f meters." "Tulip" 0.08)</p>
<p class="p3"><b>"Name:<span class="Apple-converted-space">                </span>Tulip Height: 0.08 meters."</b></p>
<p class="p3">user=&gt; (format "Name: %20s Height: %4.2f meters." "Tulip" 0.08)</p>
<p class="p3"><b>"Name:<span class="Apple-converted-space">                </span>Tulip Height: 0.08 meters."</b></p>
<p class="p3">user=&gt; (format "Name: %20s Height: %5.2f meters." "Tulip" 0.08)</p>
<p class="p3"><b>"Name:<span class="Apple-converted-space">                </span>Tulip Height:<span class="Apple-converted-space">  </span>0.08 meters."</b></p>
<p class="p4"><br></p>
<p class="p2">Using numbers after the <span class="s1">%</span> gives you a lot of control over spacing.</p>
<p class="p2">You can learn more about this at:<span class="s1"><span class="Apple-converted-space"> </span></span></p>
<p class="p14">http://download.oracle.com/javase/1.5.0/docs/api/java/util/Formatter.html</p>
<p class="p4"><br></p>
<p class="p3">user=&gt; (subs "hello" 1)</p>
<p class="p3"><b>"ello"</b></p>
<p class="p3">user=&gt; (subs "hello" 1 2)</p>
<p class="p3"><b>"e"</b></p>
<p class="p4"><br></p>
<p class="p2">The <span class="s1">subs</span> function is short for substring.</p>
<p class="p3">user=&gt; (require '[clojure.string :as string])</p>
<p class="p3"><b>nil</b></p>
<p class="p3">user=&gt; (string/join "," ["me" "you"])</p>
<p class="p3"><b>"me,you"</b></p>
<p class="p3">user=&gt; (string/split-lines "hello\nthere")</p>
<p class="p3"><b>["hello" "there"]</b></p>
<p class="p3">user=&gt; (string/index-of "This is text" "is")</p>
<p class="p3"><b>2</b></p>
<p class="p4"><br></p>
<p class="p2">The <span class="s1">\n</span> between <span class="s1">hello</span> and <span class="s1">there</span> is an <i>escape</i> character representing a line end.<span class="Apple-converted-space">  </span>There are other escape characters like that. <span class="Apple-converted-space"> </span></p>
<ul class="ul1">
  <li class="li19">\n newline</li>
  <li class="li19">\b backspace</li>
  <li class="li19">\f new page (form feed)</li>
  <li class="li19">\t tab</li>
  <li class="li19">\r carriage return (think of a typewriter or a teletype)</li>
  <li class="li19">\” double quote.</li>
</ul>
<p class="p4"><br></p>
<p class="p3">user=&gt; (type #"this")</p>
<p class="p3"><b>java.util.regex.Pattern</b></p>
<p class="p4"><br></p>
<p class="p2">That leading <span class="s1">#</span> turns a string into a regular expression.<span class="Apple-converted-space">  </span>As you’ll see, regular expressions match patterns.</p>
<p class="p3">user=&gt; (string/split "1,2,3, <span class="Apple-converted-space">  </span>31" #",\s*")</p>
<p class="p3"><b>["1" "2" "3" "31"]</b></p>
<p class="p4"><br></p>
<p class="p2">The <span class="s1">#”,\s*”</span> pattern matches a comma followed by any number of spaces, including zero spaces.<span class="Apple-converted-space">  </span>The <span class="s1">\s</span> character means any whitespace character like space or tab. <span class="Apple-converted-space"> </span></p>
<p class="p12"><br></p>
<p class="p14">user=&gt; (string/replace "this<span class="Apple-converted-space">    </span>is<span class="Apple-converted-space">    </span>text" #"\s+" ".")</p>
<p class="p14">"this.is.text"</p>
<p class="p4"><br></p>
<p class="p2">In this case the <span class="s1">#”\s+”</span> matches any string of whitespace with at least one whitespace character in it. <span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p3">user=&gt; (re-find #"\d+" "This is 99...")</p>
<p class="p3">"99"</p>
<p class="p3">user=&gt; (re-seq #"\d+" "so 9 &gt; 8 &lt; 99")</p>
<p class="p3">("9" "8" "99")</p>
<p class="p4"><br></p>
<p class="p2">I’m sure you realized that <span class="s1">\d</span> matches any digit.<span class="Apple-converted-space">  </span>Y</p>
<p class="p4"><br></p>
<p class="p3">user=&gt; (re-matches #"Hello!*" "Hell")</p>
<p class="p3">nil</p>
<p class="p3">user=&gt; (re-matches #"Hello!*" "Hello")</p>
<p class="p3">"Hello"</p>
<p class="p3">user=&gt; (re-matches #"Hello!*" "Hello!!!!!!!!")</p>
<p class="p3">"Hello!!!!!!!!"</p>
<p class="p3">user=&gt; (re-matches #"Hello!*" "Hello!!!!!!!!x")</p>
<p class="p3">nil</p>
<p class="p4"><br></p>
<p class="p2">The <span class="s1">re-matches</span> function returns <span class="s1">nil</span> if the string does not match, otherwise it returns the matched string.</p>
<p class="p4"><br></p>
<p class="p3">user=&gt; (re-matches #".X" "")</p>
<p class="p3">nil</p>
<p class="p3">user=&gt; (re-matches #".X" "X")</p>
<p class="p3">nil</p>
<p class="p3">user=&gt; (re-matches #".X" "aX")</p>
<p class="p3">"aX"</p>
<p class="p3">user=&gt; (re-matches #".X" "bX")</p>
<p class="p3">"bX"</p>
<p class="p3">user=&gt; (re-matches #"\.X" "bX")</p>
<p class="p3">nil</p>
<p class="p3">user=&gt; (re-matches #"\.X" ".X")</p>
<p class="p3">".X"</p>
<p class="p4"><br></p>
<p class="p20">In a regular expression a <span class="s1">.</span> matches any character at all, and <span class="s1">\.</span> Matches just a <span class="s1">.</span>.</p>
<p class="p4"><br></p>
<p class="p3">user=&gt; (re-matches #"Time (\d+):(\d+)." "Time 3:15.")</p>
<p class="p3">["Time 3:15." "3" "15"]</p>
<p class="p4"><br></p>
<p class="p2">The <span class="s1">re-matches</span> function also deals with parentheses in the regular expression by extracting the match within the parentheses. <span class="Apple-converted-space"> </span></p>
<p class="p2">Regular expressions are a big topic.<span class="Apple-converted-space">  </span>You can find out more about them in the following URL.<span class="Apple-converted-space">  </span>Don’t be daunted by the complexity of that page, and don’t try to read it all right now. <span class="Apple-converted-space"> </span></p>
<p class="p14"><a href="https://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html">https://docs.oracle.com/javase/8/docs/api/java/util/regex/Pattern.html</a><span class="s3"> <span class="Apple-converted-space"> </span></span></p>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 36.0px Palatino"><b>Exercises</b></h1>
<p class="p8"><b>1.<span class="Apple-tab-span">	</span>Receipt</b></p>
<p class="p9">Calling <span class="s1">(slurp items.txt)</span> returns a string containing the entire contents of the <span class="s1">items.txt</span> file.<br>
Write a program that reads in <span class="s1">items.txt</span> and prints a receipt as follows. <span class="Apple-converted-space"> </span></p>
<p class="p15">- - - items.txt</p>
<p class="p15">Product: chips Price:2.89 Quantity: 2</p>
<p class="p15">Product: Coke 12 pack Price:6.99 Quantity: 4</p>
<p class="p15">Product: Newspaper Price:1.49 Quantity: 1</p>
<p class="p15">Product: Cheddar Cheese Price:6.87 Quantity: 1</p>
<p class="p15">Product: Lifesavers Price:.50 Quantity: 7</p>
<p class="p21"><br></p>
<p class="p15">- - - The receipt</p>
<p class="p15"><span class="Apple-converted-space">               </span>chips X2<span class="Apple-converted-space">  </span>@2.89<span class="Apple-converted-space">  </span>= <span class="Apple-converted-space">  </span>5.78 <span class="Apple-converted-space">  </span>| <span class="Apple-converted-space">  </span>5.78</p>
<p class="p15"><span class="Apple-converted-space">        </span>Coke 12 pack X4<span class="Apple-converted-space">  </span>@6.99<span class="Apple-converted-space">  </span>=<span class="Apple-converted-space">  </span>27.96 <span class="Apple-converted-space">  </span>|<span class="Apple-converted-space">  </span>33.74</p>
<p class="p15"><span class="Apple-converted-space">           </span>Newspaper X1<span class="Apple-converted-space">  </span>@1.49<span class="Apple-converted-space">  </span>= <span class="Apple-converted-space">  </span>1.49 <span class="Apple-converted-space">  </span>|<span class="Apple-converted-space">  </span>35.23</p>
<p class="p15"><span class="Apple-converted-space">      </span>Cheddar Cheese X1<span class="Apple-converted-space">  </span>@6.87<span class="Apple-converted-space">  </span>= <span class="Apple-converted-space">  </span>6.87 <span class="Apple-converted-space">  </span>|<span class="Apple-converted-space">  </span>42.10</p>
<p class="p15"><span class="Apple-converted-space">          </span>Lifesavers X7<span class="Apple-converted-space">  </span>@0.50<span class="Apple-converted-space">  </span>= <span class="Apple-converted-space">  </span>3.50 <span class="Apple-converted-space">  </span>|<span class="Apple-converted-space">  </span>45.60</p>
<p class="p4"><br></p>
<p class="p22"><br></p>
<p class="p23"><br>
<br>
</p>
<p class="p24"><br></p>
<p class="p24"><br></p>
<h1 style="margin: 36.0px 0.0px 36.0px 0.0px; text-align: center; font: 48.0px Helvetica">Chapter 12</h1>
<h1 style="margin: 36.0px 0.0px 36.0px 0.0px; text-align: center; font: 48.0px Helvetica">Libraries</h1>
<p class="p3">~/junk/libraries &gt;cat deps.edn</p>
<p class="p3">{:deps</p>
<p class="p3"><span class="Apple-converted-space">  </span>{clojure.java-time/clojure.java-time {:mvn/version "1.4.2"}}</p>
<p class="p3">}</p>
<p class="p4"><br></p>
<p class="p2">If that looks like a Clojure hashmap to you, you’re not wrong.<span class="Apple-converted-space">  </span>The <span class="s1">.edn</span> file suffix indicates that the <span class="s1">deps.edn</span> file contains a Clojure data structure.</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p3">~/junk/libraries &gt;clj</p>
<p class="p3">Downloading: clojure/java-time/clojure.java-time/1.4.2/clojure.java-time-1.4.2.jar from clojars</p>
<p class="p3">Clojure 1.11.1</p>
<p class="p3">user=&gt;</p>
<p class="p4"><br></p>
<p class="p2">Starting <span class="s1">clj</span> in a directory that contains a <span class="s1">deps.edn</span> file causes <span class="s1">clj</span> to reach out and download the mentioned libraries. <span class="Apple-converted-space"> </span></p>
<p class="p3">user=&gt; (require '[java-time.api :as jt])</p>
<p class="p3"><b>nil</b></p>
<p class="p4"><b></b><br></p>
<p class="p2">See <a href="http://clojars.org"><span class="s1">clojars.org</span></a> and <a href="http://github.com/dm3/clojure.java-time"><span class="s1">github.com/dm3/clojure.java-time</span></a> for more information about the <span class="s1">clojure.java-time</span> library.<span class="Apple-converted-space">  </span>Let’s use some of it’s facilities now.</p>
<p class="p4"><b></b><br></p>
<p class="p3">user=&gt; (jt/instant)</p>
<p class="p3"><b>#object[java.time.Instant 0x7f27f59b "2024-05-07T15:16:55.527525Z"]</b></p>
<p class="p3">user=&gt; (str (jt/instant))</p>
<p class="p3"><b>"2024-05-07T15:17:03.484606Z"</b></p>
<p class="p3">user=&gt; (type (jt/instant))</p>
<p class="p3"><b>java.time.Instant</b></p>
<p class="p3">user=&gt; (str (jt/local-date))</p>
<p class="p3"><b>"2024-05-07"</b></p>
<p class="p3">user=&gt; (str (jt/local-time))</p>
<p class="p3"><b>"10:17:41.426758"</b></p>
<p class="p3">user=&gt; (jt/format "MM/dd" (jt/local-date))</p>
<p class="p3"><b>"05/07"</b></p>
<p class="p3">user=&gt; (jt/local-date "MM/dd/yyyy" "05/12/1977")</p>
<p class="p3"><b>#object[java.time.LocalDate 0x320be73 "1977-05-12"]</b></p>
<p class="p3">user=&gt; (def a-date (jt/local-date "MM/dd/yyyy" "05/12/1977"))</p>
<p class="p3"><b>#'user/a-date</b></p>
<p class="p3">user=&gt; (jt/format "dd MMM, yy" a-date)</p>
<p class="p3"><b>"12 May, 77"</b></p>
<p class="p4"><b></b><br></p>
<p class="p14"><span class="s3">You can read more about those formatting codes in: <br>
</span>https://docs.oracle.com/javase/8/docs/api/java/time/format/DateTimeFormatter.html</p>
<p class="p4"><b></b><br></p>
<p class="p3">user=&gt; (def agile (jt/instant "2001-02-11T00:00:00.0Z"))</p>
<p class="p3"><b>#'user/agile</b></p>
<p class="p3">user=&gt; (def now (jt/instant))</p>
<p class="p3"><b>#'user/now</b></p>
<p class="p3">user=&gt; (jt/time-between agile now :days)</p>
<p class="p3"><b>8486</b></p>
<p class="p4"><b></b><br></p>
<p class="p2">Now let’s use the clojure.math.combinatorics library.</p>
<p class="p3">user=&gt; (require '[clojure.math.combinatorics :as combo])</p>
<p class="p3">Execution error (FileNotFoundException) at user/eval3407 (REPL:1).</p>
<p class="p3">Could not locate clojure/math/combinatorics__init.class, clojure/math/combinatorics.clj or clojure/math/combinatorics.cljc on classpath.</p>
<p class="p4"><br></p>
<p class="p2">Oops.<span class="Apple-converted-space">  </span>I forgot to add the library to <span class="s1">deps.edn</span>.</p>
<p class="p4"><br></p>
<p class="p3">~/junk/libraries &gt;cat deps.edn</p>
<p class="p3">{:deps</p>
<p class="p3"><span class="Apple-converted-space">  </span>{clojure.java-time/clojure.java-time {:mvn/version "1.4.2"}</p>
<p class="p3"><span class="Apple-converted-space">   </span>org.clojure/math.combinatorics {:mvn/version "0.3.0"}}</p>
<p class="p3">}</p>
<p class="p4"><br></p>
<p class="p3">~/junk/libraries &gt;clj</p>
<p class="p3">Downloading: org/clojure/math.combinatorics/0.3.0/math.combinatorics-0.3.0.pom from central</p>
<p class="p3">Downloading: org/clojure/math.combinatorics/0.3.0/math.combinatorics-0.3.0.jar from central</p>
<p class="p3">Clojure 1.11.1</p>
<p class="p3">user=&gt; (require '[clojure.math.combinatorics :as combo])</p>
<p class="p3">nil</p>
<p class="p4"><br></p>
<p class="p2">That’s better.<span class="Apple-converted-space">  </span>Now let’s play.</p>
<p class="p4"><br></p>
<p class="p3">user=&gt; (combo/permutations ['a 'b 'c])</p>
<p class="p3"><b>((a b c) (a c b) (b a c) (b c a) (c a b) (c b a))</b></p>
<p class="p3">user=&gt; (combo/combinations [:a :b :c :d] 2)</p>
<p class="p3"><b>((:a :b) (:a :c) (:a :d) (:b :c) (:b :d) (:c :d))</b></p>
<p class="p4"><b></b><br></p>
<p class="p2">Cool!<span class="Apple-converted-space">  </span>Now let’s go get the complex arithmetic library!</p>
<p class="p4"><br></p>
<p class="p3">~/junk/libraries &gt;cat deps.edn</p>
<p class="p3">{:deps</p>
<p class="p3"><span class="Apple-converted-space">  </span>{clojure.java-time/clojure.java-time {:mvn/version "1.4.2"}</p>
<p class="p3"><span class="Apple-converted-space">   </span>org.clojure/math.combinatorics {:mvn/version "0.3.0"}</p>
<p class="p3"><span class="Apple-converted-space">   </span>complex/complex {:mvn/version "0.1.12"}</p>
<p class="p3"><span class="Apple-converted-space">  </span>}</p>
<p class="p3">}</p>
<p class="p4"><br></p>
<p class="p3">~/junk/libraries &gt;clj</p>
<p class="p3">Downloading: complex/complex/0.1.12/complex-0.1.12.pom from clojars</p>
<p class="p3">Downloading: complex/complex/0.1.12/complex-0.1.12.jar from clojars</p>
<p class="p3">Clojure 1.11.1</p>
<p class="p3">user=&gt; (require '[complex.core :as c])</p>
<p class="p3">WARNING: abs already refers to: #'clojure.core/abs in namespace: complex.core, being replaced by: #'complex.core/abs</p>
<p class="p3">nil</p>
<p class="p3">user=&gt; (c/complex 1 1)</p>
<p class="p3">#object[org.apache.commons.math3.complex.Complex 0x3ee39da0 "(1.0, 1.0)"]</p>
<p class="p3">user=&gt; (str (c/complex 1 1))</p>
<p class="p3">"(1.0, 1.0)"</p>
<p class="p3">user=&gt; (c/conjugate (c/complex 2 3))</p>
<p class="p3">#object[org.apache.commons.math3.complex.Complex 0x75201592 "(2.0, -3.0)"]</p>
<p class="p3">user=&gt; (c/* (c/complex 2 3) (c/complex 3 4))</p>
<p class="p3">#object[org.apache.commons.math3.complex.Complex 0x438bad7c "(-6.0, 17.0)"]</p>
<p class="p3">user=&gt; (def pi-i (c/complex 0 Math/PI))</p>
<p class="p3">#'user/pi-i</p>
<p class="p3">user=&gt; pi-i</p>
<p class="p3">#object[org.apache.commons.math3.complex.Complex 0x2899a8db "(0.0, 3.141592653589793)"]</p>
<p class="p3">user=&gt; (c/pow Math/E pi-i)</p>
<p class="p3">#object[org.apache.commons.math3.complex.Complex 0x1162410a "(-1.0, 1.2246467991473532E-16)"]</p>
<p class="p4"><br></p>
<p class="p2">So, <i>e</i><span class="s2"><i>iπ</i></span><i>=-1</i>.<span class="Apple-converted-space">  </span>Good to know.</p>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 36.0px Palatino"><b>Exercises</b></h1>
<p class="p8"><b>1.<span class="Apple-tab-span">	</span>Print JSON</b></p>
<p class="p9">Use the <span class="s1">org.clojure/data.json</span> library to convert the following data structure to JSON.<span class="Apple-converted-space">  </span>You will find that library here: <a href="https://github.com/clojure/data.json"><span class="s1">https://github.com/clojure/data.json</span></a>.</p>
<p class="p3"><span class="Apple-converted-space">   </span>{:first-name "Robert"</p>
<p class="p3"><span class="Apple-converted-space">    </span>:last-name "Martin"</p>
<p class="p3"><span class="Apple-converted-space">    </span>:age 71</p>
<p class="p3"><span class="Apple-converted-space">    </span>:children ["Angela" "Micah" "Gina" "Justin"]}</p>
<p class="p18"><br></p>
<p class="p18"><br></p>
<p class="p25"><br></p>
<h1 style="margin: 36.0px 0.0px 36.0px 0.0px; text-align: center; font: 48.0px Helvetica">Chapter 13</h1>
<h1 style="margin: 36.0px 0.0px 36.0px 0.0px; text-align: center; font: 48.0px Helvetica">Let's Test</h1>
<p class="p3">&gt;ls</p>
<p class="p3">deps.edn <span class="Apple-converted-space">    </span>spec <span class="Apple-converted-space">    </span>src</p>
<p class="p3">&gt;cat deps.edn</p>
<p class="p3">{:deps<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">   </span>{org.clojure/clojure {:mvn/version "1.11.1"}}</p>
<p class="p3"><span class="Apple-converted-space"> </span>:aliases</p>
<p class="p3"><span class="Apple-converted-space">   </span>{:spec <span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">     </span>{:main-opts ["-m" "speclj.main" "-c"]</p>
<p class="p3"><span class="Apple-converted-space">      </span>:extra-deps<span class="Apple-converted-space">  </span>{speclj/speclj {:mvn/version "3.4.6"}}</p>
<p class="p3"><span class="Apple-converted-space">      </span>:extra-paths ["spec"]}}</p>
<p class="p3">}</p>
<p class="p4"><br></p>
<p class="p2">The <span class="s1">deps.edn</span> file is saying that we will be using Clojure version <span class="s1">1.11.1</span>.<span class="Apple-converted-space">  </span>It also describes an <i>alias</i> named <span class="s1">spec</span> to make it easier to run our tests.<span class="Apple-converted-space">  </span>That alias will use <span class="s1">speclj</span> version <span class="s1">3.4.6</span> and will consider the <span class="s1">spec</span> subdirectory as part of the project.</p>
<p class="p4"><br></p>
<p class="p3">––– spec/letsTest_spec.clj –––</p>
<p class="p3">(ns letsTest-spec</p>
<p class="p3"><span class="Apple-tab-span">	</span>(:require<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">    </span>[speclj.core :refer :all]</p>
<p class="p3"><span class="Apple-converted-space">    </span>[letsTest :refer :all]))</p>
<p class="p4"><br></p>
<p class="p3">(describe "letsTest"</p>
<p class="p3"><span class="Apple-tab-span">	</span>(it "computes averages"</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>(should= 0 (average))))</p>
<p class="p4"><br></p>
<p class="p3">––– src/letsTest.clj –––</p>
<p class="p3">(ns letsTest)</p>
<p class="p4"><br></p>
<p class="p3">(defn average [])</p>
<p class="p3">––––––––––––––––––––––––</p>
<p class="p4"><br></p>
<p class="p3">&gt;clj -M:spec -a</p>
<p class="p3"><span class="Apple-converted-space">  </span><b>1) letsTest computes averages</b></p>
<p class="p3"><b><span class="Apple-converted-space">     </span>Expected: 0</b></p>
<p class="p3"><b><span class="Apple-converted-space">          </span>got: nil (using =)</b></p>
<p class="p3"><b><span class="Apple-converted-space">     </span>/letsTest/spec/letsTest_spec.clj:7</b></p>
<p class="p4"><b></b><br></p>
<p class="p3"><b>Finished in 0.00019 seconds</b></p>
<p class="p3"><b>1 examples, 1 failures</b></p>
<p class="p4"><br></p>
<p class="p2">The <span class="s1">clj -M:spec -a</span> command executes the alias which runs the tests.<span class="Apple-converted-space">  </span>The <span class="s1">-a</span> argument invokes <i>autotest</i>, which will automatically rerun the tests any time one of the files is changed.</p>
<p class="p4"><br></p>
<p class="p3">––– src/letsTest.clj –––</p>
<p class="p3">(ns letsTest)</p>
<p class="p4"><br></p>
<p class="p3">(defn average []</p>
<p class="p3"><span class="Apple-converted-space">  </span>0)</p>
<p class="p3">––––––––––––––––––––––––</p>
<p class="p3"><b>letsTest</b></p>
<p class="p3"><b>- computes averages</b></p>
<p class="p4"><b></b><br></p>
<p class="p3"><b>Finished in 0.00002 seconds</b></p>
<p class="p3"><b>1 examples, 0 failures</b></p>
<p class="p4"><b></b><br></p>
<p class="p2">The test passed.<span class="Apple-converted-space">  </span>Let’s add another constraint.</p>
<p class="p3">––– spec/letsTest_spec.clj –––</p>
<p class="p3">(describe "letsTest"</p>
<p class="p3"><span class="Apple-converted-space">  </span>(it "computes averages"</p>
<p class="p3"><span class="Apple-converted-space">    </span>(should= 0 (average))</p>
<p class="p3"><span class="Apple-converted-space">    </span>(should= 1 (average 1))</p>
<p class="p4"><br></p>
<p class="p3">––– src/letsTest.clj –––</p>
<p class="p3">(ns letsTest)</p>
<p class="p4"><br></p>
<p class="p3">(defn average [&amp; ns]</p>
<p class="p3"><span class="Apple-converted-space">  </span>0)</p>
<p class="p3">––––––––––––––––––––––––</p>
<p class="p3"><b><span class="Apple-converted-space">  </span>1) letsTest computes averages</b></p>
<p class="p3"><b><span class="Apple-converted-space">     </span>Expected: 1</b></p>
<p class="p3"><b><span class="Apple-converted-space">          </span>got: 0 (using =)</b></p>
<p class="p3"><b><span class="Apple-converted-space">     </span>/letsTest/spec/letsTest_spec.clj:8</b></p>
<p class="p4"><b></b><br></p>
<p class="p3"><b>Finished in 0.00016 seconds</b></p>
<p class="p3"><b>1 examples, 1 failures</b></p>
<p class="p4"><br></p>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 36.0px Palatino"><b>Exercises</b></h1>
<p class="p8"><b>1.<span class="Apple-tab-span">	</span>Test</b></p>
<p class="p9">Add a few more tests and make them pass.</p>
<p class="p10"><br></p>
<p class="p11"><br></p>
<h1 style="margin: 36.0px 0.0px 36.0px 0.0px; text-align: center; font: 48.0px Helvetica">Chapter 14</h1>
<h1 style="margin: 36.0px 0.0px 36.0px 0.0px; text-align: center; font: 48.0px Helvetica">GUI Quil</h1>
<p class="p3">––– deps.edn –––<br>
{:deps</p>
<p class="p3"><span class="Apple-converted-space">  </span>{quil/quil</p>
<p class="p3"><span class="Apple-converted-space">    </span>{:mvn/version “4.3.1563”}}</p>
<p class="p3">}</p>
<p class="p3">________________</p>
<p class="p4"><br></p>
<p class="p2">This will bring in the quil library which provides a framework for drawing pretty pictures on the screen — like this.</p>
<p class="p4"><br></p>
<p class="p26"><img src="Images/Pasted Graphic.png" width="206px" height="218px" alt="Image"></p>
<p class="p4"><br></p>
<p class="p2">What that picture cannot show is that the circle is traveling around in a spiral path, changing both radius and color as it glides.</p>
<p class="p3">––– gui.clj –––<br>
(ns gui</p>
<p class="p3"><span class="Apple-converted-space">  </span>(:require [quil.core :as q]</p>
<p class="p3"><span class="Apple-converted-space">            </span>[quil.middleware :as m]))</p>
<p class="p4"><br></p>
<p class="p3">(defn setup []</p>
<p class="p3"><span class="Apple-converted-space">  </span>(q/frame-rate 30)</p>
<p class="p3"><span class="Apple-converted-space">  </span>(q/color-mode :hsb)</p>
<p class="p3"><span class="Apple-converted-space">  </span>{:color 0</p>
<p class="p3"><span class="Apple-converted-space">   </span>:angle 0</p>
<p class="p3"><span class="Apple-converted-space">   </span>:distance 150</p>
<p class="p3"><span class="Apple-converted-space">   </span>:size 100})</p>
<p class="p4"><br></p>
<p class="p2">The screen will update 30 times per second.<span class="Apple-converted-space">  </span>Color will be specified in <span class="s1">[hue, saturation, brightness]<a id="fnlink12"></a><a href="#fn12"><span class="s3"><sup>[12]</sup></span></a></span> triplets.<span class="Apple-converted-space">  </span>And the initial state of the circle will have a hue of 0 (red), an angle from the origin of 0, a distance from the origin of 150 pixels, and a diameter of 100 pixels.</p>
<p class="p4"><br></p>
<p class="p3">(defn update-state [{:keys [color angle distance size]}]</p>
<p class="p3"><span class="Apple-converted-space">  </span>{:color (mod (+ color<span class="Apple-converted-space">  </span>0.7) 255)</p>
<p class="p3"><span class="Apple-converted-space">   </span>:angle (+ angle 0.1)</p>
<p class="p3"><span class="Apple-converted-space">   </span>:distance (if (&lt; distance -150) 150 (- distance 1))</p>
<p class="p3"><span class="Apple-converted-space">   </span>:size (if (&lt; size -100) 100 (- size 1))})</p>
<p class="p4"><br></p>
<p class="p2">This function is called 30 times per second. It’s input is the state of the circle.<span class="Apple-converted-space">  </span>It’s output is the new state of the circle.<span class="Apple-converted-space">  </span>As you can see the color, angle, distance, and size of the circle are all modified incrementally.</p>
<p class="p4"><br></p>
<p class="p3">(defn draw-state [{:keys [color angle distance size]}]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(q/background 240)</p>
<p class="p3"><span class="Apple-converted-space">  </span>(q/fill color 255 255)</p>
<p class="p3"><span class="Apple-converted-space">  </span>(let [size (abs size)</p>
<p class="p3"><span class="Apple-converted-space">        </span>distance (abs distance)</p>
<p class="p3"><span class="Apple-converted-space">        </span>x (* distance (q/cos angle))</p>
<p class="p3"><span class="Apple-converted-space">        </span>y (* distance (q/sin angle))]</p>
<p class="p3"><span class="Apple-converted-space">    </span>(q/with-translation [(/ (q/width) 2)</p>
<p class="p3"><span class="Apple-converted-space">                         </span>(/ (q/height) 2)]</p>
<p class="p3"><span class="Apple-converted-space">      </span>(q/ellipse x y size size))))</p>
<p class="p4"><br></p>
<p class="p2">This function is also called 30 times per second.<span class="Apple-converted-space">  </span>It sets the background to a soft grey (240), and the fill color of any drawn shape to the hue of the circle.<span class="Apple-converted-space">  </span>Then it corrects for any negatives in the size and distance, computes the (x,y) coordinates of the circle’s center, sets the origin of the screen to the center of the screen, and then draws the circle.</p>
<p class="p4"><br></p>
<p class="p3">(q/defsketch gui</p>
<p class="p3"><span class="Apple-converted-space">  </span>:title "You spin my circle right round"</p>
<p class="p3"><span class="Apple-converted-space">  </span>:size [500 500]</p>
<p class="p3"><span class="Apple-converted-space">  </span>:setup setup</p>
<p class="p3"><span class="Apple-converted-space">  </span>:update update-state</p>
<p class="p3"><span class="Apple-converted-space">  </span>:draw draw-state</p>
<p class="p3"><span class="Apple-converted-space">  </span>:features [:keep-on-top]</p>
<p class="p3"><span class="Apple-converted-space">  </span>:middleware [m/fun-mode])</p>
<p class="p4"><br></p>
<p class="p2">This is a call to the <span class="s1">defsketch</span> function.<span class="Apple-converted-space">  </span>It starts up the <span class="s1">quil</span> framework, creates the sketch window, calls <span class="s1">setup</span>, and then starts calling <span class="s1">update-state</span> and <span class="s1">draw-state</span> 30 times per second.</p>
<p class="p4"><br></p>
<p class="p3">(defn -main [&amp; args]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(println "gui has begun."))</p>
<p class="p4"><br></p>
<p class="p2">This is the main function that gets called when you invoke <span class="s1">clj -M -m gui</span>.<span class="Apple-converted-space"> </span></p>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 36.0px Palatino"><b>Exercise</b></h1>
<p class="p8"><b>1.<span class="Apple-tab-span">	</span>Fireworks.</b></p>
<p class="p9">Write a <span class="s1">quil</span> program that simulates fireworks.<span class="Apple-converted-space">  </span>Show a fireworks rocket climbing into the sky and then bursting into many smaller stars that fall and finally fade away.</p>
<p class="p10"><br></p>
<p class="p11"><br></p>
<h1 style="margin: 36.0px 0.0px 36.0px 0.0px; text-align: center; font: 48.0px Helvetica">Chapter 15</h1>
<h1 style="margin: 36.0px 0.0px 36.0px 0.0px; text-align: center; font: 48.0px Helvetica">Web</h1>
<p class="p3"><b>——— deps.edn ———</b></p>
<p class="p3">{:deps {org.clojure/clojure {:mvn/version "1.11.1"}</p>
<p class="p3"><span class="Apple-converted-space">        </span>ring/ring-core {:mvn/version "1.11.0"}</p>
<p class="p3"><span class="Apple-converted-space">        </span>ring/ring-jetty-adapter {:mvn/version "1.11.0"}</p>
<p class="p3"><span class="Apple-converted-space">        </span>ring/ring-defaults {:mvn/version "0.4.0"}</p>
<p class="p3"><span class="Apple-converted-space">        </span>compojure/compojure {:mvn/version "1.7.1"}</p>
<p class="p3"><span class="Apple-converted-space">        </span>hiccup/hiccup {:mvn/version "2.0.0-RC3"}}}</p>
<p class="p4"><br></p>
<p class="p2">There are several Clojure libraries that help with creating websites.<span class="Apple-converted-space">  </span>The <span class="s1">ring</span> library handles the low-level communications between the browser and the web program.<span class="Apple-converted-space">  </span>The <span class="s1">compojure</span> library helps you decode the urls.<span class="Apple-converted-space">  </span>The <span class="s1">hiccup</span> library helps you create the HTML to send back to the browser. <span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p3">(ns converter</p>
<p class="p3"><span class="Apple-converted-space">  </span>(:require</p>
<p class="p3"><span class="Apple-converted-space">    </span>[ring.adapter.jetty :as j]</p>
<p class="p3"><span class="Apple-converted-space">    </span>[compojure.core :refer [defroutes GET]]</p>
<p class="p3"><span class="Apple-converted-space">    </span>[compojure.route :as route]</p>
<p class="p3"><span class="Apple-converted-space">    </span>[ring.middleware.defaults :refer [wrap-defaults</p>
<p class="p3"><span class="Apple-converted-space">                                      </span>site-defaults]]</p>
<p class="p3"><span class="Apple-converted-space">    </span>[hiccup2.core :as h]))</p>
<p class="p4"><br></p>
<p class="p2">First we load in all the libraries we need, and refer the appropriate functions and constants. <span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p3">(defn ftoc [fahr-s]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(let [fahr (Double/parseDouble fahr-s)</p>
<p class="p3"><span class="Apple-converted-space">        </span>celsius (* 5/9 (- fahr 32))]</p>
<p class="p3"><span class="Apple-converted-space">    </span>(str (h/html [:h1 "FTOC"] [:br] fahr-s "°F = " celsius "°C"))))</p>
<p class="p4"><br></p>
<p class="p2">The <span class="s1">ftoc</span> function takes in a string that represents a number of degrees Fahrenheit.<span class="Apple-converted-space">  </span>It parses that string into a <span class="s1">Double</span> and then does the math to convert it to degrees Celsius.<span class="Apple-converted-space">  </span>Finally<span class="Apple-converted-space">  </span>it uses <span class="s1">hiccup</span> to create an HTML display of the conversion. <span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p3">(defroutes app-routes</p>
<p class="p3"><span class="Apple-converted-space">  </span>(GET "/ftoc/:fahr" [fahr] (ftoc fahr))</p>
<p class="p3"><span class="Apple-converted-space">  </span>(route/not-found "Not Found"))</p>
<p class="p4"><br></p>
<p class="p2">The <span class="s1">defroutes</span> macro, from the <span class="s1">compojure</span> library, allows you to specify the various urls, and their contents, that your website should handle. <span class="Apple-converted-space"> </span></p>
<p class="p4"><br></p>
<p class="p3">(def handler</p>
<p class="p3"><span class="Apple-converted-space">  </span>(wrap-defaults app-routes site-defaults))</p>
<p class="p4"><br></p>
<p class="p2">As you’ll see below, the ring library invokes this <span class="s1">handler</span>.<span class="Apple-converted-space">  </span>The <span class="s1">handler</span> is invoked every time there is a web request.<span class="Apple-converted-space">  </span>The url from that request is passed to the <span class="s1">compojure</span> routes defined in the <span class="s1">defroutes</span> macro.</p>
<p class="p4"><br></p>
<p class="p3">(defn -main [&amp; args]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(j/run-jetty handler {:port 3000}))</p>
<p class="p4"><br></p>
<p class="p2">This is the main program.<span class="Apple-converted-space">  </span>You can invoke it with the command: <span class="s1">clj -M -m converter</span>.<span class="Apple-converted-space">  </span>That will start up your web server on port 3000.<span class="Apple-converted-space">  </span>To access your web program use a browser to go to <span class="s1">localhost:3000/ftoc/32</span>.<span class="Apple-converted-space">  </span>It should print out:</p>
<h1 style="margin: 0.0px 0.0px 16.1px 0.0px; font: 24.0px Times; -webkit-text-stroke: #000000"><span class="s4"><b>FTOC</b></span></h1>
<p class="p28"><span class="s4"></span><br></p>
<p class="p29"><span class="s4">32°F = 0.0°C</span></p>
<p class="p2">I recommend you play with the code a bit to gain some understanding of all the magic symbols.<span class="Apple-converted-space">  </span>Don’t be daunted, it’s not too hard to figure out.</p>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 36.0px Palatino"><b>Exercise</b></h1>
<p class="p8"><b>1.<span class="Apple-tab-span">	</span>Celsius to Fahrenheit. <span class="Apple-converted-space"> </span></b></p>
<p class="p9">Add the <span class="s1">/ctof </span>route to convert Celsius to Fahrenheit.</p>
<p class="p10"><br></p>
<p class="p11"><br></p>
<h1 style="margin: 36.0px 0.0px 36.0px 0.0px; text-align: center; font: 48.0px Helvetica">Chapter 16</h1>
<h1 style="margin: 36.0px 0.0px 36.0px 0.0px; text-align: center; font: 48.0px Helvetica">Answers to Exercises</h1>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 36.0px Palatino"><b>Chapter 2 — First Principles</b></h1>
<p class="p8"><b>1.<span class="Apple-tab-span">	</span>Albert.</b></p>
<p class="p3">=&gt; (defn albert [m] (* m 2999792458 299792458)</p>
<p class="p3">=&gt; (albert 1)</p>
<p class="p3">899315154473681764</p>
<p class="p4"><br></p>
<p class="p8"><b>2.<span class="Apple-tab-span">	</span>Mix it up.</b></p>
<p class="p3">=&gt; (defn mix [s1 s2] (apply str (map str s1 s2)))</p>
<p class="p3">=&gt; (mix "Robert" "Martin")</p>
<p class="p3">"RMoabretritn"</p>
<p class="p4"><br></p>
<p class="p8"><b>3.<span class="Apple-tab-span">	</span>Average.</b></p>
<p class="p3">=&gt; (defn mean [l] (/ (apply + l) (count l)))</p>
<p class="p3">=&gt; (mean [1 2])</p>
<p class="p3">3/2</p>
<p class="p3">=&gt; (double (mean [1 2]))</p>
<p class="p3">1.5</p>
<p class="p4"><br></p>
<p class="p8"><b>4.<span class="Apple-tab-span">	</span>Power.</b></p>
<p class="p3">=&gt; (defn pow [n e] (apply * (repeat e n)))</p>
<p class="p3">=&gt; (pow 2 5)</p>
<p class="p3">32</p>
<p class="p3">=&gt; (pow 2 0)</p>
<p class="p3">1</p>
<p class="p4"><br></p>
<p class="p8"><b>5.<span class="Apple-tab-span">	</span>Filter.</b></p>
<p class="p3">=&gt; (defn pos-neg [l] (concat (filter pos? l) (filter zero? l) (filter neg? l)))</p>
<p class="p3">=&gt; (pos-neg [6 -1 0 4 -2 0])</p>
<p class="p3">(6 4 0 0 -1 -2)</p>
<p class="p4"><br></p>
<p class="p8"><b>6.<span class="Apple-tab-span">	</span>Pythagorus.</b></p>
<p class="p3">=&gt; (defn pythag? [a b c]</p>
<p class="p3"><span class="Apple-tab-span">	</span>(= (* c c) (+ (* a a) (* b b))))</p>
<p class="p3">=&gt; (pythag? 3 4 5)</p>
<p class="p3">true</p>
<p class="p3">=&gt; (pythag? 1 2 3)</p>
<p class="p3">false</p>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 36.0px Palatino"><b>Chapter 3 — Decisions, Decisions</b></h1>
<p class="p8"><b>1.<span class="Apple-tab-span">	</span>Quad.</b></p>
<p class="p3">(defn quad [a b c]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(cond</p>
<p class="p3"><span class="Apple-converted-space">    </span>(zero? a)</p>
<p class="p3"><span class="Apple-converted-space">    </span>(/ (- c) b)</p>
<p class="p4"><br></p>
<p class="p3"><span class="Apple-converted-space">    </span>(neg? (- (* b b) (* 4 a c)))</p>
<p class="p3"><span class="Apple-converted-space">    </span>"imaginary"</p>
<p class="p4"><br></p>
<p class="p3"><span class="Apple-converted-space">    </span>(zero? (- (* b b) (* 4 a c)))</p>
<p class="p3"><span class="Apple-converted-space">    </span>(/ (- b) (* 2 a))</p>
<p class="p4"><br></p>
<p class="p3"><span class="Apple-converted-space">    </span>:else</p>
<p class="p3"><span class="Apple-converted-space">    </span>[(/ (+ (- b) (Math/sqrt (- (* b b) (* 4 a c)))) (* 2 a))</p>
<p class="p3"><span class="Apple-converted-space">     </span>(/ (- (- b) (Math/sqrt (- (* b b) (* 4 a c)))) (* 2 a))]))</p>
<p class="p4"><br></p>
<p class="p8"><b>2.<span class="Apple-tab-span">	</span>Fizzbuzz.</b></p>
<p class="p3">(defn fizzbuzz [n]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(for [x (range 1 (inc n))]</p>
<p class="p3"><span class="Apple-converted-space">    </span>(cond</p>
<p class="p3"><span class="Apple-converted-space">      </span>(zero? (rem x 15))</p>
<p class="p3"><span class="Apple-converted-space">      </span>"fizzbuzz"</p>
<p class="p3"><span class="Apple-converted-space">      </span>(zero? (rem x 5))</p>
<p class="p3"><span class="Apple-converted-space">      </span>"buzz"</p>
<p class="p3"><span class="Apple-converted-space">      </span>(zero? (rem x 3))</p>
<p class="p3"><span class="Apple-converted-space">      </span>"fizz"</p>
<p class="p3"><span class="Apple-converted-space">      </span>:else</p>
<p class="p3"><span class="Apple-converted-space">      </span>x)))</p>
<p class="p4"><br></p>
<p class="p8"><b>3.<span class="Apple-tab-span">	</span>Distances.</b></p>
<p class="p3">(def points [["O" 0 0] ["A" 1 1] ["B" 1 2] ["C" 2 3] ["D" 4 5]])</p>
<p class="p4"><br></p>
<p class="p3">(defn square [x] (* x x))</p>
<p class="p4"><br></p>
<p class="p3">(defn distance [x1 y1 x2 y2]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(Math/sqrt (+ (square (- x1 x2)) (square (- y1 y2)))))</p>
<p class="p4"><span class="Apple-converted-space">  </span></p>
<p class="p3">(defn distances [points]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(doseq [p1 points p2 points :when (not= p1 p2)]</p>
<p class="p3"><span class="Apple-converted-space">    </span>(prn</p>
<p class="p3"><span class="Apple-converted-space">      </span>(str (first p1) "-" (first p2))</p>
<p class="p3"><span class="Apple-converted-space">      </span>(distance (nth p1 1) (nth p1 2) (nth p2 1) (nth p2 2)))))</p>
<p class="p4"><br></p>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 36.0px Palatino"><b>Chapter 4 — A Touch of Math</b></h1>
<p class="p2">These exercises use some of the functions from the chapter, like <span class="s1">sin-term-sign</span>.<span class="Apple-converted-space">  </span>They are not repeated in the solutions presented here.</p>
<p class="p8"><b>1.<span class="Apple-tab-span">	</span>Arctangent.</b></p>
<p class="p3">(defn arctan-term [x n]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(* (sin-term-sign n)</p>
<p class="p3"><span class="Apple-converted-space">    </span>(/ (pow x n) n)))</p>
<p class="p4"><span class="Apple-converted-space">     </span></p>
<p class="p3">(defn arctan [x n]</p>
<p class="p3"><span class="Apple-tab-span">	</span>(let [ns (range 1 n 2)</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-converted-space">      </span>terms (map (fn [n] (arctan-term x n)) ns)]</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>(apply + terms)))</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (* 4.0 (arctan 1 2000))</p>
<p class="p3">3.140592653839793</p>
<p class="p4"><br></p>
<p class="p8"><b>2.<span class="Apple-tab-span">	</span>Generate π.</b></p>
<p class="p3">(defn arctan-term [x n]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(* (sin-term-sign n)</p>
<p class="p3"><span class="Apple-converted-space">    </span>(/ 1.0 n)))</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (* 4.0 (arctan 1 2000000))</p>
<p class="p3">3.1415916535897743</p>
<p class="p4"><br></p>
<p class="p8"><b>3.<span class="Apple-tab-span">	</span>Seriously π.</b></p>
<p class="p3">(defn arctan-term [x n]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(* (sin-term-sign n)</p>
<p class="p3"><span class="Apple-converted-space">    </span>(/ (pow x n) n)))</p>
<p class="p4"><span class="Apple-converted-space">     </span></p>
<p class="p3">(defn arctan [x n]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(let [ns (range 1 n 2)</p>
<p class="p3"><span class="Apple-converted-space">        </span>terms (map (fn [n] (arctan-term x n)) ns)]</p>
<p class="p3"><span class="Apple-converted-space">    </span>(apply + terms)))</p>
<p class="p4"><span class="Apple-converted-space">    </span></p>
<p class="p3">(defn pi-gen [n]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(let [t1 (* 12 (arctan 1/38 n<a id="fnlink13"></a><a href="#fn13"><span class="s3"><sup>[13]</sup></span></a>))</p>
<p class="p3"><span class="Apple-converted-space">        </span>t2 (* 20 (arctan 1/57 n))</p>
<p class="p3"><span class="Apple-converted-space">        </span>t3 (* 7 (arctan 1/239 n))</p>
<p class="p3"><span class="Apple-converted-space">        </span>t4 (* 24 (arctan 1/268 n))</p>
<p class="p3"><span class="Apple-converted-space">        </span>pi-4 (+ t1 t2 t3 t4)]</p>
<p class="p3"><span class="Apple-converted-space">    </span>(with-precision n (bigdec (* 4 pi-4)))))</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (pi-gen 1000)</p>
<p class="p3">3.141592653589793238462643383279502884197169399375105820974944592307816406286208998628</p>
<p class="p3">03482534211706798214808651328230664709384460955058223172535940812848111745028410270193</p>
<p class="p3">85211055596446229489549303819644288109756659334461284756482337867831652712019091456485</p>
<p class="p3">66923460348610454326648213393607260249141273724587006606315588174881520920962829254091</p>
<p class="p3">71536436789259036001133053054882046652138414695194151160943305727036575959195309218611</p>
<p class="p3">73819326117931051185480744623799627495673518857527248912279381830119491298336733624406</p>
<p class="p3">56643086021394946395224737190702179860943702770539217176293176752384674818467669405132</p>
<p class="p3">00056812714526356082778577134275778960917363717872146844090122495343014654958537105079</p>
<p class="p3">22796892589235420199561121290219608640344181598136297747713099605187072113499999983729</p>
<p class="p3">78049951059731732816096318595024459455346908302642522308253344685035261931188171010003</p>
<p class="p3">13783875288658753320838142061717766914730359825349042875546873115956286388235378759375</p>
<p class="p3">1957781857780532171226806613001927876611195909216420199M</p>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 36.0px Palatino"><b>Chapter 5 — Reductions and Threads</b></h1>
<p class="p8"><b>1.<span class="Apple-tab-span">	</span>Unthread.</b></p>
<p class="p9">I hope you struggled over this one.<span class="Apple-converted-space">  </span>It’s hard to unthread <span class="s1">sigma</span>, isn’t it.<span class="Apple-converted-space">  </span>In the end I compromised with the following.<span class="Apple-converted-space">  </span>I’ll leave it to you to decide whether the definition of <span class="s1">deviance</span> employs an anonymous function or not.</p>
<p class="p4"><br></p>
<p class="p3">(defn sigma [l]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(let [u (mean l)</p>
<p class="p3"><span class="Apple-converted-space">        </span>deviance (fn [x] (- x u))]</p>
<p class="p3"><span class="Apple-converted-space">    </span>(Math/sqrt (mean (map square (map deviance l))))))</p>
<p class="p4"><br></p>
<p class="p8"><b>2.<span class="Apple-tab-span">	</span>Popularity.</b></p>
<p class="p3">(defn popularity [l]</p>
<p class="p3"><span class="Apple-tab-span">	</span>(double (reduce #(+ %2 (/ %1 2)) l)))</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (popularity [100 150 90 200 120 150 90])</p>
<p class="p3">231.875</p>
<p class="p4"><br></p>
<p class="p8"><b>3.<span class="Apple-tab-span">	</span>Ships.</b></p>
<p class="p9">I hope you used a text editor to type your program in.<span class="Apple-converted-space">  </span>This is my solution:</p>
<p class="p3">(defn add-vector [v1 v2]</p>
<p class="p3"><span class="Apple-converted-space">  </span>[(+ (first v1) (first v2))</p>
<p class="p3"><span class="Apple-converted-space">   </span>(+ (second v1) (second v2))])</p>
<p class="p4"><br></p>
<p class="p3">(defn move-ship [ship]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(let [position (first ship)</p>
<p class="p3"><span class="Apple-converted-space">        </span>velocity (second ship)</p>
<p class="p3"><span class="Apple-converted-space">        </span>velocity (if (nil? velocity) [0 0] velocity)</p>
<p class="p3"><span class="Apple-converted-space">        </span>position (add-vector position velocity)]</p>
<p class="p3"><span class="Apple-converted-space">    </span>[position velocity])</p>
<p class="p3"><span class="Apple-converted-space">  </span>)</p>
<p class="p4"><br></p>
<p class="p3">(defn thrust-ship [ship thrust]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(let [position (first ship)</p>
<p class="p3"><span class="Apple-converted-space">        </span>velocity (second ship)</p>
<p class="p3"><span class="Apple-converted-space">        </span>velocity (if (nil? velocity) [0 0] velocity)</p>
<p class="p3"><span class="Apple-converted-space">        </span>velocity (add-vector velocity thrust)]</p>
<p class="p3"><span class="Apple-converted-space">    </span>[position velocity]))</p>
<p class="p4"><br></p>
<p class="p3">(defn tick [ship thrust]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(-&gt; ship (thrust-ship thrust) move-ship))</p>
<p class="p4"><br></p>
<p class="p3">(defn ticks [ship thrusts]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(reduce tick ship thrusts))</p>
<p class="p4"><br></p>
<p class="p3">=&gt; (ticks [[0 0]] [[1 1] [0 0] [2 0] [-1 2] [-1 -1]])</p>
<p class="p3">[[8 8] [1 2]]</p>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 36.0px Palatino"><b>Chapter 6 - The Keymaster and the Mapkeeper</b></h1>
<p class="p8"><b>1.<span class="Apple-tab-span">	</span>Bank</b></p>
<p class="p4"><span class="Apple-converted-space">  </span></p>
<p class="p3"><span class="Apple-converted-space">  </span>(defn deposit [account amount]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(update account :balance + amount))</p>
<p class="p4"><br></p>
<p class="p3">(defn withdraw [account amount]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(update account :balance - amount))</p>
<p class="p4"><br></p>
<p class="p3">(defn pay-interest [account rate]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(update account :balance * (+ 1 rate)))</p>
<p class="p4"><br></p>
<p class="p3">(defn process-transaction [accounts transaction]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(let [t-type (:type transaction)</p>
<p class="p3"><span class="Apple-converted-space">        </span>t-account (:account transaction)]</p>
<p class="p3"><span class="Apple-converted-space">    </span>(condp = t-type</p>
<p class="p3"><span class="Apple-converted-space">      </span>:deposit</p>
<p class="p3"><span class="Apple-converted-space">      </span>(update accounts t-account deposit (:amount transaction))</p>
<p class="p4"><br></p>
<p class="p3"><span class="Apple-converted-space">      </span>:withdrawal</p>
<p class="p3"><span class="Apple-converted-space">      </span>(update accounts t-account withdraw (:amount transaction))</p>
<p class="p4"><br></p>
<p class="p3"><span class="Apple-converted-space">      </span>:interest</p>
<p class="p3"><span class="Apple-converted-space">      </span>(reduce (fn [accounts map-entry]</p>
<p class="p3"><span class="Apple-converted-space">                </span>(assoc accounts</p>
<p class="p3"><span class="Apple-converted-space">                  </span>(first map-entry)</p>
<p class="p3"><span class="Apple-converted-space">                  </span>(pay-interest</p>
<p class="p3"><span class="Apple-converted-space">                    </span>(second map-entry)</p>
<p class="p3"><span class="Apple-converted-space">                    </span>(:rate transaction)))) {} accounts))))</p>
<p class="p4"><br></p>
<p class="p3">(defn process-transactions [accounts transactions]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(reduce process-transaction accounts transactions))</p>
<p class="p4"><br></p>
<p class="p8"><b>2.<span class="Apple-tab-span">	</span>Risk</b></p>
<p class="p3">(defn can-attack-more? [game]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(let [attackers (:attackers game)</p>
<p class="p3"><span class="Apple-converted-space">        </span>max-attack-dice (min 3 (dec attackers))</p>
<p class="p3"><span class="Apple-converted-space">        </span>attack-dice (:attack-dice game)]</p>
<p class="p3"><span class="Apple-converted-space">    </span>(&lt; (count attack-dice) max-attack-dice)))</p>
<p class="p4"><br></p>
<p class="p3">(defn can-defend-more? [game]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(let [defenders (:defenders game)</p>
<p class="p3"><span class="Apple-converted-space">        </span>max-defence-dice (min 2 defenders)</p>
<p class="p3"><span class="Apple-converted-space">        </span>defence-dice (:defence-dice game)]</p>
<p class="p3"><span class="Apple-converted-space">    </span>(&lt; (count defence-dice) max-defence-dice)))</p>
<p class="p4"><br></p>
<p class="p3">(defn fight [game pair]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(let [attack-die (first pair)</p>
<p class="p3"><span class="Apple-converted-space">        </span>defence-die (second pair)]</p>
<p class="p3"><span class="Apple-converted-space">    </span>(if (&gt; attack-die defence-die)</p>
<p class="p3"><span class="Apple-converted-space">      </span>(update game :defenders dec)</p>
<p class="p3"><span class="Apple-converted-space">      </span>(update game :attackers dec))))</p>
<p class="p4"><br></p>
<p class="p3">(defn battle [game]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(let [attack-dice (reverse (sort (:attack-dice game)))</p>
<p class="p3"><span class="Apple-converted-space">        </span>defence-dice (reverse (sort (:defence-dice game)))</p>
<p class="p3"><span class="Apple-converted-space">        </span>pairs (map (fn [a b] [a b]) attack-dice defence-dice)</p>
<p class="p3"><span class="Apple-converted-space">        </span>game (assoc game :attack-dice [] :defence-dice [])]</p>
<p class="p3"><span class="Apple-converted-space">    </span>(reduce fight game pairs)</p>
<p class="p3"><span class="Apple-converted-space">    </span>))</p>
<p class="p4"><br></p>
<p class="p3">(defn handle-die [game die]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(let [game (cond</p>
<p class="p3"><span class="Apple-converted-space">               </span>(can-attack-more? game)</p>
<p class="p3"><span class="Apple-converted-space">               </span>(update game :attack-dice conj die)</p>
<p class="p4"><br></p>
<p class="p3"><span class="Apple-converted-space">               </span>(can-defend-more? game)</p>
<p class="p3"><span class="Apple-converted-space">               </span>(update game :defence-dice conj die)</p>
<p class="p4"><br></p>
<p class="p3"><span class="Apple-converted-space">               </span>:else game)]</p>
<p class="p3"><span class="Apple-converted-space">    </span>(if (can-defend-more? game)</p>
<p class="p3"><span class="Apple-converted-space">      </span>game</p>
<p class="p3"><span class="Apple-converted-space">      </span>(battle game))</p>
<p class="p3"><span class="Apple-converted-space">    </span>))</p>
<p class="p4"><br></p>
<p class="p3">(defn play-risk [game dice]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(reduce handle-die game dice))</p>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 36.0px Palatino"><b>Chapter 7 - Namespaces and Sets</b></h1>
<p class="p8"><b>1.<span class="Apple-tab-span">	</span>Letters</b></p>
<p class="p3">(ns letters</p>
<p class="p3"><span class="Apple-converted-space">  </span>(:require [clojure.set :as set]))</p>
<p class="p4"><br></p>
<p class="p3">(defn find-missing [s]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(let [alphabet "abcdefghijklmnopqrstuvwxyz"</p>
<p class="p3"><span class="Apple-converted-space">        </span>alph-set (set alphabet)</p>
<p class="p3"><span class="Apple-converted-space">        </span>s-set (set s)</p>
<p class="p3"><span class="Apple-converted-space">        </span>missing (sort<a id="fnlink14"></a><a href="#fn14"><span class="s3"><sup>[14]</sup></span></a> (set/difference alph-set s-set))]</p>
<p class="p3"><span class="Apple-converted-space">    </span>(apply str missing)))</p>
<p class="p4"><br></p>
<p class="p8"><b>2.<span class="Apple-tab-span">	</span>Primes</b></p>
<p class="p3">(ns primes</p>
<p class="p3"><span class="Apple-converted-space">  </span>(:require [clojure.set :as set]))</p>
<p class="p4"><br></p>
<p class="p3">(defn find-primes [n]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(let [ns (range 2 (inc n))</p>
<p class="p3"><span class="Apple-converted-space">        </span>primes (reduce</p>
<p class="p3"><span class="Apple-converted-space">                 </span>(fn [ps x]</p>
<p class="p3"><span class="Apple-converted-space">                   </span>(set/difference</p>
<p class="p3"><span class="Apple-converted-space">                     </span>ps</p>
<p class="p3"><span class="Apple-converted-space">                     </span>(set (range (* 2 x) (inc n) x))))</p>
<p class="p3"><span class="Apple-converted-space">                 </span>(set ns)</p>
<p class="p3"><span class="Apple-converted-space">                 </span>ns)]</p>
<p class="p3"><span class="Apple-converted-space">    </span>(sort primes)))</p>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 36.0px Palatino"><b>Chapter 8 - Loop de Loop</b></h1>
<p class="p8"><b>1.<span class="Apple-tab-span">	</span>Ballistics</b></p>
<p class="p3">(ns ballistics)</p>
<p class="p4"><br></p>
<p class="p3">(def G 32.17405)</p>
<p class="p3">(def TIC 1/1000)</p>
<p class="p3">(def CD 1/100000)</p>
<p class="p4"><br></p>
<p class="p3">(defn density [h]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(reduce + [1.2225038068</p>
<p class="p3"><span class="Apple-converted-space">             </span>(* h -0.1132617585)</p>
<p class="p3"><span class="Apple-converted-space">             </span>(* h h 0.0035692521)</p>
<p class="p3"><span class="Apple-converted-space">             </span>(* h h h -0.0000375085)]))</p>
<p class="p4"><br></p>
<p class="p3">(defn gravity [v]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(- v (* G TIC)))</p>
<p class="p4"><br></p>
<p class="p3">(defn drag [h v]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(let [av (abs v)</p>
<p class="p3"><span class="Apple-converted-space">        </span>sv (pos? v)</p>
<p class="p3"><span class="Apple-converted-space">        </span>av (- av (* CD (density (/ h 1000)) av av TIC))]</p>
<p class="p3"><span class="Apple-converted-space">    </span>(if sv av (- av))))</p>
<p class="p4"><br></p>
<p class="p3">(defn track []</p>
<p class="p3"><span class="Apple-converted-space">  </span>(loop [x 0 y 0 xv 500 yv 1500 t 0 maxy 0]</p>
<p class="p3"><span class="Apple-converted-space">    </span>(if (and (&gt; t 0) (&lt;= y 0))</p>
<p class="p3"><span class="Apple-converted-space">      </span>(prn (float t) [x y] [xv yv] maxy)</p>
<p class="p3"><span class="Apple-converted-space">      </span>(recur (+ x (* TIC xv)) (+ y (* TIC yv))</p>
<p class="p3"><span class="Apple-converted-space">             </span>(drag y xv)</p>
<p class="p3"><span class="Apple-converted-space">             </span>(gravity (drag y yv))</p>
<p class="p3"><span class="Apple-converted-space">             </span>(+ t TIC)</p>
<p class="p3"><span class="Apple-converted-space">             </span>(max maxy y)))))</p>
<p class="p18"><br></p>
<p class="p8"><b>2.<span class="Apple-tab-span">	</span>Sum of Fractions</b></p>
<p class="p3">(ns sum_fractions)</p>
<p class="p4"><br></p>
<p class="p3">(defn sum-fractions [n]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(loop [denom 1</p>
<p class="p3"><span class="Apple-converted-space">         </span>sum 0]</p>
<p class="p3"><span class="Apple-converted-space">    </span>(if (&gt;= sum n)</p>
<p class="p3"><span class="Apple-converted-space">      </span>(println "denominator: " denom)</p>
<p class="p3"><span class="Apple-converted-space">      </span>(recur (inc denom) (+ sum (/ 1 denom))))))<br>
</p>
<p class="p8"><b>3.<span class="Apple-tab-span">	</span>Word Wrap<br>
</b></p>
<p class="p3">(ns word_wrap</p>
<p class="p3"><span class="Apple-converted-space">  </span>(:require [clojure.string :as string]))</p>
<p class="p4"><br></p>
<p class="p3">(defn wrap [s n]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(if (&lt;= (count s) n)</p>
<p class="p3"><span class="Apple-converted-space">    </span>s</p>
<p class="p3"><span class="Apple-converted-space">    </span>(let [last-space (string/last-index-of s " " n)</p>
<p class="p3"><span class="Apple-converted-space">          </span>split-point (if (nil? last-space) n last-space)</p>
<p class="p3"><span class="Apple-converted-space">          </span>join-point (if (nil? last-space) n (inc last-space))]</p>
<p class="p3"><span class="Apple-converted-space">      </span>(str (subs s 0 split-point) "\n" (wrap (subs s join-point) n)))))</p>
<p class="p4"><br></p>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 36.0px Palatino"><b>Chapter 9 — Let’s Get Modular</b></h1>
<p class="p8"><b>1.<span class="Apple-tab-span">	</span>Path Length</b></p>
<p class="p3">- - - geometry.clj - - -</p>
<p class="p4"><br></p>
<p class="p3">(ns geometry)</p>
<p class="p4"><br></p>
<p class="p3">(defn distance [p1 p2]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(let [x1 (first p1)</p>
<p class="p3"><span class="Apple-converted-space">        </span>y1 (second p1)</p>
<p class="p3"><span class="Apple-converted-space">        </span>x2 (first p2)</p>
<p class="p3"><span class="Apple-converted-space">        </span>y2 (second p2)</p>
<p class="p3"><span class="Apple-converted-space">        </span>h (- x1 x2)</p>
<p class="p3"><span class="Apple-converted-space">        </span>v (- y1 y2)]</p>
<p class="p3"><span class="Apple-converted-space">    </span>(Math/sqrt (+ (* h h) (* v v)))))</p>
<p class="p4"><br></p>
<p class="p3">- - - pathlength.clj - - -</p>
<p class="p4"><br></p>
<p class="p3">(ns pathlength</p>
<p class="p3"><span class="Apple-converted-space">  </span>(:require [geometry :as g]))</p>
<p class="p4"><br></p>
<p class="p3">(defn add-segment [sum-and-last next]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(let [sum (first sum-and-last)</p>
<p class="p3"><span class="Apple-converted-space">        </span>last (second sum-and-last)</p>
<p class="p3"><span class="Apple-converted-space">        </span>d (g/distance last next)]</p>
<p class="p3"><span class="Apple-converted-space">    </span>[(+ sum d) next]))</p>
<p class="p4"><br></p>
<p class="p3">(defn length [points]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(first (reduce add-segment [0 (first points)] (rest points))))</p>
<p class="p4"><br></p>
<p class="p3">- - - pathmain.clj - - -</p>
<p class="p4"><br></p>
<p class="p3">(ns pathmain</p>
<p class="p3"><span class="Apple-converted-space">  </span>(:require</p>
<p class="p3"><span class="Apple-converted-space">    </span>[clojure.string :as string]</p>
<p class="p3"><span class="Apple-converted-space">    </span>[pathlength :refer :all]))</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p3">(defn make-point [s]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(let [ps (string/split s #",")]</p>
<p class="p3"><span class="Apple-converted-space">    </span>(map #(Integer/parseInt %) ps)))</p>
<p class="p4"><br></p>
<p class="p3">(defn -main [&amp; args]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(println (length (map make-point args))))</p>
<p class="p5"><br></p>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 36.0px Palatino"><b>Chapter 10 — Destructure Destructure</b></h1>
<p class="p8"><b>1.<span class="Apple-tab-span">	</span>Path Length 3D<br>
</b></p>
<p class="p30">(ns pathlength3d)</p>
<p class="p31"><br></p>
<p class="p3">(defn square [x] (* x x))</p>
<p class="p4"><br></p>
<p class="p3">(defn distance [[x1 y1 z1] [x2 y2 z2]]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(Math/sqrt (+ (square (- x1 x2))</p>
<p class="p3"><span class="Apple-converted-space">                </span>(square (- y1 y2))</p>
<p class="p3"><span class="Apple-converted-space">                </span>(square (- z1 z2)))))</p>
<p class="p4"><br></p>
<p class="p3">(defn path-length [points]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(let [starts (drop-last points)</p>
<p class="p3"><span class="Apple-converted-space">        </span>destinations (rest points)</p>
<p class="p3"><span class="Apple-converted-space">        </span>distances (map distance starts destinations)]</p>
<p class="p3"><span class="Apple-converted-space">    </span>(reduce + distances)))</p>
<p class="p22"><span class="Apple-converted-space"> </span></p>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 36.0px Palatino"><b>Chapter 11 — String me Along</b></h1>
<p class="p8"><b>1.<span class="Apple-tab-span">	</span>Receipt</b></p>
<p class="p3">(ns receipt</p>
<p class="p3"><span class="Apple-converted-space">  </span>(:require [clojure.string :as string]))</p>
<p class="p4"><br></p>
<p class="p3">(defn parse-line [line]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(let [match (re-matches</p>
<p class="p3"><span class="Apple-converted-space">                </span>#"\s*Product:\s*(.+)\s+Price:\s*(\d*\.\d\d)\s+Quantity:\s*(\d+)\s*"<span class="Apple-converted-space"> </span></p>
<p class="p3"><span class="Apple-converted-space">                </span>line)</p>
<p class="p3"><span class="Apple-converted-space">        </span>[product price quantity] (rest match)</p>
<p class="p3"><span class="Apple-converted-space">        </span>price (Double/parseDouble price)</p>
<p class="p3"><span class="Apple-converted-space">        </span>quantity (Integer/parseInt quantity)</p>
<p class="p3"><span class="Apple-converted-space">        </span>parsed-line {:product product :price price :quantity quantity}]</p>
<p class="p3"><span class="Apple-converted-space">    </span>parsed-line))</p>
<p class="p4"><br></p>
<p class="p3">(defn get-items [file-name]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(let [lines (string/split-lines (slurp file-name))]</p>
<p class="p3"><span class="Apple-converted-space">    </span>(map parse-line lines)))</p>
<p class="p4"><br></p>
<p class="p3">(defn make-receipt [items]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(loop [items items</p>
<p class="p3"><span class="Apple-converted-space">         </span>subtotal 0</p>
<p class="p3"><span class="Apple-converted-space">         </span>receipt []]</p>
<p class="p3"><span class="Apple-converted-space">    </span>(if (empty? items)</p>
<p class="p3"><span class="Apple-converted-space">      </span>(string/join "\n" receipt)</p>
<p class="p3"><span class="Apple-converted-space">      </span>(let [{:keys [price quantity product]} (first items)</p>
<p class="p3"><span class="Apple-converted-space">            </span>amount (* price quantity)</p>
<p class="p3"><span class="Apple-converted-space">            </span>subtotal (+ amount subtotal)</p>
<p class="p3"><span class="Apple-converted-space">            </span>receipt-line (format "%20s X%-2d @%-5.2f =%7.2f <span class="Apple-converted-space">  </span>|%7.2f"</p>
<p class="p3"><span class="Apple-converted-space">                                 </span>product quantity price amount subtotal)]</p>
<p class="p3"><span class="Apple-converted-space">        </span>(recur (rest items)</p>
<p class="p3"><span class="Apple-converted-space">               </span>subtotal</p>
<p class="p3"><span class="Apple-converted-space">               </span>(conj receipt receipt-line))))))</p>
<p class="p4"><br></p>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 36.0px Palatino"><b>Chapter 12 — Libraries</b></h1>
<p class="p8"><b>1.<span class="Apple-tab-span">	</span>Print JSON</b></p>
<p class="p3"><b>–– deps.edn ––</b><span class="Apple-converted-space"> </span></p>
<p class="p3">{:deps {org.clojure/data.json {:mvn/version "2.5.0"}}}<br>
<b>–––––––––––––– </b><br>
<br>
(ns json</p>
<p class="p3"><span class="Apple-converted-space">  </span>(:require [clojure.data.json :as json]))</p>
<p class="p4"><br></p>
<p class="p3">(defn create-report []</p>
<p class="p3"><span class="Apple-converted-space">  </span>(json/write-str {:first-name "Robert"</p>
<p class="p3"><span class="Apple-converted-space">                   </span>:last-name "Martin"</p>
<p class="p3"><span class="Apple-converted-space">                   </span>:age 71</p>
<p class="p3"><span class="Apple-converted-space">                   </span>:children ["Angela" "Micah" "Gina" "Justin"]}))</p>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 36.0px Palatino"><b>Chapter 13 — Let’s Test</b></h1>
<p class="p8"><b>1.<span class="Apple-tab-span">	</span>Test<br>
Add a few more tests and make them pass.<br>
</b></p>
<p class="p3"><b>––– spec/letsTest_spec.clj –––</b></p>
<p class="p3">(ns letsTest-spec</p>
<p class="p3"><span class="Apple-tab-span">	</span>(:require [speclj.core :refer :all]</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>[letsTest :refer :all]))</p>
<p class="p4"><br></p>
<p class="p3">(describe "letsTest"</p>
<p class="p3"><span class="Apple-tab-span">	</span>(it "computes averages"</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>(should= 0 (average))</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>(should= 1 (average 1))</p>
<p class="p3"><span class="Apple-tab-span">	</span><span class="Apple-tab-span">	</span>(should= 2 (average 1 3))))</p>
<p class="p4"><br></p>
<p class="p3"><b>––– src/letsTest.clj –––</b></p>
<p class="p3">(ns letsTest)</p>
<p class="p4"><br></p>
<p class="p3">(defn average [&amp; ns]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(let [n (count ns)]</p>
<p class="p3"><span class="Apple-converted-space">    </span>(if (zero? n)</p>
<p class="p3"><span class="Apple-converted-space">      </span>0</p>
<p class="p3"><span class="Apple-converted-space">      </span>(/ (reduce + ns) n))))</p>
<p class="p5"><br></p>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 36.0px Palatino"><b>Chapter 14 — GUI Quil</b></h1>
<p class="p8"><b>1.<span class="Apple-tab-span">	</span>Fireworks.</b></p>
<p class="p26"><img src="Images/Pasted Graphic 1.png" width="273px" height="280px" alt="Image"></p>
<p class="p32">––– src/deps.edn –––</p>
<p class="p3">{:deps {org.clojure/clojure {:mvn/version "1.11.1"}</p>
<p class="p3"><span class="Apple-converted-space">        </span>quil/quil {:mvn/version "4.3.1563"}}</p>
<p class="p3"><span class="Apple-converted-space"> </span>:aliases {:fireworks {:main-opts [-m fireworks.main]}}}</p>
<p class="p4"><br></p>
<p class="p32">––– src/fireworks/main.clj –––</p>
<p class="p3">(ns fireworks.main</p>
<p class="p3"><span class="Apple-converted-space">  </span>(:require [quil.core :as q]</p>
<p class="p3"><span class="Apple-converted-space">            </span>[quil.middleware :as m]</p>
<p class="p3"><span class="Apple-converted-space">            </span>[fireworks.world :as world]))</p>
<p class="p4"><br></p>
<p class="p3">(def frame-rate 30)</p>
<p class="p3">(def frame-ms (/ 1000 frame-rate))</p>
<p class="p3">(def max-frame-ms (* 2 frame-ms))</p>
<p class="p4"><br></p>
<p class="p3">(defn setup []</p>
<p class="p3"><span class="Apple-converted-space">  </span>(q/frame-rate frame-rate)</p>
<p class="p3"><span class="Apple-converted-space">  </span>(q/color-mode :rgb)</p>
<p class="p3"><span class="Apple-converted-space">  </span>(world/setup {})</p>
<p class="p3"><span class="Apple-converted-space">  </span>(assoc (world/make)</p>
<p class="p3"><span class="Apple-converted-space">    </span>::last-update-time (System/currentTimeMillis)</p>
<p class="p3"><span class="Apple-converted-space">    </span>::mouse-state :mouse-up</p>
<p class="p3"><span class="Apple-converted-space">    </span>::screen-size world/screen-size))</p>
<p class="p4"><br></p>
<p class="p3">(defn mouse-clicked [world]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(let [[ox oy] world/screen-origin</p>
<p class="p3"><span class="Apple-converted-space">        </span>mx (- (q/mouse-x) ox)</p>
<p class="p3"><span class="Apple-converted-space">        </span>my (- (q/mouse-y) oy)]</p>
<p class="p3"><span class="Apple-converted-space">    </span>(world/mouse-clicked [mx my] world)))</p>
<p class="p4"><br></p>
<p class="p3">(defn get-ms-since-last-update [world]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(let [time (System/currentTimeMillis)</p>
<p class="p3"><span class="Apple-converted-space">        </span>ms (- time (::last-update-time world))</p>
<p class="p3"><span class="Apple-converted-space">        </span>ms (min max-frame-ms ms)</p>
<p class="p3"><span class="Apple-converted-space">        </span>world (assoc world ::last-update-time time)]</p>
<p class="p3"><span class="Apple-converted-space">    </span>[ms world]))</p>
<p class="p4"><br></p>
<p class="p3">(defn check-for-mouse-click [world]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(let [mouse-current-state (if (q/mouse-pressed?)</p>
<p class="p3"><span class="Apple-converted-space">                              </span>:mouse-down :mouse-up)</p>
<p class="p3"><span class="Apple-converted-space">        </span>mouse-old-state (::mouse-state world)</p>
<p class="p3"><span class="Apple-converted-space">        </span>world (assoc world ::mouse-state mouse-current-state)</p>
<p class="p3"><span class="Apple-converted-space">        </span>mouse-changed? (not= mouse-current-state mouse-old-state)</p>
<p class="p3"><span class="Apple-converted-space">        </span>mouse-down? (= mouse-current-state :mouse-down)</p>
<p class="p3"><span class="Apple-converted-space">        </span>mouse-clicked? (and mouse-changed? mouse-down?)]</p>
<p class="p3"><span class="Apple-converted-space">    </span>(if mouse-clicked?</p>
<p class="p3"><span class="Apple-converted-space">      </span>(mouse-clicked world)</p>
<p class="p3"><span class="Apple-converted-space">      </span>world)))</p>
<p class="p4"><br></p>
<p class="p3">(defn update-state [world]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(let [[ms world] (get-ms-since-last-update world)]</p>
<p class="p3"><span class="Apple-converted-space">    </span>(-&gt;&gt; world check-for-mouse-click (world/update-state ms))))</p>
<p class="p4"><br></p>
<p class="p3">(defn draw-state [world]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(q/background 50)</p>
<p class="p3"><span class="Apple-converted-space">  </span>(q/with-translation</p>
<p class="p3"><span class="Apple-converted-space">    </span>world/screen-origin</p>
<p class="p3"><span class="Apple-converted-space">    </span>(world/draw-state world)))</p>
<p class="p4"><br></p>
<p class="p3">(defn -main [&amp; _args]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(println "Fireworks has begun.")</p>
<p class="p3"><span class="Apple-converted-space">  </span>(q/defsketch fireworks.main</p>
<p class="p3"><span class="Apple-converted-space">               </span>:title "Fireworks"</p>
<p class="p3"><span class="Apple-converted-space">               </span>:size world/screen-size</p>
<p class="p3"><span class="Apple-converted-space">               </span>:setup setup</p>
<p class="p3"><span class="Apple-converted-space">               </span>:update update-state</p>
<p class="p3"><span class="Apple-converted-space">               </span>:draw draw-state</p>
<p class="p3"><span class="Apple-converted-space">               </span>:features [:keep-on-top]</p>
<p class="p3"><span class="Apple-converted-space">               </span>:middleware [m/fun-mode]))</p>
<p class="p4"><br></p>
<p class="p3"><b>––– src/fireworks/world.clj –––</b></p>
<p class="p3">(ns fireworks.world</p>
<p class="p3"><span class="Apple-converted-space">  </span>(:require [fireworks.background :as background]</p>
<p class="p3"><span class="Apple-converted-space">            </span>[fireworks.rocket :as rocket]</p>
<p class="p3"><span class="Apple-converted-space">            </span>[fireworks.launcher :as launcher]))</p>
<p class="p4"><br></p>
<p class="p3">(def screen-origin [0 0])</p>
<p class="p3">(def screen-size [1000 1000])</p>
<p class="p4"><br></p>
<p class="p3">(defn setup [config]</p>
<p class="p3"><span class="Apple-converted-space">  </span>)</p>
<p class="p4"><br></p>
<p class="p3">(defn make [&amp; config]</p>
<p class="p3"><span class="Apple-converted-space">  </span>{:rockets []})</p>
<p class="p4"><br></p>
<p class="p3">(defn update-state [ms world]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(-&gt;&gt; world</p>
<p class="p3"><span class="Apple-converted-space">       </span>(launcher/update-state ms)</p>
<p class="p3"><span class="Apple-converted-space">       </span>(rocket/update-state ms)))</p>
<p class="p4"><br></p>
<p class="p3">(defn draw-state [world]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(-&gt;&gt; world</p>
<p class="p3"><span class="Apple-converted-space">       </span>rocket/draw-state</p>
<p class="p3"><span class="Apple-converted-space">       </span>background/draw-state))</p>
<p class="p4"><br></p>
<p class="p3">(defn mouse-clicked [[x y] world]</p>
<p class="p3"><span class="Apple-converted-space">  </span>world)</p>
<p class="p4"><br></p>
<p class="p3"><b>––– src/fireworks/background.clj –––</b></p>
<p class="p3">(ns fireworks.background</p>
<p class="p3"><span class="Apple-converted-space">  </span>(:require</p>
<p class="p3"><span class="Apple-converted-space">    </span>[quil.core :as q]))</p>
<p class="p4"><br></p>
<p class="p3">(defn draw-ground [width]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(q/stroke [0 0 0])</p>
<p class="p3"><span class="Apple-converted-space">  </span>(q/stroke-weight 5)</p>
<p class="p3"><span class="Apple-converted-space">  </span>(q/line 0 0 width 0))</p>
<p class="p4"><br></p>
<p class="p3">(defn draw-house [width _height]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(q/with-translation</p>
<p class="p3"><span class="Apple-converted-space">    </span>[(/ width 2) -2]</p>
<p class="p3"><span class="Apple-converted-space">    </span>(q/stroke [50 50 50])</p>
<p class="p3"><span class="Apple-converted-space">    </span>(q/stroke-weight 2)</p>
<p class="p3"><span class="Apple-converted-space">    </span>(let [house-width (/ width 15)</p>
<p class="p3"><span class="Apple-converted-space">          </span>house-height (/ width -20)</p>
<p class="p3"><span class="Apple-converted-space">          </span>roof-height (+ house-height (/ width -40))</p>
<p class="p3"><span class="Apple-converted-space">          </span>door-height (/ house-height 2)</p>
<p class="p3"><span class="Apple-converted-space">          </span>door-width (/ width 60)</p>
<p class="p3"><span class="Apple-converted-space">          </span>door-x (/ (- house-width door-width) 2)</p>
<p class="p3"><span class="Apple-converted-space">          </span>window-y (- (/ house-height 2) (/ width 140))</p>
<p class="p3"><span class="Apple-converted-space">          </span>window-height (/ door-height 2)</p>
<p class="p3"><span class="Apple-converted-space">          </span>window-width (abs window-height)</p>
<p class="p3"><span class="Apple-converted-space">          </span>window-1-x (- door-x window-width)</p>
<p class="p3"><span class="Apple-converted-space">          </span>window-2-x (+ door-x door-width)]</p>
<p class="p3"><span class="Apple-converted-space">      </span>(q/fill 150 150 150)</p>
<p class="p3"><span class="Apple-converted-space">      </span>(q/rect 0 0 house-width house-height)</p>
<p class="p3"><span class="Apple-converted-space">      </span>(q/fill 100 100 100)</p>
<p class="p3"><span class="Apple-converted-space">      </span>(q/triangle 0 house-height</p>
<p class="p3"><span class="Apple-converted-space">                  </span>house-width house-height</p>
<p class="p3"><span class="Apple-converted-space">                  </span>(/ house-width 2) roof-height)</p>
<p class="p3"><span class="Apple-converted-space">      </span>(q/fill 130 130 130)</p>
<p class="p3"><span class="Apple-converted-space">      </span>(q/rect door-x 0 door-width door-height)</p>
<p class="p3"><span class="Apple-converted-space">      </span>(q/fill 200 200 0)</p>
<p class="p3"><span class="Apple-converted-space">      </span>(q/rect window-1-x window-y window-width window-height)</p>
<p class="p3"><span class="Apple-converted-space">      </span>(q/rect window-2-x window-y window-width window-height))))</p>
<p class="p4"><br></p>
<p class="p3">(defn draw-state [world]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(let [[width height] (:fireworks.main/screen-size world)]</p>
<p class="p3"><span class="Apple-converted-space">    </span>(q/with-translation</p>
<p class="p3"><span class="Apple-converted-space">      </span>[0 (- height 5)]</p>
<p class="p3"><span class="Apple-converted-space">      </span>(draw-ground width)</p>
<p class="p3"><span class="Apple-converted-space">      </span>(draw-house width height))))</p>
<p class="p4"><br></p>
<p class="p3"><b>––– src/fireworks/launcher.clj –––</b></p>
<p class="p3">(ns fireworks.launcher</p>
<p class="p3"><span class="Apple-converted-space">  </span>(:require [fireworks.rocket :as rocket]))</p>
<p class="p4"><br></p>
<p class="p3">(defn update-state [_ms world]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(if (&gt; (rand) 0.98)</p>
<p class="p3"><span class="Apple-converted-space">    </span>(update world :rockets conj (rocket/make))</p>
<p class="p3"><span class="Apple-converted-space">    </span>world))</p>
<p class="p4"><br></p>
<p class="p3"><b>––– src/fireworks/rocket.clj –––</b></p>
<p class="p3">(ns fireworks.rocket</p>
<p class="p3"><span class="Apple-converted-space">  </span>(:require</p>
<p class="p3"><span class="Apple-converted-space">    </span>[quil.core :as q]</p>
<p class="p3"><span class="Apple-converted-space">    </span>[vector]))</p>
<p class="p4"><br></p>
<p class="p3">(defn make []</p>
<p class="p3"><span class="Apple-converted-space">  </span>(let [x (+ 50 (rand-int 900))</p>
<p class="p3"><span class="Apple-converted-space">        </span>xs (if (&gt; x 500) -1 1)</p>
<p class="p3"><span class="Apple-converted-space">        </span>v [(* xs (rand 2)) (+ -12 (* -6 (rand)))]]</p>
<p class="p3"><span class="Apple-converted-space">    </span>{:position [x 1000]</p>
<p class="p3"><span class="Apple-converted-space">     </span>:velocity v</p>
<p class="p3"><span class="Apple-converted-space">     </span>:duration (+ 1 (* 4 (rand)))</p>
<p class="p3"><span class="Apple-converted-space">     </span>:levels (+ 1 (rand-int 2))}))</p>
<p class="p4"><br></p>
<p class="p3">(defn update-rocket [ms rocket]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(let [secs (/ ms 1000)</p>
<p class="p3"><span class="Apple-converted-space">        </span>wind 0</p>
<p class="p3"><span class="Apple-converted-space">        </span>{:keys [position velocity duration]} rocket</p>
<p class="p3"><span class="Apple-converted-space">        </span>new-duration (- duration secs)</p>
<p class="p3"><span class="Apple-converted-space">        </span>new-position (vector/add position velocity)</p>
<p class="p3"><span class="Apple-converted-space">        </span>new-velocity (vector/add velocity [(* secs wind) (* secs 5)])]</p>
<p class="p3"><span class="Apple-converted-space">    </span>(assoc rocket :position new-position</p>
<p class="p3"><span class="Apple-converted-space">                  </span>:velocity new-velocity</p>
<p class="p3"><span class="Apple-converted-space">                  </span>:duration new-duration)))</p>
<p class="p4"><br></p>
<p class="p3">(defn make-bomb [{:keys [levels] :as rocket}]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(if (zero? levels)</p>
<p class="p3"><span class="Apple-converted-space">    </span>nil</p>
<p class="p3"><span class="Apple-converted-space">    </span>(let [bomb (update rocket :levels dec)</p>
<p class="p3"><span class="Apple-converted-space">          </span>dx (+ -5 (* 10 (rand)))</p>
<p class="p3"><span class="Apple-converted-space">          </span>dy (+ -5 (* 10 (rand)))</p>
<p class="p3"><span class="Apple-converted-space">          </span>bomb (update bomb :velocity vector/add [dx dy])]</p>
<p class="p3"><span class="Apple-converted-space">      </span>(assoc bomb :duration 1.5))))</p>
<p class="p4"><br></p>
<p class="p3">(defn explosion [rocket]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(let [n (+ 10 (rand-int 10))]</p>
<p class="p3"><span class="Apple-converted-space">    </span>(remove nil? (for [_x (range n)] (make-bomb rocket)))))</p>
<p class="p4"><br></p>
<p class="p3">(defn explode [rockets]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(loop [rockets rockets</p>
<p class="p3"><span class="Apple-converted-space">         </span>new-rockets []]</p>
<p class="p3"><span class="Apple-converted-space">    </span>(if (empty? rockets)</p>
<p class="p3"><span class="Apple-converted-space">      </span>new-rockets</p>
<p class="p3"><span class="Apple-converted-space">      </span>(let [{:keys [duration levels] :as rocket} (first rockets)]</p>
<p class="p3"><span class="Apple-converted-space">        </span>(if (and (neg? duration)</p>
<p class="p3"><span class="Apple-converted-space">                 </span>(&gt; (rand) 0.9))</p>
<p class="p3"><span class="Apple-converted-space">          </span>(recur (rest rockets) (concat new-rockets (explosion rocket)))</p>
<p class="p3"><span class="Apple-converted-space">          </span>(recur (rest rockets) (conj new-rockets rocket)))))))</p>
<p class="p4"><br></p>
<p class="p3">(defn update-state [ms world]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(let [{:keys [rockets]} world</p>
<p class="p3"><span class="Apple-converted-space">        </span>updated-rockets (map #(update-rocket ms %) rockets)</p>
<p class="p3"><span class="Apple-converted-space">        </span>updated-rockets (explode updated-rockets)]</p>
<p class="p3"><span class="Apple-converted-space">    </span>(doall (assoc world :rockets updated-rockets))))</p>
<p class="p4"><br></p>
<p class="p3">(defn draw-state [world]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(let [{:keys [rockets]} world</p>
<p class="p3"><span class="Apple-converted-space">        </span>[_width _height] (:fireworks.main/screen-size world)]</p>
<p class="p3"><span class="Apple-converted-space">    </span>(q/fill [255 255 255])</p>
<p class="p3"><span class="Apple-converted-space">    </span>(q/no-stroke)</p>
<p class="p3"><span class="Apple-converted-space">    </span>(doseq [rocket rockets]</p>
<p class="p3"><span class="Apple-converted-space">      </span>(let [[x y] (:position rocket)]</p>
<p class="p3"><span class="Apple-converted-space">        </span>(q/ellipse x y 5 5))))</p>
<p class="p3"><span class="Apple-converted-space">  </span>world)</p>
<p class="p4"><br></p>
<p class="p3"><b>––– src/vector.clj –––</b></p>
<p class="p3">(ns vector)</p>
<p class="p4"><br></p>
<p class="p3">(defn add [[x1 y1] [x2 y2]]</p>
<p class="p3"><span class="Apple-converted-space">  </span>[(+ x1 x2) (+ y1 y2)])</p>
<p class="p33"><br></p>
<h1 style="margin: 13.0px 0.0px 0.0px 0.0px; font: 36.0px Palatino"><b>Chapter 15 — Web</b></h1>
<p class="p8"><b>1.<span class="Apple-tab-span">	</span>Celsius to Fahrenheit. <span class="Apple-converted-space"> </span></b></p>
<p class="p3">(defn ctof [celsius-s]</p>
<p class="p3"><span class="Apple-converted-space">  </span>(let [celsius (Double/parseDouble celsius-s)</p>
<p class="p3"><span class="Apple-converted-space">        </span>fahr (+ 32 (* 9/5 celsius))]</p>
<p class="p3"><span class="Apple-converted-space">    </span>(str (h/html [:h1 "CTOF"] [:br] celsius-s "°C = " fahr "°F"))))</p>
<p class="p4"><br></p>
<p class="p4"><br></p>
<p class="p3">(defroutes app-routes</p>
<p class="p3"><span class="Apple-converted-space">  </span>(GET "/ftoc/:fahr" [fahr] (ftoc fahr))</p>
<p class="p3"><span class="Apple-converted-space">  </span>(GET "/ctof/:celsius" [celsius] (ctof celsius))</p>
<p class="p3"><span class="Apple-converted-space">  </span>(route/not-found "Not Found"))</p>
<hr>
<p class="p34"><a id="fn1"></a><a href="#fnlink1"><span class="s3">[1]</span></a><span class="s3"> </span>The name “floating point” is historical, and refers to the way the computer represents the number internally.<span class="Apple-converted-space">  </span>For now just consider a floating point number to be a possibly inexact decimal expansion of a fraction.</p>
<p class="p34"><a id="fn2"></a><a href="#fnlink2"><span class="s3">[2]</span></a><span class="s3"> </span>A list is stored as a linked-list.<span class="Apple-converted-space">  </span>A vector is stored as an array (more or less).</p>
<p class="p34"><a id="fn3"></a><a href="#fnlink3"><span class="s3">[3]</span></a><span class="s3"> </span>It’s actually a different kind of list.<span class="Apple-converted-space">  </span>But we’ll learn about that later.</p>
<p class="p34"><a id="fn4"></a><a href="#fnlink4"><span class="s3">[4]</span></a><span class="s3"> </span>Don’t worry, you won’t notice it unless you do millions of calculations.</p>
<p class="p34"><a id="fn5"></a><a href="#fnlink5"><span class="s3">[5]</span></a><span class="s3"> </span>Try computing 1000! and you’ll see just how big they can get.</p>
<p class="p34"><a id="fn6"></a><a href="#fnlink6"><span class="s3">[6]</span></a><span class="s3"> </span>If you haven’t studied Taylor series before, you’ll find the exercise worthwhile and deeply satisfying.</p>
<p class="p34"><a id="fn7"></a><a href="#fnlink7"><span class="s3">[7]</span></a><span class="s3"> </span>Position 763 to be precise.</p>
<p class="p35"><a id="fn8"></a><a href="#fnlink8"><span class="s3">[8]</span></a><span class="s3"> </span>Which makes one wonder why we call them variables.</p>
<p class="p34"><a id="fn9"></a><a href="#fnlink9"><span class="s3">[9]</span></a><span class="s3"> </span>System/currentTimeMillis returns the current time of day in milliseconds since midnight 1 Jan 1970.</p>
<p class="p26"><a id="fn10"></a><a href="#fnlink10"><span class="s3">[10]</span></a><span class="s3"> </span>E Notation.<span class="Apple-converted-space">  </span>2.0X10<span class="s5"><sup>30</sup></span></p>
<p class="p26"><span class="s5"><sup><a id="fn11"></a></sup><a href="#fnlink11"><span class="s3"><sup>[11]</sup></span></a></span><span class="s3"><sup> </sup></span>There is a lot to learn about <span class="s6">printf</span>.<span class="Apple-converted-space">  </span>For the moment <span class="s6">%s </span>means string and <span class="s6">%.0f </span>means number with no decimals.</p>
<p class="p26"><a id="fn12"></a><a href="#fnlink12"><span class="s3">[12]</span></a><span class="s3"> </span>H, S, and B are specified as integers between 0 and 255.<span class="Apple-converted-space">  </span>Hue is simply the colors of the rainbow ROYGBV divided up into 256 levels.<span class="Apple-converted-space">  </span>Saturation is the the richness of the color.<span class="Apple-converted-space">  </span>255 is full rich.<span class="Apple-converted-space">  </span>0 is grey.<span class="Apple-converted-space">  </span>Brightness is the intensity of the color.<span class="Apple-converted-space">  </span>255 is full brightness.<span class="Apple-converted-space">  </span>0 is black.<span class="Apple-converted-space">  </span>Don’t worry too much about this, we’re only going to modify the hue, we’ll let S and B be fully on.</p>
<p class="p34"><a id="fn13"></a><a href="#fnlink13"><span class="s3">[13]</span></a><span class="s3"> </span>I used n here after trying a few other combination like 2n and n/2.<span class="Apple-converted-space">  </span>But n seems to work best.</p>
<p class="p26"><a id="fn14"></a><a href="#fnlink14"><span class="s3">[14]</span></a><span class="s3"> </span>You may have found that this function works well without the sort.<span class="Apple-converted-space">  </span>You shouldn’t trust this.<span class="Apple-converted-space">  </span>Sets don’t guarantee their order.<span class="Apple-converted-space">  </span>It just so happens that the implementation of sets in the version of Clojure I’m currently using maintains sets of characters in alphabetical order.<span class="Apple-converted-space">  </span>I’m quite sure that’s accidental and could change in a later version.</p>
</div>
</body>
</html>
